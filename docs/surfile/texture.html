<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>surfile.texture API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
    }
</style><style>
    .pdoc .mermaid-pre {
        border: none;
        background: none;
    }
</style>
<script type="module" defer>
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

    /* Re-invoke Mermaid when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => mermaid.run()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../surfile.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;surfile</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#example">Example</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Psd">Psd</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Psd.__init__">Psd</a>
                        </li>
                        <li>
                                <a class="variable" href="#Psd.deltaX">deltaX</a>
                        </li>
                        <li>
                                <a class="variable" href="#Psd.deltaY">deltaY</a>
                        </li>
                        <li>
                                <a class="variable" href="#Psd.psd">psd</a>
                        </li>
                        <li>
                                <a class="variable" href="#Psd.psdp">psdp</a>
                        </li>
                        <li>
                                <a class="variable" href="#Psd.fx">fx</a>
                        </li>
                        <li>
                                <a class="variable" href="#Psd.fy">fy</a>
                        </li>
                        <li>
                                <a class="variable" href="#Psd.psdx">psdx</a>
                        </li>
                        <li>
                                <a class="variable" href="#Psd.psdy">psdy</a>
                        </li>
                        <li>
                                <a class="function" href="#Psd.evalPsd">evalPsd</a>
                        </li>
                        <li>
                                <a class="function" href="#Psd.polarSpectra">polarSpectra</a>
                        </li>
                        <li>
                                <a class="function" href="#Psd.angleIntegratedSpectra">angleIntegratedSpectra</a>
                        </li>
                        <li>
                                <a class="function" href="#Psd.averageSpectra">averageSpectra</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Roi">Roi</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Roi.__init__">Roi</a>
                        </li>
                        <li>
                                <a class="variable" href="#Roi.X">X</a>
                        </li>
                        <li>
                                <a class="variable" href="#Roi.Z">Z</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Parameters">Parameters</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Parameters.calc">calc</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#slopeDistribution">slopeDistribution</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../surfile.html">surfile</a><wbr>.texture    </h1>

                        <div class="docstring"><p>'surfile.roughness'</p>

<ul>
<li>analysis of roughness features for:
<ul>
<li>Profiles</li>
<li>Surfaces</li>
</ul></li>
</ul>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">psd</span> <span class="o">=</span> <span class="n">texture</span><span class="o">.</span><span class="n">Psd</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psd</span><span class="o">.</span><span class="n">evalPsd</span><span class="p">(</span><span class="n">sur</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">avg</span> <span class="o">=</span> <span class="n">psd</span><span class="o">.</span><span class="n">averageSpectra</span><span class="p">(</span><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psd</span><span class="o">.</span><span class="n">angleIntegratedSpectra</span><span class="p">(</span><span class="n">dt_fct</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psd</span><span class="o">.</span><span class="n">polarSpectra</span><span class="p">(</span><span class="n">df_fct</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
</div>

<p>@author: Dorothee Hueser, Andrea Giura</p>
</div>

                        <input id="mod-texture-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-texture-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">&#39;surfile.roughness&#39;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">- analysis of roughness features for:</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">    - Profiles</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">    - Surfaces</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">Example</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">-------</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">&gt;&gt;&gt; psd = texture.Psd()</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">&gt;&gt;&gt; psd.evalPsd(sur, bplt=False)</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">&gt;&gt;&gt; avg = psd.averageSpectra(bplt=False)</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">&gt;&gt;&gt; psd.angleIntegratedSpectra(dt_fct=0.8, bplt=True)</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">&gt;&gt;&gt; psd.polarSpectra(df_fct=0.8, bplt=True)</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">@author: Dorothee Hueser, Andrea Giura</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span> <span class="nn">surfile</span> <span class="kn">import</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">funct</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">from</span> <span class="nn">surfile</span> <span class="kn">import</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">funct</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="k">def</span> <span class="nf">_eval_pinter</span><span class="p">(</span><span class="n">PSD</span><span class="p">,</span> <span class="n">fx0</span><span class="p">,</span> <span class="n">fy0</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">nxDC</span><span class="p">,</span> <span class="n">nyDC</span><span class="p">):</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>    <span class="k">def</span> <span class="nf">bilinear_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">z11</span><span class="p">,</span> <span class="n">z12</span><span class="p">,</span> <span class="n">z21</span><span class="p">,</span> <span class="n">z22</span><span class="p">):</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="n">r1</span> <span class="o">=</span> <span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))</span> <span class="o">*</span> <span class="n">z11</span> <span class="o">+</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))</span> <span class="o">*</span> <span class="n">z21</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>        <span class="n">r2</span> <span class="o">=</span> <span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))</span> <span class="o">*</span> <span class="n">z12</span> <span class="o">+</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))</span> <span class="o">*</span> <span class="n">z22</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">+</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span> <span class="o">*</span> <span class="n">r2</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>        <span class="k">return</span> <span class="n">p</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>    <span class="p">(</span><span class="n">Ny</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span> <span class="o">=</span> <span class="n">PSD</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>    <span class="n">fxc</span> <span class="o">=</span> <span class="n">frc</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>    <span class="n">fyc</span> <span class="o">=</span> <span class="n">frc</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>    <span class="n">ix</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">fxc</span> <span class="o">/</span> <span class="n">fx0</span><span class="p">))</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>    <span class="n">iy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">fyc</span> <span class="o">/</span> <span class="n">fy0</span><span class="p">))</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>    <span class="n">ixp</span> <span class="o">=</span> <span class="n">nxDC</span> <span class="o">+</span> <span class="n">ix</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="n">iyp</span> <span class="o">=</span> <span class="n">nyDC</span> <span class="o">+</span> <span class="n">iy</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="n">ixpp</span> <span class="o">=</span> <span class="n">ixp</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>    <span class="n">iypp</span> <span class="o">=</span> <span class="n">iyp</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>    <span class="k">if</span> <span class="n">ixpp</span> <span class="o">==</span> <span class="n">Nx</span><span class="p">:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="n">ixpp</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>    <span class="k">if</span> <span class="n">iypp</span> <span class="o">==</span> <span class="n">Ny</span><span class="p">:</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="n">iypp</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="n">pinter</span> <span class="o">=</span> <span class="n">bilinear_interp</span><span class="p">(</span><span class="n">fxc</span><span class="p">,</span> <span class="n">fyc</span><span class="p">,</span> <span class="n">fx0</span> <span class="o">*</span> <span class="n">ix</span><span class="p">,</span> <span class="n">fx0</span> <span class="o">*</span> <span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>                             <span class="n">fy0</span> <span class="o">*</span> <span class="n">iy</span><span class="p">,</span> <span class="n">fy0</span> <span class="o">*</span> <span class="p">(</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">PSD</span><span class="p">[</span><span class="n">iyp</span><span class="p">][</span><span class="n">ixp</span><span class="p">],</span> <span class="n">PSD</span><span class="p">[</span><span class="n">iypp</span><span class="p">][</span><span class="n">ixp</span><span class="p">],</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>                             <span class="n">PSD</span><span class="p">[</span><span class="n">iyp</span><span class="p">][</span><span class="n">ixpp</span><span class="p">],</span> <span class="n">PSD</span><span class="p">[</span><span class="n">iypp</span><span class="p">][</span><span class="n">ixpp</span><span class="p">])</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="k">return</span> <span class="n">pinter</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="k">class</span> <span class="nc">Psd</span><span class="p">:</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    Class that provides the data structure and methods for PSD</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    calculation.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate an empty psd object&quot;&quot;&quot;</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdp</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># polar spectra</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdx</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdy</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="k">def</span> <span class="nf">evalPsd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        Evaluate the power spectral density of the topography</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        Parameters</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        ----------</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">            The topography</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">            If True plots the PSD result</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        Returns</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">        ----------</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        psd: np.ndarray</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">            The calculated psd of the surface</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        fx, fy: np.array</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">            The x and y axis of the psd</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        psd_x, psd_y: np.ndarray</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">            The psd along the given axis</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">            </span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">        Notes</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        -----</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        The power spectral density (PSD) function gives indication on  the strength </span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        of different frequency components  as function of the spatial frequency and </span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        is calculated from the absolute value of the square of the Fourier transform </span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        of the height values z(x,y).</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        The areal Fourier transform is given by:\n</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        $</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        \\begin{equation}</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        F_z(f_x,f_y)=\\lim_{L_x \\to \\infty}\\lim_{Ly \\to \\infty} \\frac{1}{L_x L_y}\int_{-L_y/2}^{L_y/2}\\int_{-L_x/2}^{L_x/2}z(x,y)e^{[-i2\\pi(f_xx+f_yy)]}dxdy</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">        \\end{equation}</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">        $\n</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        The Power Spectral Density is then calculated as:\n</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        $</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        \\begin{equation}</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">            P(f_x,f_y)=\\frac{d}{df_x}\\frac{d}{df_y}F_z^*(f_x,f_y)F_z(f_x,f_y)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        \\end{equation}</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">        $</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="p">(</span><span class="n">Ny</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="n">Fz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Nx</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">))</span>  <span class="c1"># dimension of a height or length</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="n">Fzx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Nx</span><span class="p">))</span>  <span class="c1"># dimension length</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="n">Fzy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Ny</span><span class="p">))</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="n">PSD</span> <span class="o">=</span> <span class="n">Fz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fz</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="n">RePSD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">PSD</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="n">PSDx</span> <span class="o">=</span> <span class="n">Fzx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fzx</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="n">RePSDx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">PSDx</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="n">PSDy</span> <span class="o">=</span> <span class="n">Fzy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fzy</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="n">RePSDy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">PSDy</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="n">Lx</span> <span class="o">=</span> <span class="n">Nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="n">Ly</span> <span class="o">=</span> <span class="n">Ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="n">RePSD</span> <span class="o">=</span> <span class="n">RePSD</span> <span class="o">*</span> <span class="p">(</span><span class="n">Lx</span> <span class="o">*</span> <span class="n">Ly</span><span class="p">)</span>  <span class="c1"># dimension length^4</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="n">RePSDx</span> <span class="o">=</span> <span class="n">RePSDx</span> <span class="o">*</span> <span class="n">Lx</span>  <span class="c1"># dimension length^3</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="n">RePSDy</span> <span class="o">=</span> <span class="n">RePSDy</span> <span class="o">*</span> <span class="n">Ly</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="n">dfx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Lx</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="n">dfy</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Ly</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="n">fx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Nx</span><span class="p">))</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="n">fy</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ny</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">))</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="n">fx</span> <span class="o">=</span> <span class="n">fx</span> <span class="o">*</span> <span class="n">dfx</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="n">fy</span> <span class="o">=</span> <span class="n">fy</span> <span class="o">*</span> <span class="n">dfy</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sq = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Z</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ny</span><span class="p">)))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;dfx: </span><span class="si">{</span><span class="n">dfx</span><span class="si">}</span><span class="s1"> dfy: </span><span class="si">{</span><span class="n">dfy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;from PSD: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RePSD</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfy</span><span class="p">))</span><span class="si">}</span><span class="s1"> Lx*Ly = </span><span class="si">{</span><span class="n">Lx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ly</span><span class="si">}</span><span class="s1"> Lx = </span><span class="si">{</span><span class="n">Lx</span><span class="si">}</span><span class="s1"> Ly = </span><span class="si">{</span><span class="n">Ly</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq x: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RePSDx</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfx</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq y: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RePSDy</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfy</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="c1"># definition of PSD is Fourier*conj(Fourier) * Lx *Ly</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="c1"># PSD has dimension length^4</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="c1"># PSDx, PSDy have dimension length^3</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="o">=</span> <span class="n">RePSD</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">=</span> <span class="n">fx</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">=</span> <span class="n">fy</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdx</span> <span class="o">=</span> <span class="n">RePSDx</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdy</span> <span class="o">=</span> <span class="n">RePSDy</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">RePSD</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">fx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_x / \mu m^{-1}$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_y / \mu m^{-1}$&#39;</span><span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="n">fig2</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdx</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">fx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">],</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>                      <span class="n">aspect</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">))</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="n">bx</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdy</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span><span class="p">,</span> <span class="n">fy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>                      <span class="n">aspect</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span> <span class="o">/</span> <span class="p">(</span><span class="n">fy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_x / \mu m^{-1}$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$y / \mu m$&#39;</span><span class="p">)</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">bx</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x / \mu m$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_y / \mu m^{-1}$&#39;</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="k">return</span> <span class="n">RePSD</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">RePSDx</span><span class="p">,</span> <span class="n">fy</span><span class="p">,</span> <span class="n">RePSDy</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">polarSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fct</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        Calculate the spectra in polar coordinates</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">        Parameters</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        ----------</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        df_fct: float</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">            The frequency resolution</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">            If true the spectra is plotted in a 3d projection axis</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">        Returns</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">        -------</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">        psdP: np.ndarray</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">            The polar spectra evaluated</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">        Fr, Th: np.array</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">            The polar coordinate vectors</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polar spectra failed: psd has not been evaluated&#39;</span><span class="p">)</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="n">df_x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="n">df_y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="n">nxDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="n">nyDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">df_x</span> <span class="o">*</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df_y</span> <span class="o">*</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="n">fr0</span> <span class="o">=</span> <span class="n">df_fct</span> <span class="o">*</span> <span class="p">(</span><span class="n">df_x</span> <span class="o">+</span> <span class="n">df_y</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="n">fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">fr0</span><span class="p">,</span> <span class="n">frmax</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="c1">#    thetas = np.linspace(0.001, 2*np.pi, 360)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">205</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="n">Th</span><span class="p">,</span> <span class="n">Fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="n">fr</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="p">(</span><span class="n">nf</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span> <span class="o">=</span> <span class="n">Fr</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="n">PSDp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nt</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e-4</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nf</span><span class="p">):</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="n">frc</span> <span class="o">=</span> <span class="n">fr</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="k">for</span> <span class="n">ith</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nt</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                <span class="n">PSDp</span><span class="p">[</span><span class="n">ir</span><span class="p">][</span><span class="n">ith</span><span class="p">]</span> <span class="o">=</span> <span class="n">_eval_pinter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="p">,</span> <span class="n">df_x</span><span class="p">,</span> <span class="n">df_y</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">thetas</span><span class="p">[</span><span class="n">ith</span><span class="p">],</span> <span class="n">nxDC</span><span class="p">,</span> <span class="n">nyDC</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdp</span> <span class="o">=</span> <span class="n">PSDp</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;3d&#39;</span><span class="p">})</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Fr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">),</span> <span class="n">Fr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">PSDp</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gnuplot</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="k">return</span> <span class="n">PSDp</span><span class="p">,</span> <span class="n">Fr</span><span class="p">,</span> <span class="n">Th</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>    <span class="k">def</span> <span class="nf">angleIntegratedSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fct</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">        Calculate the angle integrated spectra</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        Parameters</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">        ----------</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        df_fct: float</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">            If true the angle integrated spectra is plotted</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">        Returns</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">        -------</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        psdP: np.ndarray</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">            The polar spectra evaluated</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">        Fr, Th: np.array</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">            The polar coordinate vectors</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Angle integrated spectra failed: psd has not been evaluated&#39;</span><span class="p">)</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="n">df_x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="n">df_y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="n">nxDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="n">nyDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">df_x</span> <span class="o">*</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df_y</span> <span class="o">*</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="n">fr0</span> <span class="o">=</span> <span class="n">df_fct</span> <span class="o">*</span> <span class="p">(</span><span class="n">df_x</span> <span class="o">+</span> <span class="n">df_y</span><span class="p">)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="n">fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fr0</span><span class="p">,</span> <span class="n">frmax</span><span class="p">,</span> <span class="n">fr0</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fr</span><span class="p">)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="n">PSDr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="n">PSDav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nf</span><span class="p">):</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="n">frc</span> <span class="o">=</span> <span class="n">fr</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="n">nth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">frc</span> <span class="o">/</span> <span class="n">fr0</span><span class="p">))</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="n">dth</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">nth</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">nth</span><span class="p">)</span>  <span class="c1"># + 0.1*np.pi</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="n">dth</span> <span class="o">=</span> <span class="n">thetas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">thetas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="n">psum</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">thetas</span><span class="p">:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>                <span class="n">pinter</span> <span class="o">=</span> <span class="n">_eval_pinter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="p">,</span> <span class="n">df_x</span><span class="p">,</span> <span class="n">df_y</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">nxDC</span><span class="p">,</span> <span class="n">nyDC</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>                <span class="n">psum</span> <span class="o">=</span> <span class="n">psum</span> <span class="o">+</span> <span class="n">pinter</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="n">PSDav</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span> <span class="o">=</span> <span class="n">psum</span> <span class="o">/</span> <span class="n">nth</span>  <span class="c1"># dimension of height^2 * lateral^2 i.e. length^4</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="n">PSDr</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span> <span class="o">=</span> <span class="n">dth</span> <span class="o">*</span> <span class="n">frc</span> <span class="o">*</span> <span class="n">psum</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># frc has dimension of 1 / lateral</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="c1"># therefore PSDr: height^2 * lateral</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="c1"># PSDr = PSDr * fr0</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq r: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">PSDr</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fr0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq r: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">PSDav</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fr</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fr0</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="c1"># ax.loglog(fr, PSDr, &#39;bx-&#39;, markersize=3)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">PSDav</span><span class="p">,</span> <span class="s1">&#39;rx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average over all polar angles&#39;</span><span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="k">return</span> <span class="n">PSDr</span><span class="p">,</span> <span class="n">PSDav</span><span class="p">,</span> <span class="n">fr</span><span class="p">,</span> <span class="n">fr0</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>    <span class="k">def</span> <span class="nf">averageSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">        Calculate the average specra in the x and y directions</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">        Parameters</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">        ----------</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">            Plots the mean spectra if true</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">        Returns</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">        -------</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">        psdMeanx, psdMeany: np.array</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">            The mean psd arrays</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="n">PSDxmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="n">PSDymean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">),</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">dx</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">,</span> <span class="n">PSDxmean</span><span class="p">,</span> <span class="s1">&#39;rx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDx in x dir&#39;</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>            <span class="n">bx</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span><span class="p">,</span> <span class="n">PSDymean</span><span class="p">,</span> <span class="s1">&#39;kx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDy in y dir&#39;</span><span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>            <span class="n">cx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">,</span> <span class="n">PSDxmean</span><span class="p">,</span> <span class="s1">&#39;rx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDx in x dir&#39;</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="n">dx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span><span class="p">,</span> <span class="n">PSDymean</span><span class="p">,</span> <span class="s1">&#39;kx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDy in y dir&#39;</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f$ in $\frac</span><span class="si">{1}</span><span class="s1">{\mu m}$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;PSD in $\mu m^3$&#39;</span><span class="p">)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>            
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">PSDxmean</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">PSDymean</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="nd">@dataclass</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="k">class</span> <span class="nc">Roi</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>    <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>    <span class="n">Z</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="k">class</span> <span class="nc">Parameters</span><span class="p">:</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">rem</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">FormEstimator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fil</span><span class="p">:</span> <span class="nb">filter</span><span class="o">.</span><span class="n">Filter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">        Calculates the roughness parameters of a profile</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        Parameters</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">        ----------</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">            The profile on which the parameters are calculates</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">        rem: remover.Remover</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">            - if None, the low frequency components are not filtered</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        fil: filter.Filter</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">            The filter that is applied before the calculations. The cutoff</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">            of the filter is used to select the central region of the profile,</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">            half cutof is not condsidered at the adges of the rofile</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">            If true plots the profile after the pre-proocessing</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        Returns</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">        -------</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        RA, RQ, RP, RV, RZ, RSK, RKU: (float, ...)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">            Calculated roughness parameters</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="n">border</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="n">rem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="n">rem</span><span class="o">.</span><span class="n">applyFit</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>            <span class="n">rem</span><span class="o">.</span><span class="n">applyFit</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="k">if</span> <span class="n">fil</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>            <span class="n">fil</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>            <span class="n">cutoff</span> <span class="o">=</span> <span class="n">fil</span><span class="o">.</span><span class="n">cutoff</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>            <span class="n">nsample_cutoff</span> <span class="o">=</span> <span class="n">cutoff</span> <span class="o">//</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">))</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="n">border</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsample_cutoff</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="n">roi</span> <span class="o">=</span> <span class="n">Roi</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">border</span><span class="p">:</span> <span class="o">-</span><span class="n">border</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">border</span><span class="p">:</span> <span class="o">-</span><span class="n">border</span><span class="p">])</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="c1"># print(roi.X, roi.Z)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="n">RA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="n">RQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="n">RP</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="n">RV</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="n">RT</span> <span class="o">=</span> <span class="n">RP</span> <span class="o">+</span> <span class="n">RV</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="n">RSK</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">RQ</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="n">RKU</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">RQ</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>        <span class="k">return</span> <span class="n">RA</span><span class="p">,</span> <span class="n">RQ</span><span class="p">,</span> <span class="n">RP</span><span class="p">,</span> <span class="n">RV</span><span class="p">,</span> <span class="n">RT</span><span class="p">,</span> <span class="n">RSK</span><span class="p">,</span> <span class="n">RKU</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="k">def</span> <span class="nf">__makeFacesVectorized</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>    <span class="n">Nr</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>    <span class="n">Nc</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Nc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nr</span> <span class="o">*</span> <span class="n">Nc</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nr</span><span class="p">,</span> <span class="n">Nc</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>    <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>    <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>    <span class="n">out</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="k">return</span> <span class="n">out</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="k">def</span> <span class="nf">__appendSpherical_np</span><span class="p">(</span><span class="n">xyz</span><span class="p">):</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>    <span class="n">xy</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>    <span class="c1"># rs = np.sqrt(xy + xyz[:, 2] ** 2)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>    <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xy</span><span class="p">),</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]))</span>  <span class="c1"># for elevation angle defined from Z-axis down</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>    <span class="c1"># ptsnew[:,4] = np.arctan2(xyz[:,2], np.sqrt(xy))  # for elevation angle defined from XY-plane up</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>    <span class="n">phis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>    <span class="n">phis</span><span class="p">[</span><span class="n">phis</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">360</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>    <span class="k">return</span> <span class="n">thetas</span><span class="p">,</span> <span class="n">phis</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="nd">@funct</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">bplt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">csvPath</span><span class="o">=</span><span class="s1">&#39;out</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="k">def</span> <span class="nf">slopeDistribution</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">structured</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">theta_res</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_res</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">adaptive_hist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">    Calculates the slope distribution in angles theta and phi</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">    Parameters</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">    ----------</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">    obj: surface.Surface</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">        The surface n wich the slope distribution is calculated</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">    structured: bool</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        If true the method assumes equal spacing along x-axis (dx) and equal spacing along</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        y-axis</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">        If false the method uses a generalized triangle approach (recommended)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">    theta_res: float</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">        The angle resolution for the theta angle</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">    phi_res: float</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">        The angle resolution for the phi angle</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">    adaptive_hist: bool</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        If true the bins are calculated between 0 and the max angles</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">        If false the bins are calculated between 0 - 90 for theta, 0 - 360 for phi</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">    bplt: bool</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">        If True plots the calculated histograms</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">    Returns</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">    -------</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">    (hist_theta, edges_theta): tuple</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">        The theta histogram</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">    (hist_phi, edges_phi): tuple</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        The phi histogram</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">        </span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">    Notes</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a><span class="sd">    -----</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">    This method performs a slope distribution analysis on the surface by calculating all </span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">    the normal vectors to the triangles constructed on the adjacent points of the topography. </span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">    The normal vectors are then expressed in polar coordinates and for the two angles </span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">    (elevation, azimuth) a histogram plot is generated. The number of bins for each angle can </span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">    be specified by the user by setting the two parameters res and adaptive_hist. </span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>    <span class="n">z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>    <span class="n">ind</span> <span class="o">=</span> <span class="n">__makeFacesVectorized</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>    <span class="k">def</span> <span class="nf">unstructuredMesh</span><span class="p">():</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">z</span><span class="p">[</span><span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]])</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">z</span><span class="p">[</span><span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]])</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">z</span><span class="p">[</span><span class="n">ind</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]]])</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">C</span> <span class="o">-</span> <span class="n">B</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>    <span class="k">def</span> <span class="nf">structuredMesh</span><span class="p">():</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>        <span class="n">eve_fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">z</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dy</span><span class="p">])</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="n">odd_fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">z</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dy</span><span class="p">])</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="n">ind_eve</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="n">n_eve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">eve_fun</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ind_eve</span><span class="p">)</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="n">ind_odd</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="n">n_odd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">odd_fun</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ind_odd</span><span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">n_eve</span><span class="p">,</span> <span class="n">n_odd</span><span class="p">))</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>    <span class="k">if</span> <span class="n">structured</span><span class="p">:</span> <span class="n">normals</span> <span class="o">=</span> <span class="n">structuredMesh</span><span class="p">()</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>    <span class="k">else</span><span class="p">:</span>          <span class="n">normals</span> <span class="o">=</span> <span class="n">unstructuredMesh</span><span class="p">()</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>    <span class="n">thetas</span><span class="p">,</span> <span class="n">phis</span> <span class="o">=</span> <span class="n">__appendSpherical_np</span><span class="p">(</span><span class="n">normals</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Slope Distribution:</span><span class="se">\n</span><span class="s1">Theta:</span><span class="se">\t</span><span class="si">{</span><span class="n">st</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">Phi:</span><span class="se">\t</span><span class="si">{</span><span class="n">st</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">adaptive_hist</span><span class="p">:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="n">max_theta</span> <span class="o">=</span> <span class="mi">90</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="n">max_phi</span> <span class="o">=</span> <span class="mi">360</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="n">max_theta</span><span class="p">)</span>  <span class="c1"># add only one value to max the space</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="n">phis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phis</span><span class="p">,</span> <span class="n">max_phi</span><span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="n">max_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="n">max_phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>    <span class="n">theta_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">max_theta</span> <span class="o">/</span> <span class="n">theta_res</span><span class="p">))</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>    <span class="n">phi_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">max_phi</span> <span class="o">/</span> <span class="n">phi_res</span><span class="p">))</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>    <span class="n">hist_theta</span><span class="p">,</span> <span class="n">edges_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">theta_bins</span><span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>    <span class="n">hist_phi</span><span class="p">,</span> <span class="n">edges_phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">phis</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">phi_bins</span><span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>    <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="p">(</span><span class="n">ax_ht</span><span class="p">,</span> <span class="n">bx_ht</span><span class="p">)</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="n">ax_ht</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">edges_theta</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">edges_theta</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">hist_theta</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darksalmon&#39;</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="n">bx_ht</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">edges_phi</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">edges_phi</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">hist_phi</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkturquoise&#39;</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">(</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="p">[</span><span class="n">ax_ht</span><span class="p">,</span> <span class="n">bx_ht</span><span class="p">],</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>            <span class="n">gridcol</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>            <span class="n">xlab</span><span class="o">=</span><span class="s1">&#39;slope distribution [deg]&#39;</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>            <span class="n">ylab</span><span class="o">=</span><span class="s1">&#39;percentage [%]&#39;</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="p">)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="n">ax_ht</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; Theta&#39;</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        <span class="n">bx_ht</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; Phi&#39;</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>        <span class="n">cx</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>        <span class="n">cx</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">edges_theta</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">hist_theta</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">hist_theta</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="n">theta_bins</span><span class="p">,</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>               <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darksalmon&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Theta&#39;</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>        <span class="n">dx</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">edges_phi</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">hist_phi</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">hist_phi</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="n">phi_bins</span><span class="p">,</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>               <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkturquoise&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Phi&#39;</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>        <span class="n">cx</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>        <span class="n">dx</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="n">cx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="c1"># plt.show()</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">edges_theta</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist_theta</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="n">edges_phi</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist_phi</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="Psd">
                            <input id="Psd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Psd</span>:

                <label class="view-source-button" for="Psd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Psd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Psd-57"><a href="#Psd-57"><span class="linenos"> 57</span></a><span class="k">class</span> <span class="nc">Psd</span><span class="p">:</span>
</span><span id="Psd-58"><a href="#Psd-58"><span class="linenos"> 58</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Psd-59"><a href="#Psd-59"><span class="linenos"> 59</span></a><span class="sd">    Class that provides the data structure and methods for PSD</span>
</span><span id="Psd-60"><a href="#Psd-60"><span class="linenos"> 60</span></a><span class="sd">    calculation.</span>
</span><span id="Psd-61"><a href="#Psd-61"><span class="linenos"> 61</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Psd-62"><a href="#Psd-62"><span class="linenos"> 62</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Psd-63"><a href="#Psd-63"><span class="linenos"> 63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate an empty psd object&quot;&quot;&quot;</span>
</span><span id="Psd-64"><a href="#Psd-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd-65"><a href="#Psd-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd-66"><a href="#Psd-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd-67"><a href="#Psd-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdp</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># polar spectra</span>
</span><span id="Psd-68"><a href="#Psd-68"><span class="linenos"> 68</span></a>
</span><span id="Psd-69"><a href="#Psd-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd-70"><a href="#Psd-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd-71"><a href="#Psd-71"><span class="linenos"> 71</span></a>
</span><span id="Psd-72"><a href="#Psd-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdx</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd-73"><a href="#Psd-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdy</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd-74"><a href="#Psd-74"><span class="linenos"> 74</span></a>
</span><span id="Psd-75"><a href="#Psd-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="nf">evalPsd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Psd-76"><a href="#Psd-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Psd-77"><a href="#Psd-77"><span class="linenos"> 77</span></a><span class="sd">        Evaluate the power spectral density of the topography</span>
</span><span id="Psd-78"><a href="#Psd-78"><span class="linenos"> 78</span></a>
</span><span id="Psd-79"><a href="#Psd-79"><span class="linenos"> 79</span></a><span class="sd">        Parameters</span>
</span><span id="Psd-80"><a href="#Psd-80"><span class="linenos"> 80</span></a><span class="sd">        ----------</span>
</span><span id="Psd-81"><a href="#Psd-81"><span class="linenos"> 81</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="Psd-82"><a href="#Psd-82"><span class="linenos"> 82</span></a><span class="sd">            The topography</span>
</span><span id="Psd-83"><a href="#Psd-83"><span class="linenos"> 83</span></a><span class="sd">        bplt: bool</span>
</span><span id="Psd-84"><a href="#Psd-84"><span class="linenos"> 84</span></a><span class="sd">            If True plots the PSD result</span>
</span><span id="Psd-85"><a href="#Psd-85"><span class="linenos"> 85</span></a>
</span><span id="Psd-86"><a href="#Psd-86"><span class="linenos"> 86</span></a><span class="sd">        Returns</span>
</span><span id="Psd-87"><a href="#Psd-87"><span class="linenos"> 87</span></a><span class="sd">        ----------</span>
</span><span id="Psd-88"><a href="#Psd-88"><span class="linenos"> 88</span></a><span class="sd">        psd: np.ndarray</span>
</span><span id="Psd-89"><a href="#Psd-89"><span class="linenos"> 89</span></a><span class="sd">            The calculated psd of the surface</span>
</span><span id="Psd-90"><a href="#Psd-90"><span class="linenos"> 90</span></a><span class="sd">        fx, fy: np.array</span>
</span><span id="Psd-91"><a href="#Psd-91"><span class="linenos"> 91</span></a><span class="sd">            The x and y axis of the psd</span>
</span><span id="Psd-92"><a href="#Psd-92"><span class="linenos"> 92</span></a><span class="sd">        psd_x, psd_y: np.ndarray</span>
</span><span id="Psd-93"><a href="#Psd-93"><span class="linenos"> 93</span></a><span class="sd">            The psd along the given axis</span>
</span><span id="Psd-94"><a href="#Psd-94"><span class="linenos"> 94</span></a><span class="sd">            </span>
</span><span id="Psd-95"><a href="#Psd-95"><span class="linenos"> 95</span></a><span class="sd">        Notes</span>
</span><span id="Psd-96"><a href="#Psd-96"><span class="linenos"> 96</span></a><span class="sd">        -----</span>
</span><span id="Psd-97"><a href="#Psd-97"><span class="linenos"> 97</span></a><span class="sd">        The power spectral density (PSD) function gives indication on  the strength </span>
</span><span id="Psd-98"><a href="#Psd-98"><span class="linenos"> 98</span></a><span class="sd">        of different frequency components  as function of the spatial frequency and </span>
</span><span id="Psd-99"><a href="#Psd-99"><span class="linenos"> 99</span></a><span class="sd">        is calculated from the absolute value of the square of the Fourier transform </span>
</span><span id="Psd-100"><a href="#Psd-100"><span class="linenos">100</span></a><span class="sd">        of the height values z(x,y).</span>
</span><span id="Psd-101"><a href="#Psd-101"><span class="linenos">101</span></a><span class="sd">        The areal Fourier transform is given by:\n</span>
</span><span id="Psd-102"><a href="#Psd-102"><span class="linenos">102</span></a><span class="sd">        $</span>
</span><span id="Psd-103"><a href="#Psd-103"><span class="linenos">103</span></a><span class="sd">        \\begin{equation}</span>
</span><span id="Psd-104"><a href="#Psd-104"><span class="linenos">104</span></a><span class="sd">        F_z(f_x,f_y)=\\lim_{L_x \\to \\infty}\\lim_{Ly \\to \\infty} \\frac{1}{L_x L_y}\int_{-L_y/2}^{L_y/2}\\int_{-L_x/2}^{L_x/2}z(x,y)e^{[-i2\\pi(f_xx+f_yy)]}dxdy</span>
</span><span id="Psd-105"><a href="#Psd-105"><span class="linenos">105</span></a><span class="sd">        \\end{equation}</span>
</span><span id="Psd-106"><a href="#Psd-106"><span class="linenos">106</span></a><span class="sd">        $\n</span>
</span><span id="Psd-107"><a href="#Psd-107"><span class="linenos">107</span></a><span class="sd">        The Power Spectral Density is then calculated as:\n</span>
</span><span id="Psd-108"><a href="#Psd-108"><span class="linenos">108</span></a><span class="sd">        $</span>
</span><span id="Psd-109"><a href="#Psd-109"><span class="linenos">109</span></a><span class="sd">        \\begin{equation}</span>
</span><span id="Psd-110"><a href="#Psd-110"><span class="linenos">110</span></a><span class="sd">            P(f_x,f_y)=\\frac{d}{df_x}\\frac{d}{df_y}F_z^*(f_x,f_y)F_z(f_x,f_y)</span>
</span><span id="Psd-111"><a href="#Psd-111"><span class="linenos">111</span></a><span class="sd">        \\end{equation}</span>
</span><span id="Psd-112"><a href="#Psd-112"><span class="linenos">112</span></a><span class="sd">        $</span>
</span><span id="Psd-113"><a href="#Psd-113"><span class="linenos">113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Psd-114"><a href="#Psd-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</span><span id="Psd-115"><a href="#Psd-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</span><span id="Psd-116"><a href="#Psd-116"><span class="linenos">116</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="Psd-117"><a href="#Psd-117"><span class="linenos">117</span></a>        <span class="p">(</span><span class="n">Ny</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Psd-118"><a href="#Psd-118"><span class="linenos">118</span></a>
</span><span id="Psd-119"><a href="#Psd-119"><span class="linenos">119</span></a>        <span class="n">Fz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Nx</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">))</span>  <span class="c1"># dimension of a height or length</span>
</span><span id="Psd-120"><a href="#Psd-120"><span class="linenos">120</span></a>        <span class="n">Fzx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Nx</span><span class="p">))</span>  <span class="c1"># dimension length</span>
</span><span id="Psd-121"><a href="#Psd-121"><span class="linenos">121</span></a>        <span class="n">Fzy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Ny</span><span class="p">))</span>
</span><span id="Psd-122"><a href="#Psd-122"><span class="linenos">122</span></a>        <span class="n">PSD</span> <span class="o">=</span> <span class="n">Fz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fz</span><span class="p">)</span>
</span><span id="Psd-123"><a href="#Psd-123"><span class="linenos">123</span></a>        <span class="n">RePSD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">PSD</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</span><span id="Psd-124"><a href="#Psd-124"><span class="linenos">124</span></a>        <span class="n">PSDx</span> <span class="o">=</span> <span class="n">Fzx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fzx</span><span class="p">)</span>
</span><span id="Psd-125"><a href="#Psd-125"><span class="linenos">125</span></a>        <span class="n">RePSDx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">PSDx</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Psd-126"><a href="#Psd-126"><span class="linenos">126</span></a>        <span class="n">PSDy</span> <span class="o">=</span> <span class="n">Fzy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fzy</span><span class="p">)</span>
</span><span id="Psd-127"><a href="#Psd-127"><span class="linenos">127</span></a>        <span class="n">RePSDy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">PSDy</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="Psd-128"><a href="#Psd-128"><span class="linenos">128</span></a>
</span><span id="Psd-129"><a href="#Psd-129"><span class="linenos">129</span></a>        <span class="n">Lx</span> <span class="o">=</span> <span class="n">Nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span>
</span><span id="Psd-130"><a href="#Psd-130"><span class="linenos">130</span></a>        <span class="n">Ly</span> <span class="o">=</span> <span class="n">Ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span>
</span><span id="Psd-131"><a href="#Psd-131"><span class="linenos">131</span></a>        <span class="n">RePSD</span> <span class="o">=</span> <span class="n">RePSD</span> <span class="o">*</span> <span class="p">(</span><span class="n">Lx</span> <span class="o">*</span> <span class="n">Ly</span><span class="p">)</span>  <span class="c1"># dimension length^4</span>
</span><span id="Psd-132"><a href="#Psd-132"><span class="linenos">132</span></a>        <span class="n">RePSDx</span> <span class="o">=</span> <span class="n">RePSDx</span> <span class="o">*</span> <span class="n">Lx</span>  <span class="c1"># dimension length^3</span>
</span><span id="Psd-133"><a href="#Psd-133"><span class="linenos">133</span></a>        <span class="n">RePSDy</span> <span class="o">=</span> <span class="n">RePSDy</span> <span class="o">*</span> <span class="n">Ly</span>
</span><span id="Psd-134"><a href="#Psd-134"><span class="linenos">134</span></a>        <span class="n">dfx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Lx</span>
</span><span id="Psd-135"><a href="#Psd-135"><span class="linenos">135</span></a>        <span class="n">dfy</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Ly</span>
</span><span id="Psd-136"><a href="#Psd-136"><span class="linenos">136</span></a>
</span><span id="Psd-137"><a href="#Psd-137"><span class="linenos">137</span></a>        <span class="n">fx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Nx</span><span class="p">))</span>
</span><span id="Psd-138"><a href="#Psd-138"><span class="linenos">138</span></a>        <span class="n">fy</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ny</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">))</span>
</span><span id="Psd-139"><a href="#Psd-139"><span class="linenos">139</span></a>
</span><span id="Psd-140"><a href="#Psd-140"><span class="linenos">140</span></a>        <span class="n">fx</span> <span class="o">=</span> <span class="n">fx</span> <span class="o">*</span> <span class="n">dfx</span>
</span><span id="Psd-141"><a href="#Psd-141"><span class="linenos">141</span></a>        <span class="n">fy</span> <span class="o">=</span> <span class="n">fy</span> <span class="o">*</span> <span class="n">dfy</span>
</span><span id="Psd-142"><a href="#Psd-142"><span class="linenos">142</span></a>
</span><span id="Psd-143"><a href="#Psd-143"><span class="linenos">143</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sq = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Z</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ny</span><span class="p">)))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd-144"><a href="#Psd-144"><span class="linenos">144</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;dfx: </span><span class="si">{</span><span class="n">dfx</span><span class="si">}</span><span class="s1"> dfy: </span><span class="si">{</span><span class="n">dfy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd-145"><a href="#Psd-145"><span class="linenos">145</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;from PSD: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RePSD</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfy</span><span class="p">))</span><span class="si">}</span><span class="s1"> Lx*Ly = </span><span class="si">{</span><span class="n">Lx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ly</span><span class="si">}</span><span class="s1"> Lx = </span><span class="si">{</span><span class="n">Lx</span><span class="si">}</span><span class="s1"> Ly = </span><span class="si">{</span><span class="n">Ly</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd-146"><a href="#Psd-146"><span class="linenos">146</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq x: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RePSDx</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfx</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd-147"><a href="#Psd-147"><span class="linenos">147</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq y: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RePSDy</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfy</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd-148"><a href="#Psd-148"><span class="linenos">148</span></a>
</span><span id="Psd-149"><a href="#Psd-149"><span class="linenos">149</span></a>        <span class="c1"># definition of PSD is Fourier*conj(Fourier) * Lx *Ly</span>
</span><span id="Psd-150"><a href="#Psd-150"><span class="linenos">150</span></a>        <span class="c1"># PSD has dimension length^4</span>
</span><span id="Psd-151"><a href="#Psd-151"><span class="linenos">151</span></a>        <span class="c1"># PSDx, PSDy have dimension length^3</span>
</span><span id="Psd-152"><a href="#Psd-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="o">=</span> <span class="n">RePSD</span>
</span><span id="Psd-153"><a href="#Psd-153"><span class="linenos">153</span></a>
</span><span id="Psd-154"><a href="#Psd-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">=</span> <span class="n">fx</span>
</span><span id="Psd-155"><a href="#Psd-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">=</span> <span class="n">fy</span>
</span><span id="Psd-156"><a href="#Psd-156"><span class="linenos">156</span></a>
</span><span id="Psd-157"><a href="#Psd-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdx</span> <span class="o">=</span> <span class="n">RePSDx</span>
</span><span id="Psd-158"><a href="#Psd-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdy</span> <span class="o">=</span> <span class="n">RePSDy</span>
</span><span id="Psd-159"><a href="#Psd-159"><span class="linenos">159</span></a>
</span><span id="Psd-160"><a href="#Psd-160"><span class="linenos">160</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Psd-161"><a href="#Psd-161"><span class="linenos">161</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="Psd-162"><a href="#Psd-162"><span class="linenos">162</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">RePSD</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">fx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="Psd-163"><a href="#Psd-163"><span class="linenos">163</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_x / \mu m^{-1}$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_y / \mu m^{-1}$&#39;</span><span class="p">)</span>
</span><span id="Psd-164"><a href="#Psd-164"><span class="linenos">164</span></a>
</span><span id="Psd-165"><a href="#Psd-165"><span class="linenos">165</span></a>            <span class="n">fig2</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Psd-166"><a href="#Psd-166"><span class="linenos">166</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdx</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">fx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">],</span>
</span><span id="Psd-167"><a href="#Psd-167"><span class="linenos">167</span></a>                      <span class="n">aspect</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">))</span>
</span><span id="Psd-168"><a href="#Psd-168"><span class="linenos">168</span></a>            <span class="n">bx</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdy</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span><span class="p">,</span> <span class="n">fy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="Psd-169"><a href="#Psd-169"><span class="linenos">169</span></a>                      <span class="n">aspect</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span> <span class="o">/</span> <span class="p">(</span><span class="n">fy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Psd-170"><a href="#Psd-170"><span class="linenos">170</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_x / \mu m^{-1}$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$y / \mu m$&#39;</span><span class="p">)</span>
</span><span id="Psd-171"><a href="#Psd-171"><span class="linenos">171</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">bx</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x / \mu m$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_y / \mu m^{-1}$&#39;</span><span class="p">)</span>
</span><span id="Psd-172"><a href="#Psd-172"><span class="linenos">172</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Psd-173"><a href="#Psd-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="n">RePSD</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">RePSDx</span><span class="p">,</span> <span class="n">fy</span><span class="p">,</span> <span class="n">RePSDy</span>
</span><span id="Psd-174"><a href="#Psd-174"><span class="linenos">174</span></a>
</span><span id="Psd-175"><a href="#Psd-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">polarSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fct</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Psd-176"><a href="#Psd-176"><span class="linenos">176</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Psd-177"><a href="#Psd-177"><span class="linenos">177</span></a><span class="sd">        Calculate the spectra in polar coordinates</span>
</span><span id="Psd-178"><a href="#Psd-178"><span class="linenos">178</span></a>
</span><span id="Psd-179"><a href="#Psd-179"><span class="linenos">179</span></a><span class="sd">        Parameters</span>
</span><span id="Psd-180"><a href="#Psd-180"><span class="linenos">180</span></a><span class="sd">        ----------</span>
</span><span id="Psd-181"><a href="#Psd-181"><span class="linenos">181</span></a><span class="sd">        df_fct: float</span>
</span><span id="Psd-182"><a href="#Psd-182"><span class="linenos">182</span></a><span class="sd">            The frequency resolution</span>
</span><span id="Psd-183"><a href="#Psd-183"><span class="linenos">183</span></a><span class="sd">        bplt: bool</span>
</span><span id="Psd-184"><a href="#Psd-184"><span class="linenos">184</span></a><span class="sd">            If true the spectra is plotted in a 3d projection axis</span>
</span><span id="Psd-185"><a href="#Psd-185"><span class="linenos">185</span></a>
</span><span id="Psd-186"><a href="#Psd-186"><span class="linenos">186</span></a><span class="sd">        Returns</span>
</span><span id="Psd-187"><a href="#Psd-187"><span class="linenos">187</span></a><span class="sd">        -------</span>
</span><span id="Psd-188"><a href="#Psd-188"><span class="linenos">188</span></a><span class="sd">        psdP: np.ndarray</span>
</span><span id="Psd-189"><a href="#Psd-189"><span class="linenos">189</span></a><span class="sd">            The polar spectra evaluated</span>
</span><span id="Psd-190"><a href="#Psd-190"><span class="linenos">190</span></a><span class="sd">        Fr, Th: np.array</span>
</span><span id="Psd-191"><a href="#Psd-191"><span class="linenos">191</span></a><span class="sd">            The polar coordinate vectors</span>
</span><span id="Psd-192"><a href="#Psd-192"><span class="linenos">192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Psd-193"><a href="#Psd-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polar spectra failed: psd has not been evaluated&#39;</span><span class="p">)</span>
</span><span id="Psd-194"><a href="#Psd-194"><span class="linenos">194</span></a>
</span><span id="Psd-195"><a href="#Psd-195"><span class="linenos">195</span></a>        <span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Psd-196"><a href="#Psd-196"><span class="linenos">196</span></a>        <span class="n">df_x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span><span class="p">)</span>
</span><span id="Psd-197"><a href="#Psd-197"><span class="linenos">197</span></a>        <span class="n">df_y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">)</span>
</span><span id="Psd-198"><a href="#Psd-198"><span class="linenos">198</span></a>        <span class="n">nxDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Psd-199"><a href="#Psd-199"><span class="linenos">199</span></a>        <span class="n">nyDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Psd-200"><a href="#Psd-200"><span class="linenos">200</span></a>
</span><span id="Psd-201"><a href="#Psd-201"><span class="linenos">201</span></a>        <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">df_x</span> <span class="o">*</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df_y</span> <span class="o">*</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Psd-202"><a href="#Psd-202"><span class="linenos">202</span></a>        <span class="n">fr0</span> <span class="o">=</span> <span class="n">df_fct</span> <span class="o">*</span> <span class="p">(</span><span class="n">df_x</span> <span class="o">+</span> <span class="n">df_y</span><span class="p">)</span>
</span><span id="Psd-203"><a href="#Psd-203"><span class="linenos">203</span></a>        <span class="n">fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">fr0</span><span class="p">,</span> <span class="n">frmax</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
</span><span id="Psd-204"><a href="#Psd-204"><span class="linenos">204</span></a>        <span class="c1">#    thetas = np.linspace(0.001, 2*np.pi, 360)</span>
</span><span id="Psd-205"><a href="#Psd-205"><span class="linenos">205</span></a>        <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">205</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><span id="Psd-206"><a href="#Psd-206"><span class="linenos">206</span></a>        <span class="n">Th</span><span class="p">,</span> <span class="n">Fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="n">fr</span><span class="p">)</span>
</span><span id="Psd-207"><a href="#Psd-207"><span class="linenos">207</span></a>        <span class="p">(</span><span class="n">nf</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span> <span class="o">=</span> <span class="n">Fr</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Psd-208"><a href="#Psd-208"><span class="linenos">208</span></a>        <span class="n">PSDp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nt</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e-4</span>
</span><span id="Psd-209"><a href="#Psd-209"><span class="linenos">209</span></a>        <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nf</span><span class="p">):</span>
</span><span id="Psd-210"><a href="#Psd-210"><span class="linenos">210</span></a>            <span class="n">frc</span> <span class="o">=</span> <span class="n">fr</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span>
</span><span id="Psd-211"><a href="#Psd-211"><span class="linenos">211</span></a>            <span class="k">for</span> <span class="n">ith</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nt</span><span class="p">):</span>
</span><span id="Psd-212"><a href="#Psd-212"><span class="linenos">212</span></a>                <span class="n">PSDp</span><span class="p">[</span><span class="n">ir</span><span class="p">][</span><span class="n">ith</span><span class="p">]</span> <span class="o">=</span> <span class="n">_eval_pinter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="p">,</span> <span class="n">df_x</span><span class="p">,</span> <span class="n">df_y</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">thetas</span><span class="p">[</span><span class="n">ith</span><span class="p">],</span> <span class="n">nxDC</span><span class="p">,</span> <span class="n">nyDC</span><span class="p">)</span>
</span><span id="Psd-213"><a href="#Psd-213"><span class="linenos">213</span></a>
</span><span id="Psd-214"><a href="#Psd-214"><span class="linenos">214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdp</span> <span class="o">=</span> <span class="n">PSDp</span>
</span><span id="Psd-215"><a href="#Psd-215"><span class="linenos">215</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Psd-216"><a href="#Psd-216"><span class="linenos">216</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;3d&#39;</span><span class="p">})</span>
</span><span id="Psd-217"><a href="#Psd-217"><span class="linenos">217</span></a>            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Fr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">),</span> <span class="n">Fr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
</span><span id="Psd-218"><a href="#Psd-218"><span class="linenos">218</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">PSDp</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gnuplot</span><span class="p">)</span>
</span><span id="Psd-219"><a href="#Psd-219"><span class="linenos">219</span></a>
</span><span id="Psd-220"><a href="#Psd-220"><span class="linenos">220</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Psd-221"><a href="#Psd-221"><span class="linenos">221</span></a>
</span><span id="Psd-222"><a href="#Psd-222"><span class="linenos">222</span></a>        <span class="k">return</span> <span class="n">PSDp</span><span class="p">,</span> <span class="n">Fr</span><span class="p">,</span> <span class="n">Th</span>
</span><span id="Psd-223"><a href="#Psd-223"><span class="linenos">223</span></a>
</span><span id="Psd-224"><a href="#Psd-224"><span class="linenos">224</span></a>    <span class="k">def</span> <span class="nf">angleIntegratedSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fct</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Psd-225"><a href="#Psd-225"><span class="linenos">225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Psd-226"><a href="#Psd-226"><span class="linenos">226</span></a><span class="sd">        Calculate the angle integrated spectra</span>
</span><span id="Psd-227"><a href="#Psd-227"><span class="linenos">227</span></a>
</span><span id="Psd-228"><a href="#Psd-228"><span class="linenos">228</span></a><span class="sd">        Parameters</span>
</span><span id="Psd-229"><a href="#Psd-229"><span class="linenos">229</span></a><span class="sd">        ----------</span>
</span><span id="Psd-230"><a href="#Psd-230"><span class="linenos">230</span></a><span class="sd">        df_fct: float</span>
</span><span id="Psd-231"><a href="#Psd-231"><span class="linenos">231</span></a><span class="sd">        bplt: bool</span>
</span><span id="Psd-232"><a href="#Psd-232"><span class="linenos">232</span></a><span class="sd">            If true the angle integrated spectra is plotted</span>
</span><span id="Psd-233"><a href="#Psd-233"><span class="linenos">233</span></a>
</span><span id="Psd-234"><a href="#Psd-234"><span class="linenos">234</span></a><span class="sd">        Returns</span>
</span><span id="Psd-235"><a href="#Psd-235"><span class="linenos">235</span></a><span class="sd">        -------</span>
</span><span id="Psd-236"><a href="#Psd-236"><span class="linenos">236</span></a><span class="sd">        psdP: np.ndarray</span>
</span><span id="Psd-237"><a href="#Psd-237"><span class="linenos">237</span></a><span class="sd">            The polar spectra evaluated</span>
</span><span id="Psd-238"><a href="#Psd-238"><span class="linenos">238</span></a><span class="sd">        Fr, Th: np.array</span>
</span><span id="Psd-239"><a href="#Psd-239"><span class="linenos">239</span></a><span class="sd">            The polar coordinate vectors</span>
</span><span id="Psd-240"><a href="#Psd-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Psd-241"><a href="#Psd-241"><span class="linenos">241</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Angle integrated spectra failed: psd has not been evaluated&#39;</span><span class="p">)</span>
</span><span id="Psd-242"><a href="#Psd-242"><span class="linenos">242</span></a>
</span><span id="Psd-243"><a href="#Psd-243"><span class="linenos">243</span></a>        <span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Psd-244"><a href="#Psd-244"><span class="linenos">244</span></a>        <span class="n">df_x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span><span class="p">)</span>
</span><span id="Psd-245"><a href="#Psd-245"><span class="linenos">245</span></a>        <span class="n">df_y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">)</span>
</span><span id="Psd-246"><a href="#Psd-246"><span class="linenos">246</span></a>        <span class="n">nxDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Psd-247"><a href="#Psd-247"><span class="linenos">247</span></a>        <span class="n">nyDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Psd-248"><a href="#Psd-248"><span class="linenos">248</span></a>
</span><span id="Psd-249"><a href="#Psd-249"><span class="linenos">249</span></a>        <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">df_x</span> <span class="o">*</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df_y</span> <span class="o">*</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Psd-250"><a href="#Psd-250"><span class="linenos">250</span></a>        <span class="n">fr0</span> <span class="o">=</span> <span class="n">df_fct</span> <span class="o">*</span> <span class="p">(</span><span class="n">df_x</span> <span class="o">+</span> <span class="n">df_y</span><span class="p">)</span>
</span><span id="Psd-251"><a href="#Psd-251"><span class="linenos">251</span></a>        <span class="n">fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fr0</span><span class="p">,</span> <span class="n">frmax</span><span class="p">,</span> <span class="n">fr0</span><span class="p">)</span>
</span><span id="Psd-252"><a href="#Psd-252"><span class="linenos">252</span></a>        <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fr</span><span class="p">)</span>
</span><span id="Psd-253"><a href="#Psd-253"><span class="linenos">253</span></a>        <span class="n">PSDr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
</span><span id="Psd-254"><a href="#Psd-254"><span class="linenos">254</span></a>        <span class="n">PSDav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
</span><span id="Psd-255"><a href="#Psd-255"><span class="linenos">255</span></a>        <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nf</span><span class="p">):</span>
</span><span id="Psd-256"><a href="#Psd-256"><span class="linenos">256</span></a>            <span class="n">frc</span> <span class="o">=</span> <span class="n">fr</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span>
</span><span id="Psd-257"><a href="#Psd-257"><span class="linenos">257</span></a>            <span class="n">nth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">frc</span> <span class="o">/</span> <span class="n">fr0</span><span class="p">))</span>
</span><span id="Psd-258"><a href="#Psd-258"><span class="linenos">258</span></a>            <span class="n">dth</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">nth</span>
</span><span id="Psd-259"><a href="#Psd-259"><span class="linenos">259</span></a>            <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">nth</span><span class="p">)</span>  <span class="c1"># + 0.1*np.pi</span>
</span><span id="Psd-260"><a href="#Psd-260"><span class="linenos">260</span></a>            <span class="n">dth</span> <span class="o">=</span> <span class="n">thetas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">thetas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Psd-261"><a href="#Psd-261"><span class="linenos">261</span></a>            <span class="n">psum</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Psd-262"><a href="#Psd-262"><span class="linenos">262</span></a>            <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">thetas</span><span class="p">:</span>
</span><span id="Psd-263"><a href="#Psd-263"><span class="linenos">263</span></a>                <span class="n">pinter</span> <span class="o">=</span> <span class="n">_eval_pinter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="p">,</span> <span class="n">df_x</span><span class="p">,</span> <span class="n">df_y</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">nxDC</span><span class="p">,</span> <span class="n">nyDC</span><span class="p">)</span>
</span><span id="Psd-264"><a href="#Psd-264"><span class="linenos">264</span></a>                <span class="n">psum</span> <span class="o">=</span> <span class="n">psum</span> <span class="o">+</span> <span class="n">pinter</span>
</span><span id="Psd-265"><a href="#Psd-265"><span class="linenos">265</span></a>            <span class="n">PSDav</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span> <span class="o">=</span> <span class="n">psum</span> <span class="o">/</span> <span class="n">nth</span>  <span class="c1"># dimension of height^2 * lateral^2 i.e. length^4</span>
</span><span id="Psd-266"><a href="#Psd-266"><span class="linenos">266</span></a>            <span class="n">PSDr</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span> <span class="o">=</span> <span class="n">dth</span> <span class="o">*</span> <span class="n">frc</span> <span class="o">*</span> <span class="n">psum</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># frc has dimension of 1 / lateral</span>
</span><span id="Psd-267"><a href="#Psd-267"><span class="linenos">267</span></a>            <span class="c1"># therefore PSDr: height^2 * lateral</span>
</span><span id="Psd-268"><a href="#Psd-268"><span class="linenos">268</span></a>        <span class="c1"># PSDr = PSDr * fr0</span>
</span><span id="Psd-269"><a href="#Psd-269"><span class="linenos">269</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq r: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">PSDr</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fr0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd-270"><a href="#Psd-270"><span class="linenos">270</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq r: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">PSDav</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fr</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fr0</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd-271"><a href="#Psd-271"><span class="linenos">271</span></a>
</span><span id="Psd-272"><a href="#Psd-272"><span class="linenos">272</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Psd-273"><a href="#Psd-273"><span class="linenos">273</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="Psd-274"><a href="#Psd-274"><span class="linenos">274</span></a>            <span class="c1"># ax.loglog(fr, PSDr, &#39;bx-&#39;, markersize=3)</span>
</span><span id="Psd-275"><a href="#Psd-275"><span class="linenos">275</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">PSDav</span><span class="p">,</span> <span class="s1">&#39;rx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="Psd-276"><a href="#Psd-276"><span class="linenos">276</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average over all polar angles&#39;</span><span class="p">)</span>
</span><span id="Psd-277"><a href="#Psd-277"><span class="linenos">277</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Psd-278"><a href="#Psd-278"><span class="linenos">278</span></a>
</span><span id="Psd-279"><a href="#Psd-279"><span class="linenos">279</span></a>        <span class="k">return</span> <span class="n">PSDr</span><span class="p">,</span> <span class="n">PSDav</span><span class="p">,</span> <span class="n">fr</span><span class="p">,</span> <span class="n">fr0</span>
</span><span id="Psd-280"><a href="#Psd-280"><span class="linenos">280</span></a>
</span><span id="Psd-281"><a href="#Psd-281"><span class="linenos">281</span></a>    <span class="k">def</span> <span class="nf">averageSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Psd-282"><a href="#Psd-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Psd-283"><a href="#Psd-283"><span class="linenos">283</span></a><span class="sd">        Calculate the average specra in the x and y directions</span>
</span><span id="Psd-284"><a href="#Psd-284"><span class="linenos">284</span></a>
</span><span id="Psd-285"><a href="#Psd-285"><span class="linenos">285</span></a><span class="sd">        Parameters</span>
</span><span id="Psd-286"><a href="#Psd-286"><span class="linenos">286</span></a><span class="sd">        ----------</span>
</span><span id="Psd-287"><a href="#Psd-287"><span class="linenos">287</span></a><span class="sd">        bplt: bool</span>
</span><span id="Psd-288"><a href="#Psd-288"><span class="linenos">288</span></a><span class="sd">            Plots the mean spectra if true</span>
</span><span id="Psd-289"><a href="#Psd-289"><span class="linenos">289</span></a>
</span><span id="Psd-290"><a href="#Psd-290"><span class="linenos">290</span></a><span class="sd">        Returns</span>
</span><span id="Psd-291"><a href="#Psd-291"><span class="linenos">291</span></a><span class="sd">        -------</span>
</span><span id="Psd-292"><a href="#Psd-292"><span class="linenos">292</span></a><span class="sd">        psdMeanx, psdMeany: np.array</span>
</span><span id="Psd-293"><a href="#Psd-293"><span class="linenos">293</span></a><span class="sd">            The mean psd arrays</span>
</span><span id="Psd-294"><a href="#Psd-294"><span class="linenos">294</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Psd-295"><a href="#Psd-295"><span class="linenos">295</span></a>        <span class="n">PSDxmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Psd-296"><a href="#Psd-296"><span class="linenos">296</span></a>        <span class="n">PSDymean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Psd-297"><a href="#Psd-297"><span class="linenos">297</span></a>
</span><span id="Psd-298"><a href="#Psd-298"><span class="linenos">298</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Psd-299"><a href="#Psd-299"><span class="linenos">299</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">),</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">dx</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Psd-300"><a href="#Psd-300"><span class="linenos">300</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">,</span> <span class="n">PSDxmean</span><span class="p">,</span> <span class="s1">&#39;rx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDx in x dir&#39;</span><span class="p">)</span>
</span><span id="Psd-301"><a href="#Psd-301"><span class="linenos">301</span></a>            <span class="n">bx</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span><span class="p">,</span> <span class="n">PSDymean</span><span class="p">,</span> <span class="s1">&#39;kx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDy in y dir&#39;</span><span class="p">)</span>
</span><span id="Psd-302"><a href="#Psd-302"><span class="linenos">302</span></a>
</span><span id="Psd-303"><a href="#Psd-303"><span class="linenos">303</span></a>            <span class="n">cx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">,</span> <span class="n">PSDxmean</span><span class="p">,</span> <span class="s1">&#39;rx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDx in x dir&#39;</span><span class="p">)</span>
</span><span id="Psd-304"><a href="#Psd-304"><span class="linenos">304</span></a>            <span class="n">dx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span><span class="p">,</span> <span class="n">PSDymean</span><span class="p">,</span> <span class="s1">&#39;kx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDy in y dir&#39;</span><span class="p">)</span>
</span><span id="Psd-305"><a href="#Psd-305"><span class="linenos">305</span></a>
</span><span id="Psd-306"><a href="#Psd-306"><span class="linenos">306</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f$ in $\frac</span><span class="si">{1}</span><span class="s1">{\mu m}$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;PSD in $\mu m^3$&#39;</span><span class="p">)</span>
</span><span id="Psd-307"><a href="#Psd-307"><span class="linenos">307</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="Psd-308"><a href="#Psd-308"><span class="linenos">308</span></a>            
</span><span id="Psd-309"><a href="#Psd-309"><span class="linenos">309</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Psd-310"><a href="#Psd-310"><span class="linenos">310</span></a>
</span><span id="Psd-311"><a href="#Psd-311"><span class="linenos">311</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">PSDxmean</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">PSDymean</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Class that provides the data structure and methods for PSD
calculation.</p>
</div>


                            <div id="Psd.__init__" class="classattr">
                                        <input id="Psd.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Psd</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="Psd.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Psd.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Psd.__init__-62"><a href="#Psd.__init__-62"><span class="linenos">62</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Psd.__init__-63"><a href="#Psd.__init__-63"><span class="linenos">63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate an empty psd object&quot;&quot;&quot;</span>
</span><span id="Psd.__init__-64"><a href="#Psd.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd.__init__-65"><a href="#Psd.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd.__init__-66"><a href="#Psd.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd.__init__-67"><a href="#Psd.__init__-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdp</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># polar spectra</span>
</span><span id="Psd.__init__-68"><a href="#Psd.__init__-68"><span class="linenos">68</span></a>
</span><span id="Psd.__init__-69"><a href="#Psd.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd.__init__-70"><a href="#Psd.__init__-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd.__init__-71"><a href="#Psd.__init__-71"><span class="linenos">71</span></a>
</span><span id="Psd.__init__-72"><a href="#Psd.__init__-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdx</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Psd.__init__-73"><a href="#Psd.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdy</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Instantiate an empty psd object</p>
</div>


                            </div>
                            <div id="Psd.deltaX" class="classattr">
                                <div class="attr variable">
            <span class="name">deltaX</span>

        
    </div>
    <a class="headerlink" href="#Psd.deltaX"></a>
    
    

                            </div>
                            <div id="Psd.deltaY" class="classattr">
                                <div class="attr variable">
            <span class="name">deltaY</span>

        
    </div>
    <a class="headerlink" href="#Psd.deltaY"></a>
    
    

                            </div>
                            <div id="Psd.psd" class="classattr">
                                <div class="attr variable">
            <span class="name">psd</span>

        
    </div>
    <a class="headerlink" href="#Psd.psd"></a>
    
    

                            </div>
                            <div id="Psd.psdp" class="classattr">
                                <div class="attr variable">
            <span class="name">psdp</span>

        
    </div>
    <a class="headerlink" href="#Psd.psdp"></a>
    
    

                            </div>
                            <div id="Psd.fx" class="classattr">
                                <div class="attr variable">
            <span class="name">fx</span>

        
    </div>
    <a class="headerlink" href="#Psd.fx"></a>
    
    

                            </div>
                            <div id="Psd.fy" class="classattr">
                                <div class="attr variable">
            <span class="name">fy</span>

        
    </div>
    <a class="headerlink" href="#Psd.fy"></a>
    
    

                            </div>
                            <div id="Psd.psdx" class="classattr">
                                <div class="attr variable">
            <span class="name">psdx</span>

        
    </div>
    <a class="headerlink" href="#Psd.psdx"></a>
    
    

                            </div>
                            <div id="Psd.psdy" class="classattr">
                                <div class="attr variable">
            <span class="name">psdy</span>

        
    </div>
    <a class="headerlink" href="#Psd.psdy"></a>
    
    

                            </div>
                            <div id="Psd.evalPsd" class="classattr">
                                        <input id="Psd.evalPsd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">evalPsd</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">obj</span><span class="p">:</span> <span class="n"><a href="surface.html#Surface">surfile.surface.Surface</a></span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Psd.evalPsd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Psd.evalPsd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Psd.evalPsd-75"><a href="#Psd.evalPsd-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="nf">evalPsd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Psd.evalPsd-76"><a href="#Psd.evalPsd-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Psd.evalPsd-77"><a href="#Psd.evalPsd-77"><span class="linenos"> 77</span></a><span class="sd">        Evaluate the power spectral density of the topography</span>
</span><span id="Psd.evalPsd-78"><a href="#Psd.evalPsd-78"><span class="linenos"> 78</span></a>
</span><span id="Psd.evalPsd-79"><a href="#Psd.evalPsd-79"><span class="linenos"> 79</span></a><span class="sd">        Parameters</span>
</span><span id="Psd.evalPsd-80"><a href="#Psd.evalPsd-80"><span class="linenos"> 80</span></a><span class="sd">        ----------</span>
</span><span id="Psd.evalPsd-81"><a href="#Psd.evalPsd-81"><span class="linenos"> 81</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="Psd.evalPsd-82"><a href="#Psd.evalPsd-82"><span class="linenos"> 82</span></a><span class="sd">            The topography</span>
</span><span id="Psd.evalPsd-83"><a href="#Psd.evalPsd-83"><span class="linenos"> 83</span></a><span class="sd">        bplt: bool</span>
</span><span id="Psd.evalPsd-84"><a href="#Psd.evalPsd-84"><span class="linenos"> 84</span></a><span class="sd">            If True plots the PSD result</span>
</span><span id="Psd.evalPsd-85"><a href="#Psd.evalPsd-85"><span class="linenos"> 85</span></a>
</span><span id="Psd.evalPsd-86"><a href="#Psd.evalPsd-86"><span class="linenos"> 86</span></a><span class="sd">        Returns</span>
</span><span id="Psd.evalPsd-87"><a href="#Psd.evalPsd-87"><span class="linenos"> 87</span></a><span class="sd">        ----------</span>
</span><span id="Psd.evalPsd-88"><a href="#Psd.evalPsd-88"><span class="linenos"> 88</span></a><span class="sd">        psd: np.ndarray</span>
</span><span id="Psd.evalPsd-89"><a href="#Psd.evalPsd-89"><span class="linenos"> 89</span></a><span class="sd">            The calculated psd of the surface</span>
</span><span id="Psd.evalPsd-90"><a href="#Psd.evalPsd-90"><span class="linenos"> 90</span></a><span class="sd">        fx, fy: np.array</span>
</span><span id="Psd.evalPsd-91"><a href="#Psd.evalPsd-91"><span class="linenos"> 91</span></a><span class="sd">            The x and y axis of the psd</span>
</span><span id="Psd.evalPsd-92"><a href="#Psd.evalPsd-92"><span class="linenos"> 92</span></a><span class="sd">        psd_x, psd_y: np.ndarray</span>
</span><span id="Psd.evalPsd-93"><a href="#Psd.evalPsd-93"><span class="linenos"> 93</span></a><span class="sd">            The psd along the given axis</span>
</span><span id="Psd.evalPsd-94"><a href="#Psd.evalPsd-94"><span class="linenos"> 94</span></a><span class="sd">            </span>
</span><span id="Psd.evalPsd-95"><a href="#Psd.evalPsd-95"><span class="linenos"> 95</span></a><span class="sd">        Notes</span>
</span><span id="Psd.evalPsd-96"><a href="#Psd.evalPsd-96"><span class="linenos"> 96</span></a><span class="sd">        -----</span>
</span><span id="Psd.evalPsd-97"><a href="#Psd.evalPsd-97"><span class="linenos"> 97</span></a><span class="sd">        The power spectral density (PSD) function gives indication on  the strength </span>
</span><span id="Psd.evalPsd-98"><a href="#Psd.evalPsd-98"><span class="linenos"> 98</span></a><span class="sd">        of different frequency components  as function of the spatial frequency and </span>
</span><span id="Psd.evalPsd-99"><a href="#Psd.evalPsd-99"><span class="linenos"> 99</span></a><span class="sd">        is calculated from the absolute value of the square of the Fourier transform </span>
</span><span id="Psd.evalPsd-100"><a href="#Psd.evalPsd-100"><span class="linenos">100</span></a><span class="sd">        of the height values z(x,y).</span>
</span><span id="Psd.evalPsd-101"><a href="#Psd.evalPsd-101"><span class="linenos">101</span></a><span class="sd">        The areal Fourier transform is given by:\n</span>
</span><span id="Psd.evalPsd-102"><a href="#Psd.evalPsd-102"><span class="linenos">102</span></a><span class="sd">        $</span>
</span><span id="Psd.evalPsd-103"><a href="#Psd.evalPsd-103"><span class="linenos">103</span></a><span class="sd">        \\begin{equation}</span>
</span><span id="Psd.evalPsd-104"><a href="#Psd.evalPsd-104"><span class="linenos">104</span></a><span class="sd">        F_z(f_x,f_y)=\\lim_{L_x \\to \\infty}\\lim_{Ly \\to \\infty} \\frac{1}{L_x L_y}\int_{-L_y/2}^{L_y/2}\\int_{-L_x/2}^{L_x/2}z(x,y)e^{[-i2\\pi(f_xx+f_yy)]}dxdy</span>
</span><span id="Psd.evalPsd-105"><a href="#Psd.evalPsd-105"><span class="linenos">105</span></a><span class="sd">        \\end{equation}</span>
</span><span id="Psd.evalPsd-106"><a href="#Psd.evalPsd-106"><span class="linenos">106</span></a><span class="sd">        $\n</span>
</span><span id="Psd.evalPsd-107"><a href="#Psd.evalPsd-107"><span class="linenos">107</span></a><span class="sd">        The Power Spectral Density is then calculated as:\n</span>
</span><span id="Psd.evalPsd-108"><a href="#Psd.evalPsd-108"><span class="linenos">108</span></a><span class="sd">        $</span>
</span><span id="Psd.evalPsd-109"><a href="#Psd.evalPsd-109"><span class="linenos">109</span></a><span class="sd">        \\begin{equation}</span>
</span><span id="Psd.evalPsd-110"><a href="#Psd.evalPsd-110"><span class="linenos">110</span></a><span class="sd">            P(f_x,f_y)=\\frac{d}{df_x}\\frac{d}{df_y}F_z^*(f_x,f_y)F_z(f_x,f_y)</span>
</span><span id="Psd.evalPsd-111"><a href="#Psd.evalPsd-111"><span class="linenos">111</span></a><span class="sd">        \\end{equation}</span>
</span><span id="Psd.evalPsd-112"><a href="#Psd.evalPsd-112"><span class="linenos">112</span></a><span class="sd">        $</span>
</span><span id="Psd.evalPsd-113"><a href="#Psd.evalPsd-113"><span class="linenos">113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Psd.evalPsd-114"><a href="#Psd.evalPsd-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</span><span id="Psd.evalPsd-115"><a href="#Psd.evalPsd-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</span><span id="Psd.evalPsd-116"><a href="#Psd.evalPsd-116"><span class="linenos">116</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="Psd.evalPsd-117"><a href="#Psd.evalPsd-117"><span class="linenos">117</span></a>        <span class="p">(</span><span class="n">Ny</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Psd.evalPsd-118"><a href="#Psd.evalPsd-118"><span class="linenos">118</span></a>
</span><span id="Psd.evalPsd-119"><a href="#Psd.evalPsd-119"><span class="linenos">119</span></a>        <span class="n">Fz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Nx</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">))</span>  <span class="c1"># dimension of a height or length</span>
</span><span id="Psd.evalPsd-120"><a href="#Psd.evalPsd-120"><span class="linenos">120</span></a>        <span class="n">Fzx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Nx</span><span class="p">))</span>  <span class="c1"># dimension length</span>
</span><span id="Psd.evalPsd-121"><a href="#Psd.evalPsd-121"><span class="linenos">121</span></a>        <span class="n">Fzy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Ny</span><span class="p">))</span>
</span><span id="Psd.evalPsd-122"><a href="#Psd.evalPsd-122"><span class="linenos">122</span></a>        <span class="n">PSD</span> <span class="o">=</span> <span class="n">Fz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fz</span><span class="p">)</span>
</span><span id="Psd.evalPsd-123"><a href="#Psd.evalPsd-123"><span class="linenos">123</span></a>        <span class="n">RePSD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">PSD</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</span><span id="Psd.evalPsd-124"><a href="#Psd.evalPsd-124"><span class="linenos">124</span></a>        <span class="n">PSDx</span> <span class="o">=</span> <span class="n">Fzx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fzx</span><span class="p">)</span>
</span><span id="Psd.evalPsd-125"><a href="#Psd.evalPsd-125"><span class="linenos">125</span></a>        <span class="n">RePSDx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">PSDx</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Psd.evalPsd-126"><a href="#Psd.evalPsd-126"><span class="linenos">126</span></a>        <span class="n">PSDy</span> <span class="o">=</span> <span class="n">Fzy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fzy</span><span class="p">)</span>
</span><span id="Psd.evalPsd-127"><a href="#Psd.evalPsd-127"><span class="linenos">127</span></a>        <span class="n">RePSDy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">PSDy</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="Psd.evalPsd-128"><a href="#Psd.evalPsd-128"><span class="linenos">128</span></a>
</span><span id="Psd.evalPsd-129"><a href="#Psd.evalPsd-129"><span class="linenos">129</span></a>        <span class="n">Lx</span> <span class="o">=</span> <span class="n">Nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span>
</span><span id="Psd.evalPsd-130"><a href="#Psd.evalPsd-130"><span class="linenos">130</span></a>        <span class="n">Ly</span> <span class="o">=</span> <span class="n">Ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span>
</span><span id="Psd.evalPsd-131"><a href="#Psd.evalPsd-131"><span class="linenos">131</span></a>        <span class="n">RePSD</span> <span class="o">=</span> <span class="n">RePSD</span> <span class="o">*</span> <span class="p">(</span><span class="n">Lx</span> <span class="o">*</span> <span class="n">Ly</span><span class="p">)</span>  <span class="c1"># dimension length^4</span>
</span><span id="Psd.evalPsd-132"><a href="#Psd.evalPsd-132"><span class="linenos">132</span></a>        <span class="n">RePSDx</span> <span class="o">=</span> <span class="n">RePSDx</span> <span class="o">*</span> <span class="n">Lx</span>  <span class="c1"># dimension length^3</span>
</span><span id="Psd.evalPsd-133"><a href="#Psd.evalPsd-133"><span class="linenos">133</span></a>        <span class="n">RePSDy</span> <span class="o">=</span> <span class="n">RePSDy</span> <span class="o">*</span> <span class="n">Ly</span>
</span><span id="Psd.evalPsd-134"><a href="#Psd.evalPsd-134"><span class="linenos">134</span></a>        <span class="n">dfx</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Lx</span>
</span><span id="Psd.evalPsd-135"><a href="#Psd.evalPsd-135"><span class="linenos">135</span></a>        <span class="n">dfy</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Ly</span>
</span><span id="Psd.evalPsd-136"><a href="#Psd.evalPsd-136"><span class="linenos">136</span></a>
</span><span id="Psd.evalPsd-137"><a href="#Psd.evalPsd-137"><span class="linenos">137</span></a>        <span class="n">fx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nx</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Nx</span><span class="p">))</span>
</span><span id="Psd.evalPsd-138"><a href="#Psd.evalPsd-138"><span class="linenos">138</span></a>        <span class="n">fy</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ny</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ny</span><span class="p">))</span>
</span><span id="Psd.evalPsd-139"><a href="#Psd.evalPsd-139"><span class="linenos">139</span></a>
</span><span id="Psd.evalPsd-140"><a href="#Psd.evalPsd-140"><span class="linenos">140</span></a>        <span class="n">fx</span> <span class="o">=</span> <span class="n">fx</span> <span class="o">*</span> <span class="n">dfx</span>
</span><span id="Psd.evalPsd-141"><a href="#Psd.evalPsd-141"><span class="linenos">141</span></a>        <span class="n">fy</span> <span class="o">=</span> <span class="n">fy</span> <span class="o">*</span> <span class="n">dfy</span>
</span><span id="Psd.evalPsd-142"><a href="#Psd.evalPsd-142"><span class="linenos">142</span></a>
</span><span id="Psd.evalPsd-143"><a href="#Psd.evalPsd-143"><span class="linenos">143</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sq = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Z</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">Nx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ny</span><span class="p">)))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd.evalPsd-144"><a href="#Psd.evalPsd-144"><span class="linenos">144</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;dfx: </span><span class="si">{</span><span class="n">dfx</span><span class="si">}</span><span class="s1"> dfy: </span><span class="si">{</span><span class="n">dfy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd.evalPsd-145"><a href="#Psd.evalPsd-145"><span class="linenos">145</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;from PSD: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">RePSD</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfy</span><span class="p">))</span><span class="si">}</span><span class="s1"> Lx*Ly = </span><span class="si">{</span><span class="n">Lx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ly</span><span class="si">}</span><span class="s1"> Lx = </span><span class="si">{</span><span class="n">Lx</span><span class="si">}</span><span class="s1"> Ly = </span><span class="si">{</span><span class="n">Ly</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd.evalPsd-146"><a href="#Psd.evalPsd-146"><span class="linenos">146</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq x: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RePSDx</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfx</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd.evalPsd-147"><a href="#Psd.evalPsd-147"><span class="linenos">147</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq y: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RePSDy</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dfy</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd.evalPsd-148"><a href="#Psd.evalPsd-148"><span class="linenos">148</span></a>
</span><span id="Psd.evalPsd-149"><a href="#Psd.evalPsd-149"><span class="linenos">149</span></a>        <span class="c1"># definition of PSD is Fourier*conj(Fourier) * Lx *Ly</span>
</span><span id="Psd.evalPsd-150"><a href="#Psd.evalPsd-150"><span class="linenos">150</span></a>        <span class="c1"># PSD has dimension length^4</span>
</span><span id="Psd.evalPsd-151"><a href="#Psd.evalPsd-151"><span class="linenos">151</span></a>        <span class="c1"># PSDx, PSDy have dimension length^3</span>
</span><span id="Psd.evalPsd-152"><a href="#Psd.evalPsd-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="o">=</span> <span class="n">RePSD</span>
</span><span id="Psd.evalPsd-153"><a href="#Psd.evalPsd-153"><span class="linenos">153</span></a>
</span><span id="Psd.evalPsd-154"><a href="#Psd.evalPsd-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">=</span> <span class="n">fx</span>
</span><span id="Psd.evalPsd-155"><a href="#Psd.evalPsd-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">=</span> <span class="n">fy</span>
</span><span id="Psd.evalPsd-156"><a href="#Psd.evalPsd-156"><span class="linenos">156</span></a>
</span><span id="Psd.evalPsd-157"><a href="#Psd.evalPsd-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdx</span> <span class="o">=</span> <span class="n">RePSDx</span>
</span><span id="Psd.evalPsd-158"><a href="#Psd.evalPsd-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdy</span> <span class="o">=</span> <span class="n">RePSDy</span>
</span><span id="Psd.evalPsd-159"><a href="#Psd.evalPsd-159"><span class="linenos">159</span></a>
</span><span id="Psd.evalPsd-160"><a href="#Psd.evalPsd-160"><span class="linenos">160</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Psd.evalPsd-161"><a href="#Psd.evalPsd-161"><span class="linenos">161</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="Psd.evalPsd-162"><a href="#Psd.evalPsd-162"><span class="linenos">162</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">RePSD</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">fx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="Psd.evalPsd-163"><a href="#Psd.evalPsd-163"><span class="linenos">163</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_x / \mu m^{-1}$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_y / \mu m^{-1}$&#39;</span><span class="p">)</span>
</span><span id="Psd.evalPsd-164"><a href="#Psd.evalPsd-164"><span class="linenos">164</span></a>
</span><span id="Psd.evalPsd-165"><a href="#Psd.evalPsd-165"><span class="linenos">165</span></a>            <span class="n">fig2</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Psd.evalPsd-166"><a href="#Psd.evalPsd-166"><span class="linenos">166</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdx</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">fx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">],</span>
</span><span id="Psd.evalPsd-167"><a href="#Psd.evalPsd-167"><span class="linenos">167</span></a>                      <span class="n">aspect</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">Ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">))</span>
</span><span id="Psd.evalPsd-168"><a href="#Psd.evalPsd-168"><span class="linenos">168</span></a>            <span class="n">bx</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdy</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span><span class="p">,</span> <span class="n">fy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
</span><span id="Psd.evalPsd-169"><a href="#Psd.evalPsd-169"><span class="linenos">169</span></a>                      <span class="n">aspect</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span> <span class="o">/</span> <span class="p">(</span><span class="n">fy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Psd.evalPsd-170"><a href="#Psd.evalPsd-170"><span class="linenos">170</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_x / \mu m^{-1}$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$y / \mu m$&#39;</span><span class="p">)</span>
</span><span id="Psd.evalPsd-171"><a href="#Psd.evalPsd-171"><span class="linenos">171</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">bx</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$x / \mu m$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f_y / \mu m^{-1}$&#39;</span><span class="p">)</span>
</span><span id="Psd.evalPsd-172"><a href="#Psd.evalPsd-172"><span class="linenos">172</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Psd.evalPsd-173"><a href="#Psd.evalPsd-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="n">RePSD</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">RePSDx</span><span class="p">,</span> <span class="n">fy</span><span class="p">,</span> <span class="n">RePSDy</span>
</span></pre></div>


            <div class="docstring"><p>Evaluate the power spectral density of the topography</p>

<h2 id="parameters">Parameters</h2>

<p>obj: surface.Surface
    The topography
bplt: bool
    If True plots the PSD result</p>

<h2 id="returns">Returns</h2>

<p>psd: np.ndarray
    The calculated psd of the surface
fx, fy: np.array
    The x and y axis of the psd
psd_x, psd_y: np.ndarray
    The psd along the given axis</p>

<h2 id="notes">Notes</h2>

<p>The power spectral density (PSD) function gives indication on  the strength 
of different frequency components  as function of the spatial frequency and 
is calculated from the absolute value of the square of the Fourier transform 
of the height values z(x,y).
The areal Fourier transform is given by:</p>

<p>$
\begin{equation}
F_z(f_x,f_y)=\lim_{L_x \to \infty}\lim_{Ly \to \infty} \frac{1}{L_x L_y}\int_{-L_y/2}^{L_y/2}\int_{-L_x/2}^{L_x/2}z(x,y)e^{[-i2\pi(f_xx+f_yy)]}dxdy
\end{equation}
$</p>

<p>The Power Spectral Density is then calculated as:</p>

<p>$
\begin{equation}
    P(f_x,f_y)=\frac{d}{df_x}\frac{d}{df_y}F_z^*(f_x,f_y)F_z(f_x,f_y)
\end{equation}
$</p>
</div>


                            </div>
                            <div id="Psd.polarSpectra" class="classattr">
                                        <input id="Psd.polarSpectra-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">polarSpectra</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df_fct</span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Psd.polarSpectra-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Psd.polarSpectra"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Psd.polarSpectra-175"><a href="#Psd.polarSpectra-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">polarSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fct</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Psd.polarSpectra-176"><a href="#Psd.polarSpectra-176"><span class="linenos">176</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Psd.polarSpectra-177"><a href="#Psd.polarSpectra-177"><span class="linenos">177</span></a><span class="sd">        Calculate the spectra in polar coordinates</span>
</span><span id="Psd.polarSpectra-178"><a href="#Psd.polarSpectra-178"><span class="linenos">178</span></a>
</span><span id="Psd.polarSpectra-179"><a href="#Psd.polarSpectra-179"><span class="linenos">179</span></a><span class="sd">        Parameters</span>
</span><span id="Psd.polarSpectra-180"><a href="#Psd.polarSpectra-180"><span class="linenos">180</span></a><span class="sd">        ----------</span>
</span><span id="Psd.polarSpectra-181"><a href="#Psd.polarSpectra-181"><span class="linenos">181</span></a><span class="sd">        df_fct: float</span>
</span><span id="Psd.polarSpectra-182"><a href="#Psd.polarSpectra-182"><span class="linenos">182</span></a><span class="sd">            The frequency resolution</span>
</span><span id="Psd.polarSpectra-183"><a href="#Psd.polarSpectra-183"><span class="linenos">183</span></a><span class="sd">        bplt: bool</span>
</span><span id="Psd.polarSpectra-184"><a href="#Psd.polarSpectra-184"><span class="linenos">184</span></a><span class="sd">            If true the spectra is plotted in a 3d projection axis</span>
</span><span id="Psd.polarSpectra-185"><a href="#Psd.polarSpectra-185"><span class="linenos">185</span></a>
</span><span id="Psd.polarSpectra-186"><a href="#Psd.polarSpectra-186"><span class="linenos">186</span></a><span class="sd">        Returns</span>
</span><span id="Psd.polarSpectra-187"><a href="#Psd.polarSpectra-187"><span class="linenos">187</span></a><span class="sd">        -------</span>
</span><span id="Psd.polarSpectra-188"><a href="#Psd.polarSpectra-188"><span class="linenos">188</span></a><span class="sd">        psdP: np.ndarray</span>
</span><span id="Psd.polarSpectra-189"><a href="#Psd.polarSpectra-189"><span class="linenos">189</span></a><span class="sd">            The polar spectra evaluated</span>
</span><span id="Psd.polarSpectra-190"><a href="#Psd.polarSpectra-190"><span class="linenos">190</span></a><span class="sd">        Fr, Th: np.array</span>
</span><span id="Psd.polarSpectra-191"><a href="#Psd.polarSpectra-191"><span class="linenos">191</span></a><span class="sd">            The polar coordinate vectors</span>
</span><span id="Psd.polarSpectra-192"><a href="#Psd.polarSpectra-192"><span class="linenos">192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Psd.polarSpectra-193"><a href="#Psd.polarSpectra-193"><span class="linenos">193</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Polar spectra failed: psd has not been evaluated&#39;</span><span class="p">)</span>
</span><span id="Psd.polarSpectra-194"><a href="#Psd.polarSpectra-194"><span class="linenos">194</span></a>
</span><span id="Psd.polarSpectra-195"><a href="#Psd.polarSpectra-195"><span class="linenos">195</span></a>        <span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Psd.polarSpectra-196"><a href="#Psd.polarSpectra-196"><span class="linenos">196</span></a>        <span class="n">df_x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span><span class="p">)</span>
</span><span id="Psd.polarSpectra-197"><a href="#Psd.polarSpectra-197"><span class="linenos">197</span></a>        <span class="n">df_y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">)</span>
</span><span id="Psd.polarSpectra-198"><a href="#Psd.polarSpectra-198"><span class="linenos">198</span></a>        <span class="n">nxDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Psd.polarSpectra-199"><a href="#Psd.polarSpectra-199"><span class="linenos">199</span></a>        <span class="n">nyDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Psd.polarSpectra-200"><a href="#Psd.polarSpectra-200"><span class="linenos">200</span></a>
</span><span id="Psd.polarSpectra-201"><a href="#Psd.polarSpectra-201"><span class="linenos">201</span></a>        <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">df_x</span> <span class="o">*</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df_y</span> <span class="o">*</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Psd.polarSpectra-202"><a href="#Psd.polarSpectra-202"><span class="linenos">202</span></a>        <span class="n">fr0</span> <span class="o">=</span> <span class="n">df_fct</span> <span class="o">*</span> <span class="p">(</span><span class="n">df_x</span> <span class="o">+</span> <span class="n">df_y</span><span class="p">)</span>
</span><span id="Psd.polarSpectra-203"><a href="#Psd.polarSpectra-203"><span class="linenos">203</span></a>        <span class="n">fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">fr0</span><span class="p">,</span> <span class="n">frmax</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
</span><span id="Psd.polarSpectra-204"><a href="#Psd.polarSpectra-204"><span class="linenos">204</span></a>        <span class="c1">#    thetas = np.linspace(0.001, 2*np.pi, 360)</span>
</span><span id="Psd.polarSpectra-205"><a href="#Psd.polarSpectra-205"><span class="linenos">205</span></a>        <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">205</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><span id="Psd.polarSpectra-206"><a href="#Psd.polarSpectra-206"><span class="linenos">206</span></a>        <span class="n">Th</span><span class="p">,</span> <span class="n">Fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">thetas</span><span class="p">,</span> <span class="n">fr</span><span class="p">)</span>
</span><span id="Psd.polarSpectra-207"><a href="#Psd.polarSpectra-207"><span class="linenos">207</span></a>        <span class="p">(</span><span class="n">nf</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span> <span class="o">=</span> <span class="n">Fr</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Psd.polarSpectra-208"><a href="#Psd.polarSpectra-208"><span class="linenos">208</span></a>        <span class="n">PSDp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nt</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e-4</span>
</span><span id="Psd.polarSpectra-209"><a href="#Psd.polarSpectra-209"><span class="linenos">209</span></a>        <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nf</span><span class="p">):</span>
</span><span id="Psd.polarSpectra-210"><a href="#Psd.polarSpectra-210"><span class="linenos">210</span></a>            <span class="n">frc</span> <span class="o">=</span> <span class="n">fr</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span>
</span><span id="Psd.polarSpectra-211"><a href="#Psd.polarSpectra-211"><span class="linenos">211</span></a>            <span class="k">for</span> <span class="n">ith</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nt</span><span class="p">):</span>
</span><span id="Psd.polarSpectra-212"><a href="#Psd.polarSpectra-212"><span class="linenos">212</span></a>                <span class="n">PSDp</span><span class="p">[</span><span class="n">ir</span><span class="p">][</span><span class="n">ith</span><span class="p">]</span> <span class="o">=</span> <span class="n">_eval_pinter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="p">,</span> <span class="n">df_x</span><span class="p">,</span> <span class="n">df_y</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">thetas</span><span class="p">[</span><span class="n">ith</span><span class="p">],</span> <span class="n">nxDC</span><span class="p">,</span> <span class="n">nyDC</span><span class="p">)</span>
</span><span id="Psd.polarSpectra-213"><a href="#Psd.polarSpectra-213"><span class="linenos">213</span></a>
</span><span id="Psd.polarSpectra-214"><a href="#Psd.polarSpectra-214"><span class="linenos">214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">psdp</span> <span class="o">=</span> <span class="n">PSDp</span>
</span><span id="Psd.polarSpectra-215"><a href="#Psd.polarSpectra-215"><span class="linenos">215</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Psd.polarSpectra-216"><a href="#Psd.polarSpectra-216"><span class="linenos">216</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;3d&#39;</span><span class="p">})</span>
</span><span id="Psd.polarSpectra-217"><a href="#Psd.polarSpectra-217"><span class="linenos">217</span></a>            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Fr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">),</span> <span class="n">Fr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
</span><span id="Psd.polarSpectra-218"><a href="#Psd.polarSpectra-218"><span class="linenos">218</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">PSDp</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gnuplot</span><span class="p">)</span>
</span><span id="Psd.polarSpectra-219"><a href="#Psd.polarSpectra-219"><span class="linenos">219</span></a>
</span><span id="Psd.polarSpectra-220"><a href="#Psd.polarSpectra-220"><span class="linenos">220</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Psd.polarSpectra-221"><a href="#Psd.polarSpectra-221"><span class="linenos">221</span></a>
</span><span id="Psd.polarSpectra-222"><a href="#Psd.polarSpectra-222"><span class="linenos">222</span></a>        <span class="k">return</span> <span class="n">PSDp</span><span class="p">,</span> <span class="n">Fr</span><span class="p">,</span> <span class="n">Th</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the spectra in polar coordinates</p>

<h2 id="parameters">Parameters</h2>

<p>df_fct: float
    The frequency resolution
bplt: bool
    If true the spectra is plotted in a 3d projection axis</p>

<h2 id="returns">Returns</h2>

<p>psdP: np.ndarray
    The polar spectra evaluated
Fr, Th: np.array
    The polar coordinate vectors</p>
</div>


                            </div>
                            <div id="Psd.angleIntegratedSpectra" class="classattr">
                                        <input id="Psd.angleIntegratedSpectra-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">angleIntegratedSpectra</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df_fct</span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Psd.angleIntegratedSpectra-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Psd.angleIntegratedSpectra"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Psd.angleIntegratedSpectra-224"><a href="#Psd.angleIntegratedSpectra-224"><span class="linenos">224</span></a>    <span class="k">def</span> <span class="nf">angleIntegratedSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_fct</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Psd.angleIntegratedSpectra-225"><a href="#Psd.angleIntegratedSpectra-225"><span class="linenos">225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Psd.angleIntegratedSpectra-226"><a href="#Psd.angleIntegratedSpectra-226"><span class="linenos">226</span></a><span class="sd">        Calculate the angle integrated spectra</span>
</span><span id="Psd.angleIntegratedSpectra-227"><a href="#Psd.angleIntegratedSpectra-227"><span class="linenos">227</span></a>
</span><span id="Psd.angleIntegratedSpectra-228"><a href="#Psd.angleIntegratedSpectra-228"><span class="linenos">228</span></a><span class="sd">        Parameters</span>
</span><span id="Psd.angleIntegratedSpectra-229"><a href="#Psd.angleIntegratedSpectra-229"><span class="linenos">229</span></a><span class="sd">        ----------</span>
</span><span id="Psd.angleIntegratedSpectra-230"><a href="#Psd.angleIntegratedSpectra-230"><span class="linenos">230</span></a><span class="sd">        df_fct: float</span>
</span><span id="Psd.angleIntegratedSpectra-231"><a href="#Psd.angleIntegratedSpectra-231"><span class="linenos">231</span></a><span class="sd">        bplt: bool</span>
</span><span id="Psd.angleIntegratedSpectra-232"><a href="#Psd.angleIntegratedSpectra-232"><span class="linenos">232</span></a><span class="sd">            If true the angle integrated spectra is plotted</span>
</span><span id="Psd.angleIntegratedSpectra-233"><a href="#Psd.angleIntegratedSpectra-233"><span class="linenos">233</span></a>
</span><span id="Psd.angleIntegratedSpectra-234"><a href="#Psd.angleIntegratedSpectra-234"><span class="linenos">234</span></a><span class="sd">        Returns</span>
</span><span id="Psd.angleIntegratedSpectra-235"><a href="#Psd.angleIntegratedSpectra-235"><span class="linenos">235</span></a><span class="sd">        -------</span>
</span><span id="Psd.angleIntegratedSpectra-236"><a href="#Psd.angleIntegratedSpectra-236"><span class="linenos">236</span></a><span class="sd">        psdP: np.ndarray</span>
</span><span id="Psd.angleIntegratedSpectra-237"><a href="#Psd.angleIntegratedSpectra-237"><span class="linenos">237</span></a><span class="sd">            The polar spectra evaluated</span>
</span><span id="Psd.angleIntegratedSpectra-238"><a href="#Psd.angleIntegratedSpectra-238"><span class="linenos">238</span></a><span class="sd">        Fr, Th: np.array</span>
</span><span id="Psd.angleIntegratedSpectra-239"><a href="#Psd.angleIntegratedSpectra-239"><span class="linenos">239</span></a><span class="sd">            The polar coordinate vectors</span>
</span><span id="Psd.angleIntegratedSpectra-240"><a href="#Psd.angleIntegratedSpectra-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Psd.angleIntegratedSpectra-241"><a href="#Psd.angleIntegratedSpectra-241"><span class="linenos">241</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Angle integrated spectra failed: psd has not been evaluated&#39;</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-242"><a href="#Psd.angleIntegratedSpectra-242"><span class="linenos">242</span></a>
</span><span id="Psd.angleIntegratedSpectra-243"><a href="#Psd.angleIntegratedSpectra-243"><span class="linenos">243</span></a>        <span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Psd.angleIntegratedSpectra-244"><a href="#Psd.angleIntegratedSpectra-244"><span class="linenos">244</span></a>        <span class="n">df_x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaX</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-245"><a href="#Psd.angleIntegratedSpectra-245"><span class="linenos">245</span></a>        <span class="n">df_y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">ny</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaY</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-246"><a href="#Psd.angleIntegratedSpectra-246"><span class="linenos">246</span></a>        <span class="n">nxDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Psd.angleIntegratedSpectra-247"><a href="#Psd.angleIntegratedSpectra-247"><span class="linenos">247</span></a>        <span class="n">nyDC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Psd.angleIntegratedSpectra-248"><a href="#Psd.angleIntegratedSpectra-248"><span class="linenos">248</span></a>
</span><span id="Psd.angleIntegratedSpectra-249"><a href="#Psd.angleIntegratedSpectra-249"><span class="linenos">249</span></a>        <span class="n">frmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">df_x</span> <span class="o">*</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df_y</span> <span class="o">*</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Psd.angleIntegratedSpectra-250"><a href="#Psd.angleIntegratedSpectra-250"><span class="linenos">250</span></a>        <span class="n">fr0</span> <span class="o">=</span> <span class="n">df_fct</span> <span class="o">*</span> <span class="p">(</span><span class="n">df_x</span> <span class="o">+</span> <span class="n">df_y</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-251"><a href="#Psd.angleIntegratedSpectra-251"><span class="linenos">251</span></a>        <span class="n">fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fr0</span><span class="p">,</span> <span class="n">frmax</span><span class="p">,</span> <span class="n">fr0</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-252"><a href="#Psd.angleIntegratedSpectra-252"><span class="linenos">252</span></a>        <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fr</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-253"><a href="#Psd.angleIntegratedSpectra-253"><span class="linenos">253</span></a>        <span class="n">PSDr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-254"><a href="#Psd.angleIntegratedSpectra-254"><span class="linenos">254</span></a>        <span class="n">PSDav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-255"><a href="#Psd.angleIntegratedSpectra-255"><span class="linenos">255</span></a>        <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nf</span><span class="p">):</span>
</span><span id="Psd.angleIntegratedSpectra-256"><a href="#Psd.angleIntegratedSpectra-256"><span class="linenos">256</span></a>            <span class="n">frc</span> <span class="o">=</span> <span class="n">fr</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span>
</span><span id="Psd.angleIntegratedSpectra-257"><a href="#Psd.angleIntegratedSpectra-257"><span class="linenos">257</span></a>            <span class="n">nth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">frc</span> <span class="o">/</span> <span class="n">fr0</span><span class="p">))</span>
</span><span id="Psd.angleIntegratedSpectra-258"><a href="#Psd.angleIntegratedSpectra-258"><span class="linenos">258</span></a>            <span class="n">dth</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">nth</span>
</span><span id="Psd.angleIntegratedSpectra-259"><a href="#Psd.angleIntegratedSpectra-259"><span class="linenos">259</span></a>            <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">nth</span><span class="p">)</span>  <span class="c1"># + 0.1*np.pi</span>
</span><span id="Psd.angleIntegratedSpectra-260"><a href="#Psd.angleIntegratedSpectra-260"><span class="linenos">260</span></a>            <span class="n">dth</span> <span class="o">=</span> <span class="n">thetas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">thetas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Psd.angleIntegratedSpectra-261"><a href="#Psd.angleIntegratedSpectra-261"><span class="linenos">261</span></a>            <span class="n">psum</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Psd.angleIntegratedSpectra-262"><a href="#Psd.angleIntegratedSpectra-262"><span class="linenos">262</span></a>            <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">thetas</span><span class="p">:</span>
</span><span id="Psd.angleIntegratedSpectra-263"><a href="#Psd.angleIntegratedSpectra-263"><span class="linenos">263</span></a>                <span class="n">pinter</span> <span class="o">=</span> <span class="n">_eval_pinter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="p">,</span> <span class="n">df_x</span><span class="p">,</span> <span class="n">df_y</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">nxDC</span><span class="p">,</span> <span class="n">nyDC</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-264"><a href="#Psd.angleIntegratedSpectra-264"><span class="linenos">264</span></a>                <span class="n">psum</span> <span class="o">=</span> <span class="n">psum</span> <span class="o">+</span> <span class="n">pinter</span>
</span><span id="Psd.angleIntegratedSpectra-265"><a href="#Psd.angleIntegratedSpectra-265"><span class="linenos">265</span></a>            <span class="n">PSDav</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span> <span class="o">=</span> <span class="n">psum</span> <span class="o">/</span> <span class="n">nth</span>  <span class="c1"># dimension of height^2 * lateral^2 i.e. length^4</span>
</span><span id="Psd.angleIntegratedSpectra-266"><a href="#Psd.angleIntegratedSpectra-266"><span class="linenos">266</span></a>            <span class="n">PSDr</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span> <span class="o">=</span> <span class="n">dth</span> <span class="o">*</span> <span class="n">frc</span> <span class="o">*</span> <span class="n">psum</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># frc has dimension of 1 / lateral</span>
</span><span id="Psd.angleIntegratedSpectra-267"><a href="#Psd.angleIntegratedSpectra-267"><span class="linenos">267</span></a>            <span class="c1"># therefore PSDr: height^2 * lateral</span>
</span><span id="Psd.angleIntegratedSpectra-268"><a href="#Psd.angleIntegratedSpectra-268"><span class="linenos">268</span></a>        <span class="c1"># PSDr = PSDr * fr0</span>
</span><span id="Psd.angleIntegratedSpectra-269"><a href="#Psd.angleIntegratedSpectra-269"><span class="linenos">269</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq r: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">PSDr</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fr0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-270"><a href="#Psd.angleIntegratedSpectra-270"><span class="linenos">270</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rq r: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">PSDav</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fr</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fr0</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-271"><a href="#Psd.angleIntegratedSpectra-271"><span class="linenos">271</span></a>
</span><span id="Psd.angleIntegratedSpectra-272"><a href="#Psd.angleIntegratedSpectra-272"><span class="linenos">272</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Psd.angleIntegratedSpectra-273"><a href="#Psd.angleIntegratedSpectra-273"><span class="linenos">273</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="Psd.angleIntegratedSpectra-274"><a href="#Psd.angleIntegratedSpectra-274"><span class="linenos">274</span></a>            <span class="c1"># ax.loglog(fr, PSDr, &#39;bx-&#39;, markersize=3)</span>
</span><span id="Psd.angleIntegratedSpectra-275"><a href="#Psd.angleIntegratedSpectra-275"><span class="linenos">275</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">PSDav</span><span class="p">,</span> <span class="s1">&#39;rx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-276"><a href="#Psd.angleIntegratedSpectra-276"><span class="linenos">276</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average over all polar angles&#39;</span><span class="p">)</span>
</span><span id="Psd.angleIntegratedSpectra-277"><a href="#Psd.angleIntegratedSpectra-277"><span class="linenos">277</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Psd.angleIntegratedSpectra-278"><a href="#Psd.angleIntegratedSpectra-278"><span class="linenos">278</span></a>
</span><span id="Psd.angleIntegratedSpectra-279"><a href="#Psd.angleIntegratedSpectra-279"><span class="linenos">279</span></a>        <span class="k">return</span> <span class="n">PSDr</span><span class="p">,</span> <span class="n">PSDav</span><span class="p">,</span> <span class="n">fr</span><span class="p">,</span> <span class="n">fr0</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the angle integrated spectra</p>

<h2 id="parameters">Parameters</h2>

<p>df_fct: float
bplt: bool
    If true the angle integrated spectra is plotted</p>

<h2 id="returns">Returns</h2>

<p>psdP: np.ndarray
    The polar spectra evaluated
Fr, Th: np.array
    The polar coordinate vectors</p>
</div>


                            </div>
                            <div id="Psd.averageSpectra" class="classattr">
                                        <input id="Psd.averageSpectra-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">averageSpectra</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Psd.averageSpectra-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Psd.averageSpectra"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Psd.averageSpectra-281"><a href="#Psd.averageSpectra-281"><span class="linenos">281</span></a>    <span class="k">def</span> <span class="nf">averageSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Psd.averageSpectra-282"><a href="#Psd.averageSpectra-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Psd.averageSpectra-283"><a href="#Psd.averageSpectra-283"><span class="linenos">283</span></a><span class="sd">        Calculate the average specra in the x and y directions</span>
</span><span id="Psd.averageSpectra-284"><a href="#Psd.averageSpectra-284"><span class="linenos">284</span></a>
</span><span id="Psd.averageSpectra-285"><a href="#Psd.averageSpectra-285"><span class="linenos">285</span></a><span class="sd">        Parameters</span>
</span><span id="Psd.averageSpectra-286"><a href="#Psd.averageSpectra-286"><span class="linenos">286</span></a><span class="sd">        ----------</span>
</span><span id="Psd.averageSpectra-287"><a href="#Psd.averageSpectra-287"><span class="linenos">287</span></a><span class="sd">        bplt: bool</span>
</span><span id="Psd.averageSpectra-288"><a href="#Psd.averageSpectra-288"><span class="linenos">288</span></a><span class="sd">            Plots the mean spectra if true</span>
</span><span id="Psd.averageSpectra-289"><a href="#Psd.averageSpectra-289"><span class="linenos">289</span></a>
</span><span id="Psd.averageSpectra-290"><a href="#Psd.averageSpectra-290"><span class="linenos">290</span></a><span class="sd">        Returns</span>
</span><span id="Psd.averageSpectra-291"><a href="#Psd.averageSpectra-291"><span class="linenos">291</span></a><span class="sd">        -------</span>
</span><span id="Psd.averageSpectra-292"><a href="#Psd.averageSpectra-292"><span class="linenos">292</span></a><span class="sd">        psdMeanx, psdMeany: np.array</span>
</span><span id="Psd.averageSpectra-293"><a href="#Psd.averageSpectra-293"><span class="linenos">293</span></a><span class="sd">            The mean psd arrays</span>
</span><span id="Psd.averageSpectra-294"><a href="#Psd.averageSpectra-294"><span class="linenos">294</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Psd.averageSpectra-295"><a href="#Psd.averageSpectra-295"><span class="linenos">295</span></a>        <span class="n">PSDxmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Psd.averageSpectra-296"><a href="#Psd.averageSpectra-296"><span class="linenos">296</span></a>        <span class="n">PSDymean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">psdy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Psd.averageSpectra-297"><a href="#Psd.averageSpectra-297"><span class="linenos">297</span></a>
</span><span id="Psd.averageSpectra-298"><a href="#Psd.averageSpectra-298"><span class="linenos">298</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Psd.averageSpectra-299"><a href="#Psd.averageSpectra-299"><span class="linenos">299</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">),</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">dx</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Psd.averageSpectra-300"><a href="#Psd.averageSpectra-300"><span class="linenos">300</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">,</span> <span class="n">PSDxmean</span><span class="p">,</span> <span class="s1">&#39;rx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDx in x dir&#39;</span><span class="p">)</span>
</span><span id="Psd.averageSpectra-301"><a href="#Psd.averageSpectra-301"><span class="linenos">301</span></a>            <span class="n">bx</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span><span class="p">,</span> <span class="n">PSDymean</span><span class="p">,</span> <span class="s1">&#39;kx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDy in y dir&#39;</span><span class="p">)</span>
</span><span id="Psd.averageSpectra-302"><a href="#Psd.averageSpectra-302"><span class="linenos">302</span></a>
</span><span id="Psd.averageSpectra-303"><a href="#Psd.averageSpectra-303"><span class="linenos">303</span></a>            <span class="n">cx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">,</span> <span class="n">PSDxmean</span><span class="p">,</span> <span class="s1">&#39;rx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDx in x dir&#39;</span><span class="p">)</span>
</span><span id="Psd.averageSpectra-304"><a href="#Psd.averageSpectra-304"><span class="linenos">304</span></a>            <span class="n">dx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span><span class="p">,</span> <span class="n">PSDymean</span><span class="p">,</span> <span class="s1">&#39;kx-&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean 1d PSDy in y dir&#39;</span><span class="p">)</span>
</span><span id="Psd.averageSpectra-305"><a href="#Psd.averageSpectra-305"><span class="linenos">305</span></a>
</span><span id="Psd.averageSpectra-306"><a href="#Psd.averageSpectra-306"><span class="linenos">306</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">,</span> <span class="n">bx</span><span class="p">],</span> <span class="n">xlab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f$ in $\frac</span><span class="si">{1}</span><span class="s1">{\mu m}$&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;PSD in $\mu m^3$&#39;</span><span class="p">)</span>
</span><span id="Psd.averageSpectra-307"><a href="#Psd.averageSpectra-307"><span class="linenos">307</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="Psd.averageSpectra-308"><a href="#Psd.averageSpectra-308"><span class="linenos">308</span></a>            
</span><span id="Psd.averageSpectra-309"><a href="#Psd.averageSpectra-309"><span class="linenos">309</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Psd.averageSpectra-310"><a href="#Psd.averageSpectra-310"><span class="linenos">310</span></a>
</span><span id="Psd.averageSpectra-311"><a href="#Psd.averageSpectra-311"><span class="linenos">311</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">PSDxmean</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">PSDymean</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fy</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the average specra in the x and y directions</p>

<h2 id="parameters">Parameters</h2>

<p>bplt: bool
    Plots the mean spectra if true</p>

<h2 id="returns">Returns</h2>

<p>psdMeanx, psdMeany: np.array
    The mean psd arrays</p>
</div>


                            </div>
                </section>
                <section id="Roi">
                            <input id="Roi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">Roi</span>:

                <label class="view-source-button" for="Roi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Roi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Roi-314"><a href="#Roi-314"><span class="linenos">314</span></a><span class="nd">@dataclass</span>
</span><span id="Roi-315"><a href="#Roi-315"><span class="linenos">315</span></a><span class="k">class</span> <span class="nc">Roi</span><span class="p">:</span>
</span><span id="Roi-316"><a href="#Roi-316"><span class="linenos">316</span></a>    <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
</span><span id="Roi-317"><a href="#Roi-317"><span class="linenos">317</span></a>    <span class="n">Z</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
</span></pre></div>


    

                            <div id="Roi.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Roi</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">X</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="n">array</span><span class="o">&gt;</span>, </span><span class="param"><span class="n">Z</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="n">array</span><span class="o">&gt;</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Roi.__init__"></a>
    
    

                            </div>
                            <div id="Roi.X" class="classattr">
                                <div class="attr variable">
            <span class="name">X</span><span class="annotation">: &lt;built-in function array&gt;</span>

        
    </div>
    <a class="headerlink" href="#Roi.X"></a>
    
    

                            </div>
                            <div id="Roi.Z" class="classattr">
                                <div class="attr variable">
            <span class="name">Z</span><span class="annotation">: &lt;built-in function array&gt;</span>

        
    </div>
    <a class="headerlink" href="#Roi.Z"></a>
    
    

                            </div>
                </section>
                <section id="Parameters">
                            <input id="Parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Parameters</span>:

                <label class="view-source-button" for="Parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Parameters-320"><a href="#Parameters-320"><span class="linenos">320</span></a><span class="k">class</span> <span class="nc">Parameters</span><span class="p">:</span>
</span><span id="Parameters-321"><a href="#Parameters-321"><span class="linenos">321</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Parameters-322"><a href="#Parameters-322"><span class="linenos">322</span></a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">rem</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">FormEstimator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fil</span><span class="p">:</span> <span class="nb">filter</span><span class="o">.</span><span class="n">Filter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Parameters-323"><a href="#Parameters-323"><span class="linenos">323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Parameters-324"><a href="#Parameters-324"><span class="linenos">324</span></a><span class="sd">        Calculates the roughness parameters of a profile</span>
</span><span id="Parameters-325"><a href="#Parameters-325"><span class="linenos">325</span></a>
</span><span id="Parameters-326"><a href="#Parameters-326"><span class="linenos">326</span></a><span class="sd">        Parameters</span>
</span><span id="Parameters-327"><a href="#Parameters-327"><span class="linenos">327</span></a><span class="sd">        ----------</span>
</span><span id="Parameters-328"><a href="#Parameters-328"><span class="linenos">328</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="Parameters-329"><a href="#Parameters-329"><span class="linenos">329</span></a><span class="sd">            The profile on which the parameters are calculates</span>
</span><span id="Parameters-330"><a href="#Parameters-330"><span class="linenos">330</span></a><span class="sd">        rem: remover.Remover</span>
</span><span id="Parameters-331"><a href="#Parameters-331"><span class="linenos">331</span></a><span class="sd">            - if None, the low frequency components are not filtered</span>
</span><span id="Parameters-332"><a href="#Parameters-332"><span class="linenos">332</span></a><span class="sd">        fil: filter.Filter</span>
</span><span id="Parameters-333"><a href="#Parameters-333"><span class="linenos">333</span></a><span class="sd">            The filter that is applied before the calculations. The cutoff</span>
</span><span id="Parameters-334"><a href="#Parameters-334"><span class="linenos">334</span></a><span class="sd">            of the filter is used to select the central region of the profile,</span>
</span><span id="Parameters-335"><a href="#Parameters-335"><span class="linenos">335</span></a><span class="sd">            half cutof is not condsidered at the adges of the rofile</span>
</span><span id="Parameters-336"><a href="#Parameters-336"><span class="linenos">336</span></a><span class="sd">        bplt: bool</span>
</span><span id="Parameters-337"><a href="#Parameters-337"><span class="linenos">337</span></a><span class="sd">            If true plots the profile after the pre-proocessing</span>
</span><span id="Parameters-338"><a href="#Parameters-338"><span class="linenos">338</span></a>
</span><span id="Parameters-339"><a href="#Parameters-339"><span class="linenos">339</span></a><span class="sd">        Returns</span>
</span><span id="Parameters-340"><a href="#Parameters-340"><span class="linenos">340</span></a><span class="sd">        -------</span>
</span><span id="Parameters-341"><a href="#Parameters-341"><span class="linenos">341</span></a><span class="sd">        RA, RQ, RP, RV, RZ, RSK, RKU: (float, ...)</span>
</span><span id="Parameters-342"><a href="#Parameters-342"><span class="linenos">342</span></a><span class="sd">            Calculated roughness parameters</span>
</span><span id="Parameters-343"><a href="#Parameters-343"><span class="linenos">343</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Parameters-344"><a href="#Parameters-344"><span class="linenos">344</span></a>        <span class="n">border</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Parameters-345"><a href="#Parameters-345"><span class="linenos">345</span></a>
</span><span id="Parameters-346"><a href="#Parameters-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">rem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Parameters-347"><a href="#Parameters-347"><span class="linenos">347</span></a>            <span class="n">rem</span><span class="o">.</span><span class="n">applyFit</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="Parameters-348"><a href="#Parameters-348"><span class="linenos">348</span></a>            <span class="n">rem</span><span class="o">.</span><span class="n">applyFit</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="Parameters-349"><a href="#Parameters-349"><span class="linenos">349</span></a>        <span class="k">if</span> <span class="n">fil</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Parameters-350"><a href="#Parameters-350"><span class="linenos">350</span></a>            <span class="n">fil</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span><span id="Parameters-351"><a href="#Parameters-351"><span class="linenos">351</span></a>            <span class="n">cutoff</span> <span class="o">=</span> <span class="n">fil</span><span class="o">.</span><span class="n">cutoff</span>
</span><span id="Parameters-352"><a href="#Parameters-352"><span class="linenos">352</span></a>            <span class="n">nsample_cutoff</span> <span class="o">=</span> <span class="n">cutoff</span> <span class="o">//</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">))</span>
</span><span id="Parameters-353"><a href="#Parameters-353"><span class="linenos">353</span></a>            <span class="n">border</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsample_cutoff</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Parameters-354"><a href="#Parameters-354"><span class="linenos">354</span></a>
</span><span id="Parameters-355"><a href="#Parameters-355"><span class="linenos">355</span></a>        <span class="n">roi</span> <span class="o">=</span> <span class="n">Roi</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">border</span><span class="p">:</span> <span class="o">-</span><span class="n">border</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">border</span><span class="p">:</span> <span class="o">-</span><span class="n">border</span><span class="p">])</span>
</span><span id="Parameters-356"><a href="#Parameters-356"><span class="linenos">356</span></a>        <span class="c1"># print(roi.X, roi.Z)</span>
</span><span id="Parameters-357"><a href="#Parameters-357"><span class="linenos">357</span></a>
</span><span id="Parameters-358"><a href="#Parameters-358"><span class="linenos">358</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Parameters-359"><a href="#Parameters-359"><span class="linenos">359</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="Parameters-360"><a href="#Parameters-360"><span class="linenos">360</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="Parameters-361"><a href="#Parameters-361"><span class="linenos">361</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="Parameters-362"><a href="#Parameters-362"><span class="linenos">362</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Parameters-363"><a href="#Parameters-363"><span class="linenos">363</span></a>
</span><span id="Parameters-364"><a href="#Parameters-364"><span class="linenos">364</span></a>        <span class="n">RA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="Parameters-365"><a href="#Parameters-365"><span class="linenos">365</span></a>        <span class="n">RQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>
</span><span id="Parameters-366"><a href="#Parameters-366"><span class="linenos">366</span></a>        <span class="n">RP</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>
</span><span id="Parameters-367"><a href="#Parameters-367"><span class="linenos">367</span></a>        <span class="n">RV</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>
</span><span id="Parameters-368"><a href="#Parameters-368"><span class="linenos">368</span></a>        <span class="n">RT</span> <span class="o">=</span> <span class="n">RP</span> <span class="o">+</span> <span class="n">RV</span>
</span><span id="Parameters-369"><a href="#Parameters-369"><span class="linenos">369</span></a>        <span class="n">RSK</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">RQ</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="Parameters-370"><a href="#Parameters-370"><span class="linenos">370</span></a>        <span class="n">RKU</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">RQ</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="Parameters-371"><a href="#Parameters-371"><span class="linenos">371</span></a>        <span class="k">return</span> <span class="n">RA</span><span class="p">,</span> <span class="n">RQ</span><span class="p">,</span> <span class="n">RP</span><span class="p">,</span> <span class="n">RV</span><span class="p">,</span> <span class="n">RT</span><span class="p">,</span> <span class="n">RSK</span><span class="p">,</span> <span class="n">RKU</span>
</span></pre></div>


    

                            <div id="Parameters.calc" class="classattr">
                                        <input id="Parameters.calc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">calc</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obj</span><span class="p">:</span> <span class="n"><a href="profile.html#Profile">surfile.profile.Profile</a></span>,</span><span class="param">	<span class="n">rem</span><span class="p">:</span> <span class="n"><a href="geometry.html#FormEstimator">surfile.geometry.FormEstimator</a></span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">fil</span><span class="p">:</span> <span class="n"><a href="filter.html#Filter">surfile.filter.Filter</a></span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Parameters.calc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Parameters.calc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Parameters.calc-321"><a href="#Parameters.calc-321"><span class="linenos">321</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Parameters.calc-322"><a href="#Parameters.calc-322"><span class="linenos">322</span></a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">rem</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">FormEstimator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fil</span><span class="p">:</span> <span class="nb">filter</span><span class="o">.</span><span class="n">Filter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Parameters.calc-323"><a href="#Parameters.calc-323"><span class="linenos">323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Parameters.calc-324"><a href="#Parameters.calc-324"><span class="linenos">324</span></a><span class="sd">        Calculates the roughness parameters of a profile</span>
</span><span id="Parameters.calc-325"><a href="#Parameters.calc-325"><span class="linenos">325</span></a>
</span><span id="Parameters.calc-326"><a href="#Parameters.calc-326"><span class="linenos">326</span></a><span class="sd">        Parameters</span>
</span><span id="Parameters.calc-327"><a href="#Parameters.calc-327"><span class="linenos">327</span></a><span class="sd">        ----------</span>
</span><span id="Parameters.calc-328"><a href="#Parameters.calc-328"><span class="linenos">328</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="Parameters.calc-329"><a href="#Parameters.calc-329"><span class="linenos">329</span></a><span class="sd">            The profile on which the parameters are calculates</span>
</span><span id="Parameters.calc-330"><a href="#Parameters.calc-330"><span class="linenos">330</span></a><span class="sd">        rem: remover.Remover</span>
</span><span id="Parameters.calc-331"><a href="#Parameters.calc-331"><span class="linenos">331</span></a><span class="sd">            - if None, the low frequency components are not filtered</span>
</span><span id="Parameters.calc-332"><a href="#Parameters.calc-332"><span class="linenos">332</span></a><span class="sd">        fil: filter.Filter</span>
</span><span id="Parameters.calc-333"><a href="#Parameters.calc-333"><span class="linenos">333</span></a><span class="sd">            The filter that is applied before the calculations. The cutoff</span>
</span><span id="Parameters.calc-334"><a href="#Parameters.calc-334"><span class="linenos">334</span></a><span class="sd">            of the filter is used to select the central region of the profile,</span>
</span><span id="Parameters.calc-335"><a href="#Parameters.calc-335"><span class="linenos">335</span></a><span class="sd">            half cutof is not condsidered at the adges of the rofile</span>
</span><span id="Parameters.calc-336"><a href="#Parameters.calc-336"><span class="linenos">336</span></a><span class="sd">        bplt: bool</span>
</span><span id="Parameters.calc-337"><a href="#Parameters.calc-337"><span class="linenos">337</span></a><span class="sd">            If true plots the profile after the pre-proocessing</span>
</span><span id="Parameters.calc-338"><a href="#Parameters.calc-338"><span class="linenos">338</span></a>
</span><span id="Parameters.calc-339"><a href="#Parameters.calc-339"><span class="linenos">339</span></a><span class="sd">        Returns</span>
</span><span id="Parameters.calc-340"><a href="#Parameters.calc-340"><span class="linenos">340</span></a><span class="sd">        -------</span>
</span><span id="Parameters.calc-341"><a href="#Parameters.calc-341"><span class="linenos">341</span></a><span class="sd">        RA, RQ, RP, RV, RZ, RSK, RKU: (float, ...)</span>
</span><span id="Parameters.calc-342"><a href="#Parameters.calc-342"><span class="linenos">342</span></a><span class="sd">            Calculated roughness parameters</span>
</span><span id="Parameters.calc-343"><a href="#Parameters.calc-343"><span class="linenos">343</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Parameters.calc-344"><a href="#Parameters.calc-344"><span class="linenos">344</span></a>        <span class="n">border</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Parameters.calc-345"><a href="#Parameters.calc-345"><span class="linenos">345</span></a>
</span><span id="Parameters.calc-346"><a href="#Parameters.calc-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">rem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Parameters.calc-347"><a href="#Parameters.calc-347"><span class="linenos">347</span></a>            <span class="n">rem</span><span class="o">.</span><span class="n">applyFit</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="Parameters.calc-348"><a href="#Parameters.calc-348"><span class="linenos">348</span></a>            <span class="n">rem</span><span class="o">.</span><span class="n">applyFit</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="Parameters.calc-349"><a href="#Parameters.calc-349"><span class="linenos">349</span></a>        <span class="k">if</span> <span class="n">fil</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Parameters.calc-350"><a href="#Parameters.calc-350"><span class="linenos">350</span></a>            <span class="n">fil</span><span class="o">.</span><span class="n">applyFilter</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span><span id="Parameters.calc-351"><a href="#Parameters.calc-351"><span class="linenos">351</span></a>            <span class="n">cutoff</span> <span class="o">=</span> <span class="n">fil</span><span class="o">.</span><span class="n">cutoff</span>
</span><span id="Parameters.calc-352"><a href="#Parameters.calc-352"><span class="linenos">352</span></a>            <span class="n">nsample_cutoff</span> <span class="o">=</span> <span class="n">cutoff</span> <span class="o">//</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">))</span>
</span><span id="Parameters.calc-353"><a href="#Parameters.calc-353"><span class="linenos">353</span></a>            <span class="n">border</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsample_cutoff</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Parameters.calc-354"><a href="#Parameters.calc-354"><span class="linenos">354</span></a>
</span><span id="Parameters.calc-355"><a href="#Parameters.calc-355"><span class="linenos">355</span></a>        <span class="n">roi</span> <span class="o">=</span> <span class="n">Roi</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">border</span><span class="p">:</span> <span class="o">-</span><span class="n">border</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">border</span><span class="p">:</span> <span class="o">-</span><span class="n">border</span><span class="p">])</span>
</span><span id="Parameters.calc-356"><a href="#Parameters.calc-356"><span class="linenos">356</span></a>        <span class="c1"># print(roi.X, roi.Z)</span>
</span><span id="Parameters.calc-357"><a href="#Parameters.calc-357"><span class="linenos">357</span></a>
</span><span id="Parameters.calc-358"><a href="#Parameters.calc-358"><span class="linenos">358</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Parameters.calc-359"><a href="#Parameters.calc-359"><span class="linenos">359</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="Parameters.calc-360"><a href="#Parameters.calc-360"><span class="linenos">360</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="Parameters.calc-361"><a href="#Parameters.calc-361"><span class="linenos">361</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="Parameters.calc-362"><a href="#Parameters.calc-362"><span class="linenos">362</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Parameters.calc-363"><a href="#Parameters.calc-363"><span class="linenos">363</span></a>
</span><span id="Parameters.calc-364"><a href="#Parameters.calc-364"><span class="linenos">364</span></a>        <span class="n">RA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="Parameters.calc-365"><a href="#Parameters.calc-365"><span class="linenos">365</span></a>        <span class="n">RQ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>
</span><span id="Parameters.calc-366"><a href="#Parameters.calc-366"><span class="linenos">366</span></a>        <span class="n">RP</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>
</span><span id="Parameters.calc-367"><a href="#Parameters.calc-367"><span class="linenos">367</span></a>        <span class="n">RV</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>
</span><span id="Parameters.calc-368"><a href="#Parameters.calc-368"><span class="linenos">368</span></a>        <span class="n">RT</span> <span class="o">=</span> <span class="n">RP</span> <span class="o">+</span> <span class="n">RV</span>
</span><span id="Parameters.calc-369"><a href="#Parameters.calc-369"><span class="linenos">369</span></a>        <span class="n">RSK</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">RQ</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="Parameters.calc-370"><a href="#Parameters.calc-370"><span class="linenos">370</span></a>        <span class="n">RKU</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">RQ</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="Parameters.calc-371"><a href="#Parameters.calc-371"><span class="linenos">371</span></a>        <span class="k">return</span> <span class="n">RA</span><span class="p">,</span> <span class="n">RQ</span><span class="p">,</span> <span class="n">RP</span><span class="p">,</span> <span class="n">RV</span><span class="p">,</span> <span class="n">RT</span><span class="p">,</span> <span class="n">RSK</span><span class="p">,</span> <span class="n">RKU</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the roughness parameters of a profile</p>

<h2 id="parameters">Parameters</h2>

<p>obj: profile.Profile
    The profile on which the parameters are calculates
rem: remover.Remover
    - if None, the low frequency components are not filtered
fil: filter.Filter
    The filter that is applied before the calculations. The cutoff
    of the filter is used to select the central region of the profile,
    half cutof is not condsidered at the adges of the rofile
bplt: bool
    If true plots the profile after the pre-proocessing</p>

<h2 id="returns">Returns</h2>

<p>RA, RQ, RP, RV, RZ, RSK, RKU: (float, ...)
    Calculated roughness parameters</p>
</div>


                            </div>
                </section>
                <section id="slopeDistribution">
                            <input id="slopeDistribution-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">slopeDistribution</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="slopeDistribution-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#slopeDistribution"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="slopeDistribution-106"><a href="#slopeDistribution-106"><span class="linenos">106</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="slopeDistribution-107"><a href="#slopeDistribution-107"><span class="linenos">107</span></a>            <span class="n">init</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="slopeDistribution-108"><a href="#slopeDistribution-108"><span class="linenos">108</span></a>            <span class="c1"># exec the function</span>
</span><span id="slopeDistribution-109"><a href="#slopeDistribution-109"><span class="linenos">109</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="slopeDistribution-110"><a href="#slopeDistribution-110"><span class="linenos">110</span></a>
</span><span id="slopeDistribution-111"><a href="#slopeDistribution-111"><span class="linenos">111</span></a>            <span class="k">if</span> <span class="n">csvPath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># save the return parameters</span>
</span><span id="slopeDistribution-112"><a href="#slopeDistribution-112"><span class="linenos">112</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="slopeDistribution-113"><a href="#slopeDistribution-113"><span class="linenos">113</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ret</span><span class="p">):</span>
</span><span id="slopeDistribution-114"><a href="#slopeDistribution-114"><span class="linenos">114</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">csvPath</span><span class="si">}{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">rcs</span><span class="o">.</span><span class="n">currentImage</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span>
</span><span id="slopeDistribution-115"><a href="#slopeDistribution-115"><span class="linenos">115</span></a>                                   <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">xy</span><span class="p">],</span>
</span><span id="slopeDistribution-116"><a href="#slopeDistribution-116"><span class="linenos">116</span></a>                                   <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="slopeDistribution-117"><a href="#slopeDistribution-117"><span class="linenos">117</span></a>                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># the returned values are not numpy arrays</span>
</span><span id="slopeDistribution-118"><a href="#slopeDistribution-118"><span class="linenos">118</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">csvPath</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
</span><span id="slopeDistribution-119"><a href="#slopeDistribution-119"><span class="linenos">119</span></a>                        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)),</span> <span class="n">dialect</span><span class="o">=</span><span class="s1">&#39;excel&#39;</span><span class="p">)</span>
</span><span id="slopeDistribution-120"><a href="#slopeDistribution-120"><span class="linenos">120</span></a>                        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">ret</span><span class="p">)))</span>
</span><span id="slopeDistribution-121"><a href="#slopeDistribution-121"><span class="linenos">121</span></a>
</span><span id="slopeDistribution-122"><a href="#slopeDistribution-122"><span class="linenos">122</span></a>            <span class="n">fig_nums</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_fignums</span><span class="p">()</span>
</span><span id="slopeDistribution-123"><a href="#slopeDistribution-123"><span class="linenos">123</span></a>            <span class="n">figs</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">fig_nums</span><span class="p">]</span>
</span><span id="slopeDistribution-124"><a href="#slopeDistribution-124"><span class="linenos">124</span></a>            <span class="k">if</span> <span class="n">save</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># save the figures</span>
</span><span id="slopeDistribution-125"><a href="#slopeDistribution-125"><span class="linenos">125</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">get_fignums</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="slopeDistribution-126"><a href="#slopeDistribution-126"><span class="linenos">126</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">Bcol</span><span class="o">.</span><span class="n">OKCYAN</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;Saving images from function </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">Bcol</span><span class="o">.</span><span class="n">ENDC</span><span class="p">)</span>
</span><span id="slopeDistribution-127"><a href="#slopeDistribution-127"><span class="linenos">127</span></a>
</span><span id="slopeDistribution-128"><a href="#slopeDistribution-128"><span class="linenos">128</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fig</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">figs</span><span class="p">):</span>
</span><span id="slopeDistribution-129"><a href="#slopeDistribution-129"><span class="linenos">129</span></a>                        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save</span><span class="si">}{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">rcs</span><span class="o">.</span><span class="n">currentImage</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
</span><span id="slopeDistribution-130"><a href="#slopeDistribution-130"><span class="linenos">130</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="slopeDistribution-131"><a href="#slopeDistribution-131"><span class="linenos">131</span></a>                    <span class="c1"># print(Bcol.WARNING + f&#39;Function {func.__name__} has no active figures&#39; + Bcol.ENDC)</span>
</span><span id="slopeDistribution-132"><a href="#slopeDistribution-132"><span class="linenos">132</span></a>                    <span class="k">pass</span>
</span><span id="slopeDistribution-133"><a href="#slopeDistribution-133"><span class="linenos">133</span></a>
</span><span id="slopeDistribution-134"><a href="#slopeDistribution-134"><span class="linenos">134</span></a>            <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>  <span class="c1"># plot the figure</span>
</span><span id="slopeDistribution-135"><a href="#slopeDistribution-135"><span class="linenos">135</span></a>                <span class="n">num_figs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_fignums</span><span class="p">()</span>
</span><span id="slopeDistribution-136"><a href="#slopeDistribution-136"><span class="linenos">136</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_figs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="slopeDistribution-137"><a href="#slopeDistribution-137"><span class="linenos">137</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">Bcol</span><span class="o">.</span><span class="n">OKCYAN</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;Plotting image from function </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">Bcol</span><span class="o">.</span><span class="n">ENDC</span><span class="p">)</span>
</span><span id="slopeDistribution-138"><a href="#slopeDistribution-138"><span class="linenos">138</span></a>                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">num_figs</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="slopeDistribution-139"><a href="#slopeDistribution-139"><span class="linenos">139</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="slopeDistribution-140"><a href="#slopeDistribution-140"><span class="linenos">140</span></a>                    <span class="c1"># print(Bcol.WARNING + f&#39;Function {func.__name__} has no active figures&#39; + Bcol.ENDC)</span>
</span><span id="slopeDistribution-141"><a href="#slopeDistribution-141"><span class="linenos">141</span></a>                    <span class="k">pass</span>
</span><span id="slopeDistribution-142"><a href="#slopeDistribution-142"><span class="linenos">142</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="slopeDistribution-143"><a href="#slopeDistribution-143"><span class="linenos">143</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</span><span id="slopeDistribution-144"><a href="#slopeDistribution-144"><span class="linenos">144</span></a>
</span><span id="slopeDistribution-145"><a href="#slopeDistribution-145"><span class="linenos">145</span></a>            <span class="k">if</span> <span class="n">chrono</span><span class="p">:</span>  <span class="c1"># time the function</span>
</span><span id="slopeDistribution-146"><a href="#slopeDistribution-146"><span class="linenos">146</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">Bcol</span><span class="o">.</span><span class="n">OKCYAN</span> <span class="o">+</span>
</span><span id="slopeDistribution-147"><a href="#slopeDistribution-147"><span class="linenos">147</span></a>                      <span class="sa">f</span><span class="s2">&quot;Function </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> took: </span><span class="si">{</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">init</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
</span><span id="slopeDistribution-148"><a href="#slopeDistribution-148"><span class="linenos">148</span></a>                      <span class="o">+</span> <span class="n">Bcol</span><span class="o">.</span><span class="n">ENDC</span><span class="p">)</span>
</span><span id="slopeDistribution-149"><a href="#slopeDistribution-149"><span class="linenos">149</span></a>            <span class="k">return</span> <span class="n">ret</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the slope distribution in angles theta and phi</p>

<h2 id="parameters">Parameters</h2>

<p>obj: surface.Surface
    The surface n wich the slope distribution is calculated
structured: bool
    If true the method assumes equal spacing along x-axis (dx) and equal spacing along
    y-axis
    If false the method uses a generalized triangle approach (recommended)
theta_res: float
    The angle resolution for the theta angle
phi_res: float
    The angle resolution for the phi angle
adaptive_hist: bool
    If true the bins are calculated between 0 and the max angles
    If false the bins are calculated between 0 - 90 for theta, 0 - 360 for phi
bplt: bool
    If True plots the calculated histograms</p>

<h2 id="returns">Returns</h2>

<p>(hist_theta, edges_theta): tuple
    The theta histogram
(hist_phi, edges_phi): tuple
    The phi histogram</p>

<h2 id="notes">Notes</h2>

<p>This method performs a slope distribution analysis on the surface by calculating all 
the normal vectors to the triangles constructed on the adjacent points of the topography. 
The normal vectors are then expressed in polar coordinates and for the two angles 
(elevation, azimuth) a histogram plot is generated. The number of bins for each angle can 
be specified by the user by setting the two parameters res and adaptive_hist.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>