<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 13.1.1"/>
    <title>surfile.remover API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../surfile.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;surfile</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#polyval2d">polyval2d</a>
            </li>
            <li>
                    <a class="class" href="#Remover">Remover</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Remover.applyRemover">applyRemover</a>
                        </li>
                        <li>
                                <a class="function" href="#Remover.plotForm">plotForm</a>
                        </li>
                        <li>
                                <a class="function" href="#Remover.removeForm">removeForm</a>
                        </li>
                        <li>
                                <a class="function" href="#Remover.plot3DForm">plot3DForm</a>
                        </li>
                        <li>
                                <a class="function" href="#Remover.remove3DForm">remove3DForm</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ProfileLSLine">ProfileLSLine</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ProfileLSLine.applyRemover">applyRemover</a>
                        </li>
                        <li>
                                <a class="function" href="#ProfileLSLine.remove">remove</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ProfilePolynomial">ProfilePolynomial</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ProfilePolynomial.__init__">ProfilePolynomial</a>
                        </li>
                        <li>
                                <a class="function" href="#ProfilePolynomial.applyRemover">applyRemover</a>
                        </li>
                        <li>
                                <a class="function" href="#ProfilePolynomial.remove">remove</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ProfileHistogram">ProfileHistogram</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ProfileHistogram.remove">remove</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SurfaceLSPlane">SurfaceLSPlane</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SurfaceLSPlane.applyRemover">applyRemover</a>
                        </li>
                        <li>
                                <a class="function" href="#SurfaceLSPlane.remove">remove</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SurfacePolynomial">SurfacePolynomial</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SurfacePolynomial.__init__">SurfacePolynomial</a>
                        </li>
                        <li>
                                <a class="function" href="#SurfacePolynomial.applyRemover">applyRemover</a>
                        </li>
                        <li>
                                <a class="function" href="#SurfacePolynomial.remove">remove</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Surface3Points">Surface3Points</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Surface3Points.remove">remove</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Sphere">Sphere</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Sphere.remove">remove</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#evalCyl">evalCyl</a>
            </li>
            <li>
                    <a class="class" href="#Cylinder">Cylinder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Cylinder.remove">remove</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../surfile.html">surfile</a><wbr>.remover    </h1>

                        <div class="docstring"><p>'<a href="">surfile.remover</a>'</p>

<ul>
<li>form removal operations, implements:
<ul>
<li>least square polynomial fits with bounded domain</li>
<li>spherical fit</li>
<li>cylinder fit</li>
</ul></li>
</ul>

<p>@author: Andrea Giura</p>
</div>

                        <input id="mod-remover-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-remover-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">&#39;surfile.remover&#39;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">- form removal operations, implements:</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">    - least square polynomial fits with bounded domain</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">    - spherical fit</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">    - cylinder fit</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">@author: Andrea Giura</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span> <span class="nn">itertools</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span><span class="p">,</span> <span class="n">optimize</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span> <span class="nn">surfile</span> <span class="kn">import</span> <span class="n">funct</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="n">cutter</span> <span class="k">as</span> <span class="n">cutr</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">PolygonSelector</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="k">def</span> <span class="nf">polyval2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>    <span class="c1"># https://sofia-usra.github.io/sofia_redux/license.html</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    Evaluate 2D polynomial coefficients</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    ONLY USED INTERNALLY FOR SURFACE RECONSTRUCTION</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    Parameters</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    ----------</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    x : array_like of float</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">        (shape1) x-coordinate independent interpolants</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    y : array_like of float</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        (shape1) y-coordinate independent interpolants</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    coeffs : numpy.ndarray</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">        (y_order + 1, x_order + 1) array of coefficients output by</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">        `polyfit2d`.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    Returns</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    -------</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    numpy.ndarray</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">        (shape1) polynomial coefficients evaluated at (y,x).</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>    <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>    <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coeffs</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">))):</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>            <span class="k">continue</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="n">z</span> <span class="o">+=</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="n">j</span><span class="p">)</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>    <span class="k">return</span> <span class="n">z</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="k">class</span> <span class="nc">Remover</span><span class="p">:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="k">pass</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>    <span class="k">def</span> <span class="nf">plotForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">form</span><span class="p">)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="nf">removeForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="n">z_final</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">form</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="k">return</span> <span class="n">z_final</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="nf">plot3DForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">polyval2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;3d&#39;</span><span class="p">})</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Greys</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">)</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="k">def</span> <span class="nf">remove3DForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">polyval2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="n">z_final</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">form</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="k">return</span> <span class="n">z_final</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="k">class</span> <span class="nc">ProfileLSLine</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="c1"># shortcut class to profile poly of degree 1 (implemented for simmetry)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        Least square line fit implementation</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        Parameters</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        ----------</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">            The profile object on wich the form is removed</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">            If True plots the line overimposed on the profile</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        Returns</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        ----------</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        (m, q): (float, ...)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">            The line equation coefficients</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="c1"># create matrix and Z vector to use lstsq</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="n">XZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">)),</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span> <span class="o">=</span> <span class="n">XZ</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="n">G</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">XZ</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># X</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">XZ</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">resid</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># calculate LS line</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>            <span class="n">Remover</span><span class="o">.</span><span class="n">plotForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">removeForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">q</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="k">class</span> <span class="nc">ProfilePolynomial</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">=</span> <span class="n">degree</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bound</span> <span class="o">=</span> <span class="n">bound</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span> <span class="o">=</span> <span class="n">cutter</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">        Plynomial fit implementation</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">        Parameters</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">        ----------</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">            The profile object on wich the form is removed</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        comp: funct / lambda</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">            comparison method between bound and profile</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        degree: int</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">            polynomial degree</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        bound: float</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">            -if not set the fit uses all points,</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">            -if set the fit uses all points below the values,</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">            -if set to True the fit uses only the values below the average value of the profile</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        cutter: cutter.Cutter</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">            -if not set, the fit uses all points</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">            -if true allows the user to select manually the region of interest</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">            -if a cutter obj is passed the fit is done only on the cutted profile points</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">             and then applied on the whole profile</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">            If True plots the polynomial form overimposed on the profile</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        Returns</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">        ----------</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        coeff: np.array()</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">            The polynomial form coefficients</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="k">if</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># if the fit is only on part of the profile the user chooses</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>            <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">cutr</span><span class="o">.</span><span class="n">ProfileCutter</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="k">elif</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">cutter</span><span class="o">.</span><span class="n">applyCut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># use the whole profile</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="k">if</span> <span class="n">bound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="k">elif</span> <span class="n">bound</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>            <span class="n">bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">comp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">bound</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">degree</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">comp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">bound</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">degree</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="n">Remover</span><span class="o">.</span><span class="n">plotForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">removeForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="k">return</span> <span class="n">coeff</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="c1"># TODO: this class does not work, is it even useful??</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="k">class</span> <span class="nc">ProfileHistogram</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>  <span class="c1"># Still not working well</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">final_m</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">        Alligns the profile using the recursive histogram method, stops when</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        the tilt correction is less than the parameter final_m</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">        Parameters</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        ----------</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">            The profile object on wich the form is removed</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">        final_m: float</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">            The end slope correction</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">            Plots the histogram evolution over the iterations</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="n">m</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">fitLineLS</span><span class="p">()</span>  <span class="c1"># preprocess inclination</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="n">tot_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="c1"># threshold = 50 / tot_bins</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="n">line_m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="mi">10</span>  <span class="c1"># start incline</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hist method -&gt; Start slope  </span><span class="si">{</span><span class="n">line_m</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="n">ax_h</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="n">bx_h</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="k">def</span> <span class="nf">calcNBUT</span><span class="p">():</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>            <span class="n">hist</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">histMethod</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">tot_bins</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># make the hist</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="n">weights</span> <span class="o">=</span> <span class="n">hist</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="n">n_bins_under_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">weights</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># how many bins under th</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>            <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">hist</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.25</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;NBUT = </span><span class="si">{</span><span class="n">n_bins_under_threshold</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="n">tot_bins</span><span class="si">}</span><span class="s1">, line_m = </span><span class="si">{</span><span class="n">line_m</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> -&gt; </span><span class="si">{</span><span class="n">final_m</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>                          <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax_h</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>                <span class="n">bx_h</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>                <span class="n">bx_h</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="k">return</span> <span class="n">n_bins_under_threshold</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="n">param</span> <span class="o">=</span> <span class="n">calcNBUT</span><span class="p">()</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="n">n_row</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="c1"># until I have enough bins &lt; th keep loop</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">line_m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">final_m</span><span class="p">:</span>  <span class="c1"># nbut &lt; (tot_bins - tot_bins / 20):</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">line_m</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="n">param_old</span> <span class="o">=</span> <span class="n">param</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="n">param</span> <span class="o">=</span> <span class="n">calcNBUT</span><span class="p">()</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="k">if</span> <span class="n">param</span> <span class="o">&lt;</span> <span class="n">param_old</span><span class="p">:</span>  <span class="c1"># invert rotation if we are going the wrong way</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>                <span class="n">line_m</span> <span class="o">=</span> <span class="o">-</span><span class="n">line_m</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="n">param_old</span><span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>                <span class="n">n_row</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>                <span class="k">if</span> <span class="n">n_row</span> <span class="o">&gt;=</span> <span class="mi">15</span><span class="p">:</span> <span class="k">break</span>  <span class="c1"># we got stuck for too long</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>                <span class="n">n_row</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hist method -&gt; End slope </span><span class="si">{</span><span class="n">line_m</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="k">class</span> <span class="nc">SurfaceLSPlane</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>    <span class="c1"># shortcut class to surface poly of degree 1 (implemented for simmetry)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">        Least square plane fit implementation</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">        Parameters</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">        ----------</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">            The surface object on wich the LS plane is applied</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">            If True plots the plane overimposed on the surface</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        Returns</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">        ----------</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">        sol: np.ndarray</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">            Array of polynomial coefficients.</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="k">return</span> <span class="n">SurfacePolynomial</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="k">class</span> <span class="nc">SurfacePolynomial</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kx</span> <span class="o">=</span> <span class="n">kx</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ky</span> <span class="o">=</span> <span class="n">ky</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">full</span> <span class="o">=</span> <span class="n">full</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bound</span> <span class="o">=</span> <span class="n">bound</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span> <span class="o">=</span> <span class="n">cutter</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ky</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">        Least square polynomial fit implementation</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">        Parameters</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        ----------</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">            The surface object on wich the polynomial fit is applied</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        kx, ky: int</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">            Polynomial order in x and y, respectively.</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">        full : bool, optional</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">            If True, will solve using the full polynomial matrix.  Otherwise,</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">            will use the upper-left triangle of the matrix.  See</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">            `polyinterp2d` for further details.  Note that if kx != ky, then</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">            the full matrix will be solved for. (@sofia_redux/toolkit)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">        comp: funct / lambda, optional</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">            comparison method between bound and surface</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">        bound: float, optional</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">            if not set the fit uses all points,</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">            if set the fit uses all points below the values,</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">            if set to True the fit uses only the values below the average value of the surface</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        cutter: cutter.Cutter</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">            -if not set, the fit uses all points</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">            -if true allows the user to select manually the region of interest</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">            -if a cutter obj is passed the fit is done only on the cutted profile points</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">             and then applied on the whole profile</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">        bplt: bool, optional</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">            If True plots the plane overimposed on the surface</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">        Returns</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        ----------</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        sol: np.ndarray</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">            Array of polynomial coefficients.</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="k">if</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>            <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">cutr</span><span class="o">.</span><span class="n">SurfaceCutter</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="k">elif</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">cutter</span><span class="o">.</span><span class="n">applyCut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>  <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">z</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="k">if</span> <span class="n">bound</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="n">bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>  <span class="c1"># set the bound to the mean point</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">kx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ky</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="n">full</span> <span class="o">|=</span> <span class="n">kx</span> <span class="o">!=</span> <span class="n">ky</span>  <span class="c1"># if they are different -&gt; full matrix</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="n">loop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">)))</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">full</span><span class="p">:</span>  <span class="c1"># calculate only upper left part of matrix</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="n">loop2</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">:</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">ky</span> <span class="o">-</span> <span class="n">j</span><span class="p">):</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>                    <span class="n">loop2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>            <span class="n">loop</span> <span class="o">=</span> <span class="n">loop2</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">)))</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loop</span><span class="p">):</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>            <span class="n">a</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="n">j</span><span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="c1"># remove nan values</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="n">indexes</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="k">if</span> <span class="n">bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># remove z limited values in comp direction</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>            <span class="n">keep</span> <span class="o">=</span> <span class="n">comp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">bound</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="n">sol</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>                <span class="n">coeffs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>            <span class="n">Remover</span><span class="o">.</span><span class="n">plot3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">remove3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="k">return</span> <span class="n">sol</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="k">class</span> <span class="nc">Surface3Points</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>    <span class="c1"># TODO : add radius of points to pick with a single click</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        3 points plane fit implementation</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">        Opens a plot figure to choose the 3 points and fids the plane for those points</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        Parameters</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        ----------</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">            The surface object on wich the polynomial fit is applied</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">            If True plots the plane overimposed on the surface</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="k">def</span> <span class="nf">onClose</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>  <span class="c1"># when fig is closed calculate plane parameters</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>            <span class="n">po</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">selector</span><span class="o">.</span><span class="n">verts</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>                <span class="n">xind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                <span class="n">yind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>                <span class="n">po</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">yind</span><span class="p">,</span> <span class="n">xind</span><span class="p">]])</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>            <span class="c1"># print(f&quot;Collected points: {po}&quot;)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>            <span class="n">a1</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># x2 - x1;</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>            <span class="n">b1</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># y2 - y1;</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>            <span class="n">c1</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># z2 - z1;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>            <span class="n">a2</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># x3 - x1;</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>            <span class="n">b2</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># y3 - y1;</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="n">c2</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># z3 - z1;</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">-</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">c1</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">c2</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">a2</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># (- self.a * po[0][0] - self.b * po[0][1] - self.c * po[0][2])</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">d</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                <span class="n">Remover</span><span class="o">.</span><span class="n">plot3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">remove3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;3 Points plane fit&#39;</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;close_event&#39;</span><span class="p">,</span> <span class="n">onClose</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="n">selector</span> <span class="o">=</span> <span class="n">PolygonSelector</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="k">class</span> <span class="nc">Sphere</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        Calculates the least square sphere</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">        Parameters</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">        ----------</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">            The surface object on wich the polynomial fit is applied</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">        finalize: bool</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">            If set to False the fit will not alter the surface,</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">            the method will only return the center and the radius</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">        radius: float</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">            If None the method will use the best fit radius</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">            If a radius is passed then the program will use it</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">            Plots the sphere fitted to the data points</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        Returns</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">        ----------</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">        (radius, C): (float, [xc, yc, zc])</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">            Radius and sphere center coordinates</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="c1">#   Assemble the A matrix</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="n">spZ</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="n">spX</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="n">spY</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="n">nanind</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">spZ</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>        <span class="n">spZ</span> <span class="o">=</span> <span class="n">spZ</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="n">spX</span> <span class="o">=</span> <span class="n">spX</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="n">spY</span> <span class="o">=</span> <span class="n">spY</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">spX</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spX</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">spY</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">spZ</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="c1">#   Assemble the f matrix</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">spX</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="n">f</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">spX</span> <span class="o">*</span> <span class="n">spX</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">spY</span> <span class="o">*</span> <span class="n">spY</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">spZ</span> <span class="o">*</span> <span class="n">spZ</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="n">C</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="c1">#   solve for the radius</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>            <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="k">if</span> <span class="n">finalize</span><span class="p">:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>            <span class="n">sph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">sph</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>            <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">20</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">10</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>            <span class="c1">#   3D plot of Sphere bfv</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>        <span class="k">return</span> <span class="n">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">C</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="k">def</span> <span class="nf">evalCyl</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">est_p</span><span class="p">,</span> <span class="n">concavity</span><span class="p">):</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">    Evaluates the cylinder points given the 5 parameters</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">    Parameters</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">    ----------</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">    obj: surface.Surface</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">        The surface object on wich the cylinder is calculated</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">    est_p: np.array</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">        P[0] = r, radius of the cylinder</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        p[1] = Yc, y coordinate of the cylinder centre</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">        P[2] = Zc, z coordinate of the cylinder centre</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">        P[3] = alpha_z, rotation angle (radian) about the z-axis</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">        P[4] = alpha_y, rotation angle (radian) about the y-axis</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">    concavity:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">        Either &#39;concave&#39; or &#39;convex&#39;</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">    Returns</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">    -------</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a><span class="sd">        z_cyl: np.ndarray</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">            The calculated points</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">est_p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">est_p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">est_p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">est_p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">est_p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>    <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>    <span class="n">B</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">est_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>    <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">l</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">m</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">est_p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> \
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="mi">2</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">est_p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">est_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">C</span><span class="p">)</span> <span class="k">if</span> <span class="n">concavity</span> <span class="o">==</span> <span class="s1">&#39;convex&#39;</span> <span class="k">else</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">C</span><span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A</span><span class="p">)</span> <span class="o">+</span> <span class="n">est_p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="k">class</span> <span class="nc">Cylinder</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">alphaZ</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alphaY</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">concavity</span><span class="o">=</span><span class="s1">&#39;convex&#39;</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a><span class="sd">        This is a fitting for a horizontal along x cylinder fitting</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a><span class="sd">        uses the following parameters to find the best cylinder fit</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="sd">        Parameters</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a><span class="sd">        ----------</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a><span class="sd">            The surface object on wich the cylinder fit is applied</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a><span class="sd">        radius: float</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a><span class="sd">            The cylinder nominal radius</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="sd">        alphaY:</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="sd">            An estimate ot the cylinder rotation about the y-axis (radian)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="sd">        alphaZ:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">            An estimate ot the cylinder rotation about the z-axis (radian)</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">        concavity: str</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">            Can be either &#39;convex&#39; or &#39;concave&#39;</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a><span class="sd">        base: bool</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a><span class="sd">            If true removes the points at the base of the cylinder</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a><span class="sd">        finalize: bool</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="sd">            If set to False the fit will not alter the surface,</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="sd">            the method will only return the center and the radius</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="sd">        bplt: bool</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">            Plots the sphere fitted to the data points</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a><span class="sd">        Returns</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">        ----------</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a><span class="sd">        est_p: np.array</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">            P[0] = r, radius of the cylinder</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="sd">            p[1] = Yc, y coordinate of the cylinder centre</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">            P[2] = Zc, z coordinate of the cylinder centre</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">            P[3] = alpha_z, rotation angle (radian) about the z-axis</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">            P[4] = alpha_y, rotation angle (radian) about the y-axis</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>        <span class="c1"># TODO : try masking the points instead of removing</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>        <span class="k">if</span> <span class="n">base</span><span class="p">:</span>  <span class="c1"># remove base points</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>            <span class="k">if</span> <span class="n">concavity</span> <span class="o">==</span> <span class="s1">&#39;convex&#39;</span><span class="p">:</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>                <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">9</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>                <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">&lt;</span> <span class="n">th</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>            <span class="k">elif</span> <span class="n">concavity</span> <span class="o">==</span> <span class="s1">&#39;concave&#39;</span><span class="p">:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>                <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>                <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="n">th</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Concavity is not valid&#39;</span><span class="p">)</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>        <span class="n">nanind</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>        <span class="k">def</span> <span class="nf">fitfunc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>            <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>            <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>        <span class="n">errfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">fitfunc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># error function</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>        <span class="n">p_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphaZ</span><span class="p">,</span> <span class="n">alphaY</span><span class="p">])</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>        <span class="n">est_p</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">errfunc</span><span class="p">,</span> <span class="n">p_init</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="c1"># print(f&#39;Cylinder fit: {est_p}&#39;)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>        <span class="n">z_cyl</span> <span class="o">=</span> <span class="n">evalCyl</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">est_p</span><span class="p">,</span> <span class="n">concavity</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">z_cyl</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">z_cyl</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_cyl</span><span class="p">)])))</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">],</span> <span class="s1">&#39;x[um]&#39;</span><span class="p">,</span> <span class="s1">&#39;y[um]&#39;</span><span class="p">,</span> <span class="s1">&#39;z[um]&#39;</span><span class="p">)</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>        <span class="k">if</span> <span class="n">finalize</span><span class="p">:</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">z_cyl</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>        <span class="k">return</span> <span class="n">est_p</span>
</span></pre></div>


            </section>
                <section id="polyval2d">
                            <input id="polyval2d-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">polyval2d</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span>, </span><span class="param"><span class="n">coeffs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="polyval2d-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#polyval2d"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="polyval2d-24"><a href="#polyval2d-24"><span class="linenos">24</span></a><span class="k">def</span> <span class="nf">polyval2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
</span><span id="polyval2d-25"><a href="#polyval2d-25"><span class="linenos">25</span></a>    <span class="c1"># https://sofia-usra.github.io/sofia_redux/license.html</span>
</span><span id="polyval2d-26"><a href="#polyval2d-26"><span class="linenos">26</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="polyval2d-27"><a href="#polyval2d-27"><span class="linenos">27</span></a><span class="sd">    Evaluate 2D polynomial coefficients</span>
</span><span id="polyval2d-28"><a href="#polyval2d-28"><span class="linenos">28</span></a><span class="sd">    ONLY USED INTERNALLY FOR SURFACE RECONSTRUCTION</span>
</span><span id="polyval2d-29"><a href="#polyval2d-29"><span class="linenos">29</span></a>
</span><span id="polyval2d-30"><a href="#polyval2d-30"><span class="linenos">30</span></a><span class="sd">    Parameters</span>
</span><span id="polyval2d-31"><a href="#polyval2d-31"><span class="linenos">31</span></a><span class="sd">    ----------</span>
</span><span id="polyval2d-32"><a href="#polyval2d-32"><span class="linenos">32</span></a><span class="sd">    x : array_like of float</span>
</span><span id="polyval2d-33"><a href="#polyval2d-33"><span class="linenos">33</span></a><span class="sd">        (shape1) x-coordinate independent interpolants</span>
</span><span id="polyval2d-34"><a href="#polyval2d-34"><span class="linenos">34</span></a><span class="sd">    y : array_like of float</span>
</span><span id="polyval2d-35"><a href="#polyval2d-35"><span class="linenos">35</span></a><span class="sd">        (shape1) y-coordinate independent interpolants</span>
</span><span id="polyval2d-36"><a href="#polyval2d-36"><span class="linenos">36</span></a><span class="sd">    coeffs : numpy.ndarray</span>
</span><span id="polyval2d-37"><a href="#polyval2d-37"><span class="linenos">37</span></a><span class="sd">        (y_order + 1, x_order + 1) array of coefficients output by</span>
</span><span id="polyval2d-38"><a href="#polyval2d-38"><span class="linenos">38</span></a><span class="sd">        `polyfit2d`.</span>
</span><span id="polyval2d-39"><a href="#polyval2d-39"><span class="linenos">39</span></a>
</span><span id="polyval2d-40"><a href="#polyval2d-40"><span class="linenos">40</span></a><span class="sd">    Returns</span>
</span><span id="polyval2d-41"><a href="#polyval2d-41"><span class="linenos">41</span></a><span class="sd">    -------</span>
</span><span id="polyval2d-42"><a href="#polyval2d-42"><span class="linenos">42</span></a><span class="sd">    numpy.ndarray</span>
</span><span id="polyval2d-43"><a href="#polyval2d-43"><span class="linenos">43</span></a><span class="sd">        (shape1) polynomial coefficients evaluated at (y,x).</span>
</span><span id="polyval2d-44"><a href="#polyval2d-44"><span class="linenos">44</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="polyval2d-45"><a href="#polyval2d-45"><span class="linenos">45</span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
</span><span id="polyval2d-46"><a href="#polyval2d-46"><span class="linenos">46</span></a>    <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>
</span><span id="polyval2d-47"><a href="#polyval2d-47"><span class="linenos">47</span></a>    <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">shape</span>
</span><span id="polyval2d-48"><a href="#polyval2d-48"><span class="linenos">48</span></a>    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="polyval2d-49"><a href="#polyval2d-49"><span class="linenos">49</span></a>    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coeffs</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">))):</span>
</span><span id="polyval2d-50"><a href="#polyval2d-50"><span class="linenos">50</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="polyval2d-51"><a href="#polyval2d-51"><span class="linenos">51</span></a>            <span class="k">continue</span>
</span><span id="polyval2d-52"><a href="#polyval2d-52"><span class="linenos">52</span></a>        <span class="n">z</span> <span class="o">+=</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="n">j</span><span class="p">)</span>
</span><span id="polyval2d-53"><a href="#polyval2d-53"><span class="linenos">53</span></a>    <span class="k">return</span> <span class="n">z</span>
</span></pre></div>


            <div class="docstring"><p>Evaluate 2D polynomial coefficients
ONLY USED INTERNALLY FOR SURFACE RECONSTRUCTION</p>

<h2 id="parameters">Parameters</h2>

<p>x : array_like of float
    (shape1) x-coordinate independent interpolants
y : array_like of float
    (shape1) y-coordinate independent interpolants
coeffs : numpy.ndarray
    (y_order + 1, x_order + 1) array of coefficients output by
    <code>polyfit2d</code>.</p>

<h2 id="returns">Returns</h2>

<p>numpy.ndarray
    (shape1) polynomial coefficients evaluated at (y,x).</p>
</div>


                </section>
                <section id="Remover">
                            <input id="Remover-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Remover</span>:

                <label class="view-source-button" for="Remover-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Remover"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Remover-56"><a href="#Remover-56"><span class="linenos">56</span></a><span class="k">class</span> <span class="nc">Remover</span><span class="p">:</span>
</span><span id="Remover-57"><a href="#Remover-57"><span class="linenos">57</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Remover-58"><a href="#Remover-58"><span class="linenos">58</span></a>        <span class="k">pass</span>
</span><span id="Remover-59"><a href="#Remover-59"><span class="linenos">59</span></a>
</span><span id="Remover-60"><a href="#Remover-60"><span class="linenos">60</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Remover-61"><a href="#Remover-61"><span class="linenos">61</span></a>    <span class="k">def</span> <span class="nf">plotForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="Remover-62"><a href="#Remover-62"><span class="linenos">62</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="Remover-63"><a href="#Remover-63"><span class="linenos">63</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="Remover-64"><a href="#Remover-64"><span class="linenos">64</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">form</span><span class="p">)</span>
</span><span id="Remover-65"><a href="#Remover-65"><span class="linenos">65</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</span><span id="Remover-66"><a href="#Remover-66"><span class="linenos">66</span></a>
</span><span id="Remover-67"><a href="#Remover-67"><span class="linenos">67</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Remover-68"><a href="#Remover-68"><span class="linenos">68</span></a>
</span><span id="Remover-69"><a href="#Remover-69"><span class="linenos">69</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Remover-70"><a href="#Remover-70"><span class="linenos">70</span></a>    <span class="k">def</span> <span class="nf">removeForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="Remover-71"><a href="#Remover-71"><span class="linenos">71</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="Remover-72"><a href="#Remover-72"><span class="linenos">72</span></a>        <span class="n">z_final</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">form</span>
</span><span id="Remover-73"><a href="#Remover-73"><span class="linenos">73</span></a>        <span class="k">return</span> <span class="n">z_final</span>
</span><span id="Remover-74"><a href="#Remover-74"><span class="linenos">74</span></a>
</span><span id="Remover-75"><a href="#Remover-75"><span class="linenos">75</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Remover-76"><a href="#Remover-76"><span class="linenos">76</span></a>    <span class="k">def</span> <span class="nf">plot3DForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="Remover-77"><a href="#Remover-77"><span class="linenos">77</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">polyval2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="Remover-78"><a href="#Remover-78"><span class="linenos">78</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;3d&#39;</span><span class="p">})</span>
</span><span id="Remover-79"><a href="#Remover-79"><span class="linenos">79</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Greys</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="Remover-80"><a href="#Remover-80"><span class="linenos">80</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">)</span>
</span><span id="Remover-81"><a href="#Remover-81"><span class="linenos">81</span></a>
</span><span id="Remover-82"><a href="#Remover-82"><span class="linenos">82</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Remover-83"><a href="#Remover-83"><span class="linenos">83</span></a>
</span><span id="Remover-84"><a href="#Remover-84"><span class="linenos">84</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Remover-85"><a href="#Remover-85"><span class="linenos">85</span></a>    <span class="k">def</span> <span class="nf">remove3DForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="Remover-86"><a href="#Remover-86"><span class="linenos">86</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">polyval2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="Remover-87"><a href="#Remover-87"><span class="linenos">87</span></a>        <span class="n">z_final</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">form</span>
</span><span id="Remover-88"><a href="#Remover-88"><span class="linenos">88</span></a>        <span class="k">return</span> <span class="n">z_final</span>
</span></pre></div>


    

                            <div id="Remover.applyRemover" class="classattr">
                                        <input id="Remover.applyRemover-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">applyRemover</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">obj</span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Remover.applyRemover-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Remover.applyRemover"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Remover.applyRemover-57"><a href="#Remover.applyRemover-57"><span class="linenos">57</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Remover.applyRemover-58"><a href="#Remover.applyRemover-58"><span class="linenos">58</span></a>        <span class="k">pass</span>
</span></pre></div>


    

                            </div>
                            <div id="Remover.plotForm" class="classattr">
                                        <input id="Remover.plotForm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">plotForm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">z</span>, </span><span class="param"><span class="n">coeff</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Remover.plotForm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Remover.plotForm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Remover.plotForm-60"><a href="#Remover.plotForm-60"><span class="linenos">60</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Remover.plotForm-61"><a href="#Remover.plotForm-61"><span class="linenos">61</span></a>    <span class="k">def</span> <span class="nf">plotForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="Remover.plotForm-62"><a href="#Remover.plotForm-62"><span class="linenos">62</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="Remover.plotForm-63"><a href="#Remover.plotForm-63"><span class="linenos">63</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="Remover.plotForm-64"><a href="#Remover.plotForm-64"><span class="linenos">64</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">form</span><span class="p">)</span>
</span><span id="Remover.plotForm-65"><a href="#Remover.plotForm-65"><span class="linenos">65</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</span><span id="Remover.plotForm-66"><a href="#Remover.plotForm-66"><span class="linenos">66</span></a>
</span><span id="Remover.plotForm-67"><a href="#Remover.plotForm-67"><span class="linenos">67</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="Remover.removeForm" class="classattr">
                                        <input id="Remover.removeForm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">removeForm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">z</span>, </span><span class="param"><span class="n">coeff</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Remover.removeForm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Remover.removeForm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Remover.removeForm-69"><a href="#Remover.removeForm-69"><span class="linenos">69</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Remover.removeForm-70"><a href="#Remover.removeForm-70"><span class="linenos">70</span></a>    <span class="k">def</span> <span class="nf">removeForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="Remover.removeForm-71"><a href="#Remover.removeForm-71"><span class="linenos">71</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="Remover.removeForm-72"><a href="#Remover.removeForm-72"><span class="linenos">72</span></a>        <span class="n">z_final</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">form</span>
</span><span id="Remover.removeForm-73"><a href="#Remover.removeForm-73"><span class="linenos">73</span></a>        <span class="k">return</span> <span class="n">z_final</span>
</span></pre></div>


    

                            </div>
                            <div id="Remover.plot3DForm" class="classattr">
                                        <input id="Remover.plot3DForm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">plot3DForm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span>, </span><span class="param"><span class="n">z</span>, </span><span class="param"><span class="n">coeff</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Remover.plot3DForm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Remover.plot3DForm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Remover.plot3DForm-75"><a href="#Remover.plot3DForm-75"><span class="linenos">75</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Remover.plot3DForm-76"><a href="#Remover.plot3DForm-76"><span class="linenos">76</span></a>    <span class="k">def</span> <span class="nf">plot3DForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="Remover.plot3DForm-77"><a href="#Remover.plot3DForm-77"><span class="linenos">77</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">polyval2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="Remover.plot3DForm-78"><a href="#Remover.plot3DForm-78"><span class="linenos">78</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;3d&#39;</span><span class="p">})</span>
</span><span id="Remover.plot3DForm-79"><a href="#Remover.plot3DForm-79"><span class="linenos">79</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Greys</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="Remover.plot3DForm-80"><a href="#Remover.plot3DForm-80"><span class="linenos">80</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">)</span>
</span><span id="Remover.plot3DForm-81"><a href="#Remover.plot3DForm-81"><span class="linenos">81</span></a>
</span><span id="Remover.plot3DForm-82"><a href="#Remover.plot3DForm-82"><span class="linenos">82</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="Remover.remove3DForm" class="classattr">
                                        <input id="Remover.remove3DForm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">remove3DForm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span>, </span><span class="param"><span class="n">z</span>, </span><span class="param"><span class="n">coeff</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Remover.remove3DForm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Remover.remove3DForm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Remover.remove3DForm-84"><a href="#Remover.remove3DForm-84"><span class="linenos">84</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Remover.remove3DForm-85"><a href="#Remover.remove3DForm-85"><span class="linenos">85</span></a>    <span class="k">def</span> <span class="nf">remove3DForm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
</span><span id="Remover.remove3DForm-86"><a href="#Remover.remove3DForm-86"><span class="linenos">86</span></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">polyval2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="Remover.remove3DForm-87"><a href="#Remover.remove3DForm-87"><span class="linenos">87</span></a>        <span class="n">z_final</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">form</span>
</span><span id="Remover.remove3DForm-88"><a href="#Remover.remove3DForm-88"><span class="linenos">88</span></a>        <span class="k">return</span> <span class="n">z_final</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="ProfileLSLine">
                            <input id="ProfileLSLine-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ProfileLSLine</span><wbr>(<span class="base"><a href="#Remover">Remover</a></span>):

                <label class="view-source-button" for="ProfileLSLine-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProfileLSLine"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProfileLSLine-91"><a href="#ProfileLSLine-91"><span class="linenos"> 91</span></a><span class="k">class</span> <span class="nc">ProfileLSLine</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="ProfileLSLine-92"><a href="#ProfileLSLine-92"><span class="linenos"> 92</span></a>    <span class="c1"># shortcut class to profile poly of degree 1 (implemented for simmetry)</span>
</span><span id="ProfileLSLine-93"><a href="#ProfileLSLine-93"><span class="linenos"> 93</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ProfileLSLine-94"><a href="#ProfileLSLine-94"><span class="linenos"> 94</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span><span id="ProfileLSLine-95"><a href="#ProfileLSLine-95"><span class="linenos"> 95</span></a>
</span><span id="ProfileLSLine-96"><a href="#ProfileLSLine-96"><span class="linenos"> 96</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ProfileLSLine-97"><a href="#ProfileLSLine-97"><span class="linenos"> 97</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ProfileLSLine-98"><a href="#ProfileLSLine-98"><span class="linenos"> 98</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ProfileLSLine-99"><a href="#ProfileLSLine-99"><span class="linenos"> 99</span></a><span class="sd">        Least square line fit implementation</span>
</span><span id="ProfileLSLine-100"><a href="#ProfileLSLine-100"><span class="linenos">100</span></a>
</span><span id="ProfileLSLine-101"><a href="#ProfileLSLine-101"><span class="linenos">101</span></a><span class="sd">        Parameters</span>
</span><span id="ProfileLSLine-102"><a href="#ProfileLSLine-102"><span class="linenos">102</span></a><span class="sd">        ----------</span>
</span><span id="ProfileLSLine-103"><a href="#ProfileLSLine-103"><span class="linenos">103</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="ProfileLSLine-104"><a href="#ProfileLSLine-104"><span class="linenos">104</span></a><span class="sd">            The profile object on wich the form is removed</span>
</span><span id="ProfileLSLine-105"><a href="#ProfileLSLine-105"><span class="linenos">105</span></a><span class="sd">        bplt: bool</span>
</span><span id="ProfileLSLine-106"><a href="#ProfileLSLine-106"><span class="linenos">106</span></a><span class="sd">            If True plots the line overimposed on the profile</span>
</span><span id="ProfileLSLine-107"><a href="#ProfileLSLine-107"><span class="linenos">107</span></a>
</span><span id="ProfileLSLine-108"><a href="#ProfileLSLine-108"><span class="linenos">108</span></a><span class="sd">        Returns</span>
</span><span id="ProfileLSLine-109"><a href="#ProfileLSLine-109"><span class="linenos">109</span></a><span class="sd">        ----------</span>
</span><span id="ProfileLSLine-110"><a href="#ProfileLSLine-110"><span class="linenos">110</span></a><span class="sd">        (m, q): (float, ...)</span>
</span><span id="ProfileLSLine-111"><a href="#ProfileLSLine-111"><span class="linenos">111</span></a><span class="sd">            The line equation coefficients</span>
</span><span id="ProfileLSLine-112"><a href="#ProfileLSLine-112"><span class="linenos">112</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ProfileLSLine-113"><a href="#ProfileLSLine-113"><span class="linenos">113</span></a>        <span class="c1"># create matrix and Z vector to use lstsq</span>
</span><span id="ProfileLSLine-114"><a href="#ProfileLSLine-114"><span class="linenos">114</span></a>        <span class="n">XZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">)),</span>
</span><span id="ProfileLSLine-115"><a href="#ProfileLSLine-115"><span class="linenos">115</span></a>                        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
</span><span id="ProfileLSLine-116"><a href="#ProfileLSLine-116"><span class="linenos">116</span></a>        <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span> <span class="o">=</span> <span class="n">XZ</span><span class="o">.</span><span class="n">shape</span>
</span><span id="ProfileLSLine-117"><a href="#ProfileLSLine-117"><span class="linenos">117</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="ProfileLSLine-118"><a href="#ProfileLSLine-118"><span class="linenos">118</span></a>        <span class="n">G</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">XZ</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># X</span>
</span><span id="ProfileLSLine-119"><a href="#ProfileLSLine-119"><span class="linenos">119</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">XZ</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="ProfileLSLine-120"><a href="#ProfileLSLine-120"><span class="linenos">120</span></a>        <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">resid</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># calculate LS line</span>
</span><span id="ProfileLSLine-121"><a href="#ProfileLSLine-121"><span class="linenos">121</span></a>
</span><span id="ProfileLSLine-122"><a href="#ProfileLSLine-122"><span class="linenos">122</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="ProfileLSLine-123"><a href="#ProfileLSLine-123"><span class="linenos">123</span></a>            <span class="n">Remover</span><span class="o">.</span><span class="n">plotForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
</span><span id="ProfileLSLine-124"><a href="#ProfileLSLine-124"><span class="linenos">124</span></a>
</span><span id="ProfileLSLine-125"><a href="#ProfileLSLine-125"><span class="linenos">125</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">removeForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
</span><span id="ProfileLSLine-126"><a href="#ProfileLSLine-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">q</span>
</span></pre></div>


    

                            <div id="ProfileLSLine.applyRemover" class="classattr">
                                        <input id="ProfileLSLine.applyRemover-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">applyRemover</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">obj</span><span class="p">:</span> <span class="n"><a href="profile.html#Profile">surfile.profile.Profile</a></span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ProfileLSLine.applyRemover-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProfileLSLine.applyRemover"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProfileLSLine.applyRemover-93"><a href="#ProfileLSLine.applyRemover-93"><span class="linenos">93</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ProfileLSLine.applyRemover-94"><a href="#ProfileLSLine.applyRemover-94"><span class="linenos">94</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="ProfileLSLine.remove" class="classattr">
                                        <input id="ProfileLSLine.remove-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">remove</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span><span class="p">:</span> <span class="n"><a href="profile.html#Profile">surfile.profile.Profile</a></span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ProfileLSLine.remove-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProfileLSLine.remove"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProfileLSLine.remove-96"><a href="#ProfileLSLine.remove-96"><span class="linenos"> 96</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ProfileLSLine.remove-97"><a href="#ProfileLSLine.remove-97"><span class="linenos"> 97</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ProfileLSLine.remove-98"><a href="#ProfileLSLine.remove-98"><span class="linenos"> 98</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ProfileLSLine.remove-99"><a href="#ProfileLSLine.remove-99"><span class="linenos"> 99</span></a><span class="sd">        Least square line fit implementation</span>
</span><span id="ProfileLSLine.remove-100"><a href="#ProfileLSLine.remove-100"><span class="linenos">100</span></a>
</span><span id="ProfileLSLine.remove-101"><a href="#ProfileLSLine.remove-101"><span class="linenos">101</span></a><span class="sd">        Parameters</span>
</span><span id="ProfileLSLine.remove-102"><a href="#ProfileLSLine.remove-102"><span class="linenos">102</span></a><span class="sd">        ----------</span>
</span><span id="ProfileLSLine.remove-103"><a href="#ProfileLSLine.remove-103"><span class="linenos">103</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="ProfileLSLine.remove-104"><a href="#ProfileLSLine.remove-104"><span class="linenos">104</span></a><span class="sd">            The profile object on wich the form is removed</span>
</span><span id="ProfileLSLine.remove-105"><a href="#ProfileLSLine.remove-105"><span class="linenos">105</span></a><span class="sd">        bplt: bool</span>
</span><span id="ProfileLSLine.remove-106"><a href="#ProfileLSLine.remove-106"><span class="linenos">106</span></a><span class="sd">            If True plots the line overimposed on the profile</span>
</span><span id="ProfileLSLine.remove-107"><a href="#ProfileLSLine.remove-107"><span class="linenos">107</span></a>
</span><span id="ProfileLSLine.remove-108"><a href="#ProfileLSLine.remove-108"><span class="linenos">108</span></a><span class="sd">        Returns</span>
</span><span id="ProfileLSLine.remove-109"><a href="#ProfileLSLine.remove-109"><span class="linenos">109</span></a><span class="sd">        ----------</span>
</span><span id="ProfileLSLine.remove-110"><a href="#ProfileLSLine.remove-110"><span class="linenos">110</span></a><span class="sd">        (m, q): (float, ...)</span>
</span><span id="ProfileLSLine.remove-111"><a href="#ProfileLSLine.remove-111"><span class="linenos">111</span></a><span class="sd">            The line equation coefficients</span>
</span><span id="ProfileLSLine.remove-112"><a href="#ProfileLSLine.remove-112"><span class="linenos">112</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ProfileLSLine.remove-113"><a href="#ProfileLSLine.remove-113"><span class="linenos">113</span></a>        <span class="c1"># create matrix and Z vector to use lstsq</span>
</span><span id="ProfileLSLine.remove-114"><a href="#ProfileLSLine.remove-114"><span class="linenos">114</span></a>        <span class="n">XZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">)),</span>
</span><span id="ProfileLSLine.remove-115"><a href="#ProfileLSLine.remove-115"><span class="linenos">115</span></a>                        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
</span><span id="ProfileLSLine.remove-116"><a href="#ProfileLSLine.remove-116"><span class="linenos">116</span></a>        <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span> <span class="o">=</span> <span class="n">XZ</span><span class="o">.</span><span class="n">shape</span>
</span><span id="ProfileLSLine.remove-117"><a href="#ProfileLSLine.remove-117"><span class="linenos">117</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="ProfileLSLine.remove-118"><a href="#ProfileLSLine.remove-118"><span class="linenos">118</span></a>        <span class="n">G</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">XZ</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># X</span>
</span><span id="ProfileLSLine.remove-119"><a href="#ProfileLSLine.remove-119"><span class="linenos">119</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">XZ</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="ProfileLSLine.remove-120"><a href="#ProfileLSLine.remove-120"><span class="linenos">120</span></a>        <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">resid</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># calculate LS line</span>
</span><span id="ProfileLSLine.remove-121"><a href="#ProfileLSLine.remove-121"><span class="linenos">121</span></a>
</span><span id="ProfileLSLine.remove-122"><a href="#ProfileLSLine.remove-122"><span class="linenos">122</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="ProfileLSLine.remove-123"><a href="#ProfileLSLine.remove-123"><span class="linenos">123</span></a>            <span class="n">Remover</span><span class="o">.</span><span class="n">plotForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
</span><span id="ProfileLSLine.remove-124"><a href="#ProfileLSLine.remove-124"><span class="linenos">124</span></a>
</span><span id="ProfileLSLine.remove-125"><a href="#ProfileLSLine.remove-125"><span class="linenos">125</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">removeForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">q</span><span class="p">])</span>
</span><span id="ProfileLSLine.remove-126"><a href="#ProfileLSLine.remove-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">q</span>
</span></pre></div>


            <div class="docstring"><p>Least square line fit implementation</p>

<h2 id="parameters">Parameters</h2>

<p>obj: profile.Profile
    The profile object on wich the form is removed
bplt: bool
    If True plots the line overimposed on the profile</p>

<h2 id="returns">Returns</h2>

<p>(m, q): (float, ...)
    The line equation coefficients</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Remover">Remover</a></dt>
                                <dd id="ProfileLSLine.plotForm" class="function"><a href="#Remover.plotForm">plotForm</a></dd>
                <dd id="ProfileLSLine.removeForm" class="function"><a href="#Remover.removeForm">removeForm</a></dd>
                <dd id="ProfileLSLine.plot3DForm" class="function"><a href="#Remover.plot3DForm">plot3DForm</a></dd>
                <dd id="ProfileLSLine.remove3DForm" class="function"><a href="#Remover.remove3DForm">remove3DForm</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ProfilePolynomial">
                            <input id="ProfilePolynomial-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ProfilePolynomial</span><wbr>(<span class="base"><a href="#Remover">Remover</a></span>):

                <label class="view-source-button" for="ProfilePolynomial-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProfilePolynomial"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProfilePolynomial-129"><a href="#ProfilePolynomial-129"><span class="linenos">129</span></a><span class="k">class</span> <span class="nc">ProfilePolynomial</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="ProfilePolynomial-130"><a href="#ProfilePolynomial-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ProfilePolynomial-131"><a href="#ProfilePolynomial-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">=</span> <span class="n">degree</span>
</span><span id="ProfilePolynomial-132"><a href="#ProfilePolynomial-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span>
</span><span id="ProfilePolynomial-133"><a href="#ProfilePolynomial-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bound</span> <span class="o">=</span> <span class="n">bound</span>
</span><span id="ProfilePolynomial-134"><a href="#ProfilePolynomial-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span> <span class="o">=</span> <span class="n">cutter</span>
</span><span id="ProfilePolynomial-135"><a href="#ProfilePolynomial-135"><span class="linenos">135</span></a>
</span><span id="ProfilePolynomial-136"><a href="#ProfilePolynomial-136"><span class="linenos">136</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ProfilePolynomial-137"><a href="#ProfilePolynomial-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span><span id="ProfilePolynomial-138"><a href="#ProfilePolynomial-138"><span class="linenos">138</span></a>
</span><span id="ProfilePolynomial-139"><a href="#ProfilePolynomial-139"><span class="linenos">139</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ProfilePolynomial-140"><a href="#ProfilePolynomial-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ProfilePolynomial-141"><a href="#ProfilePolynomial-141"><span class="linenos">141</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ProfilePolynomial-142"><a href="#ProfilePolynomial-142"><span class="linenos">142</span></a><span class="sd">        Plynomial fit implementation</span>
</span><span id="ProfilePolynomial-143"><a href="#ProfilePolynomial-143"><span class="linenos">143</span></a>
</span><span id="ProfilePolynomial-144"><a href="#ProfilePolynomial-144"><span class="linenos">144</span></a><span class="sd">        Parameters</span>
</span><span id="ProfilePolynomial-145"><a href="#ProfilePolynomial-145"><span class="linenos">145</span></a><span class="sd">        ----------</span>
</span><span id="ProfilePolynomial-146"><a href="#ProfilePolynomial-146"><span class="linenos">146</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="ProfilePolynomial-147"><a href="#ProfilePolynomial-147"><span class="linenos">147</span></a><span class="sd">            The profile object on wich the form is removed</span>
</span><span id="ProfilePolynomial-148"><a href="#ProfilePolynomial-148"><span class="linenos">148</span></a><span class="sd">        comp: funct / lambda</span>
</span><span id="ProfilePolynomial-149"><a href="#ProfilePolynomial-149"><span class="linenos">149</span></a><span class="sd">            comparison method between bound and profile</span>
</span><span id="ProfilePolynomial-150"><a href="#ProfilePolynomial-150"><span class="linenos">150</span></a><span class="sd">        degree: int</span>
</span><span id="ProfilePolynomial-151"><a href="#ProfilePolynomial-151"><span class="linenos">151</span></a><span class="sd">            polynomial degree</span>
</span><span id="ProfilePolynomial-152"><a href="#ProfilePolynomial-152"><span class="linenos">152</span></a><span class="sd">        bound: float</span>
</span><span id="ProfilePolynomial-153"><a href="#ProfilePolynomial-153"><span class="linenos">153</span></a><span class="sd">            -if not set the fit uses all points,</span>
</span><span id="ProfilePolynomial-154"><a href="#ProfilePolynomial-154"><span class="linenos">154</span></a><span class="sd">            -if set the fit uses all points below the values,</span>
</span><span id="ProfilePolynomial-155"><a href="#ProfilePolynomial-155"><span class="linenos">155</span></a><span class="sd">            -if set to True the fit uses only the values below the average value of the profile</span>
</span><span id="ProfilePolynomial-156"><a href="#ProfilePolynomial-156"><span class="linenos">156</span></a><span class="sd">        cutter: cutter.Cutter</span>
</span><span id="ProfilePolynomial-157"><a href="#ProfilePolynomial-157"><span class="linenos">157</span></a><span class="sd">            -if not set, the fit uses all points</span>
</span><span id="ProfilePolynomial-158"><a href="#ProfilePolynomial-158"><span class="linenos">158</span></a><span class="sd">            -if true allows the user to select manually the region of interest</span>
</span><span id="ProfilePolynomial-159"><a href="#ProfilePolynomial-159"><span class="linenos">159</span></a><span class="sd">            -if a cutter obj is passed the fit is done only on the cutted profile points</span>
</span><span id="ProfilePolynomial-160"><a href="#ProfilePolynomial-160"><span class="linenos">160</span></a><span class="sd">             and then applied on the whole profile</span>
</span><span id="ProfilePolynomial-161"><a href="#ProfilePolynomial-161"><span class="linenos">161</span></a><span class="sd">        bplt: bool</span>
</span><span id="ProfilePolynomial-162"><a href="#ProfilePolynomial-162"><span class="linenos">162</span></a><span class="sd">            If True plots the polynomial form overimposed on the profile</span>
</span><span id="ProfilePolynomial-163"><a href="#ProfilePolynomial-163"><span class="linenos">163</span></a>
</span><span id="ProfilePolynomial-164"><a href="#ProfilePolynomial-164"><span class="linenos">164</span></a><span class="sd">        Returns</span>
</span><span id="ProfilePolynomial-165"><a href="#ProfilePolynomial-165"><span class="linenos">165</span></a><span class="sd">        ----------</span>
</span><span id="ProfilePolynomial-166"><a href="#ProfilePolynomial-166"><span class="linenos">166</span></a><span class="sd">        coeff: np.array()</span>
</span><span id="ProfilePolynomial-167"><a href="#ProfilePolynomial-167"><span class="linenos">167</span></a><span class="sd">            The polynomial form coefficients</span>
</span><span id="ProfilePolynomial-168"><a href="#ProfilePolynomial-168"><span class="linenos">168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ProfilePolynomial-169"><a href="#ProfilePolynomial-169"><span class="linenos">169</span></a>
</span><span id="ProfilePolynomial-170"><a href="#ProfilePolynomial-170"><span class="linenos">170</span></a>        <span class="k">if</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># if the fit is only on part of the profile the user chooses</span>
</span><span id="ProfilePolynomial-171"><a href="#ProfilePolynomial-171"><span class="linenos">171</span></a>            <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">cutr</span><span class="o">.</span><span class="n">ProfileCutter</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ProfilePolynomial-172"><a href="#ProfilePolynomial-172"><span class="linenos">172</span></a>        <span class="k">elif</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ProfilePolynomial-173"><a href="#ProfilePolynomial-173"><span class="linenos">173</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">cutter</span><span class="o">.</span><span class="n">applyCut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ProfilePolynomial-174"><a href="#ProfilePolynomial-174"><span class="linenos">174</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># use the whole profile</span>
</span><span id="ProfilePolynomial-175"><a href="#ProfilePolynomial-175"><span class="linenos">175</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span>
</span><span id="ProfilePolynomial-176"><a href="#ProfilePolynomial-176"><span class="linenos">176</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span>
</span><span id="ProfilePolynomial-177"><a href="#ProfilePolynomial-177"><span class="linenos">177</span></a>
</span><span id="ProfilePolynomial-178"><a href="#ProfilePolynomial-178"><span class="linenos">178</span></a>        <span class="k">if</span> <span class="n">bound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ProfilePolynomial-179"><a href="#ProfilePolynomial-179"><span class="linenos">179</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
</span><span id="ProfilePolynomial-180"><a href="#ProfilePolynomial-180"><span class="linenos">180</span></a>        <span class="k">elif</span> <span class="n">bound</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="ProfilePolynomial-181"><a href="#ProfilePolynomial-181"><span class="linenos">181</span></a>            <span class="n">bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="ProfilePolynomial-182"><a href="#ProfilePolynomial-182"><span class="linenos">182</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">comp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">bound</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="ProfilePolynomial-183"><a href="#ProfilePolynomial-183"><span class="linenos">183</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">degree</span><span class="p">)</span>
</span><span id="ProfilePolynomial-184"><a href="#ProfilePolynomial-184"><span class="linenos">184</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ProfilePolynomial-185"><a href="#ProfilePolynomial-185"><span class="linenos">185</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">comp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">bound</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="ProfilePolynomial-186"><a href="#ProfilePolynomial-186"><span class="linenos">186</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">degree</span><span class="p">)</span>
</span><span id="ProfilePolynomial-187"><a href="#ProfilePolynomial-187"><span class="linenos">187</span></a>
</span><span id="ProfilePolynomial-188"><a href="#ProfilePolynomial-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="ProfilePolynomial-189"><a href="#ProfilePolynomial-189"><span class="linenos">189</span></a>            <span class="n">Remover</span><span class="o">.</span><span class="n">plotForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="ProfilePolynomial-190"><a href="#ProfilePolynomial-190"><span class="linenos">190</span></a>
</span><span id="ProfilePolynomial-191"><a href="#ProfilePolynomial-191"><span class="linenos">191</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">removeForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="ProfilePolynomial-192"><a href="#ProfilePolynomial-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="n">coeff</span>
</span></pre></div>


    

                            <div id="ProfilePolynomial.__init__" class="classattr">
                                        <input id="ProfilePolynomial.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ProfilePolynomial</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">degree</span>,</span><span class="param">	<span class="n">comp</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">ProfilePolynomial</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;&gt;</span>,</span><span class="param">	<span class="n">bound</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">cutter</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ProfilePolynomial.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProfilePolynomial.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProfilePolynomial.__init__-130"><a href="#ProfilePolynomial.__init__-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ProfilePolynomial.__init__-131"><a href="#ProfilePolynomial.__init__-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">=</span> <span class="n">degree</span>
</span><span id="ProfilePolynomial.__init__-132"><a href="#ProfilePolynomial.__init__-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span>
</span><span id="ProfilePolynomial.__init__-133"><a href="#ProfilePolynomial.__init__-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bound</span> <span class="o">=</span> <span class="n">bound</span>
</span><span id="ProfilePolynomial.__init__-134"><a href="#ProfilePolynomial.__init__-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span> <span class="o">=</span> <span class="n">cutter</span>
</span></pre></div>


    

                            </div>
                            <div id="ProfilePolynomial.applyRemover" class="classattr">
                                        <input id="ProfilePolynomial.applyRemover-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">applyRemover</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">obj</span><span class="p">:</span> <span class="n"><a href="profile.html#Profile">surfile.profile.Profile</a></span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ProfilePolynomial.applyRemover-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProfilePolynomial.applyRemover"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProfilePolynomial.applyRemover-136"><a href="#ProfilePolynomial.applyRemover-136"><span class="linenos">136</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ProfilePolynomial.applyRemover-137"><a href="#ProfilePolynomial.applyRemover-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="ProfilePolynomial.remove" class="classattr">
                                        <input id="ProfilePolynomial.remove-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">remove</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obj</span><span class="p">:</span> <span class="n"><a href="profile.html#Profile">surfile.profile.Profile</a></span>,</span><span class="param">	<span class="n">degree</span>,</span><span class="param">	<span class="n">comp</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">ProfilePolynomial</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;&gt;</span>,</span><span class="param">	<span class="n">bound</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">cutter</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ProfilePolynomial.remove-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProfilePolynomial.remove"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProfilePolynomial.remove-139"><a href="#ProfilePolynomial.remove-139"><span class="linenos">139</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ProfilePolynomial.remove-140"><a href="#ProfilePolynomial.remove-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ProfilePolynomial.remove-141"><a href="#ProfilePolynomial.remove-141"><span class="linenos">141</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ProfilePolynomial.remove-142"><a href="#ProfilePolynomial.remove-142"><span class="linenos">142</span></a><span class="sd">        Plynomial fit implementation</span>
</span><span id="ProfilePolynomial.remove-143"><a href="#ProfilePolynomial.remove-143"><span class="linenos">143</span></a>
</span><span id="ProfilePolynomial.remove-144"><a href="#ProfilePolynomial.remove-144"><span class="linenos">144</span></a><span class="sd">        Parameters</span>
</span><span id="ProfilePolynomial.remove-145"><a href="#ProfilePolynomial.remove-145"><span class="linenos">145</span></a><span class="sd">        ----------</span>
</span><span id="ProfilePolynomial.remove-146"><a href="#ProfilePolynomial.remove-146"><span class="linenos">146</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="ProfilePolynomial.remove-147"><a href="#ProfilePolynomial.remove-147"><span class="linenos">147</span></a><span class="sd">            The profile object on wich the form is removed</span>
</span><span id="ProfilePolynomial.remove-148"><a href="#ProfilePolynomial.remove-148"><span class="linenos">148</span></a><span class="sd">        comp: funct / lambda</span>
</span><span id="ProfilePolynomial.remove-149"><a href="#ProfilePolynomial.remove-149"><span class="linenos">149</span></a><span class="sd">            comparison method between bound and profile</span>
</span><span id="ProfilePolynomial.remove-150"><a href="#ProfilePolynomial.remove-150"><span class="linenos">150</span></a><span class="sd">        degree: int</span>
</span><span id="ProfilePolynomial.remove-151"><a href="#ProfilePolynomial.remove-151"><span class="linenos">151</span></a><span class="sd">            polynomial degree</span>
</span><span id="ProfilePolynomial.remove-152"><a href="#ProfilePolynomial.remove-152"><span class="linenos">152</span></a><span class="sd">        bound: float</span>
</span><span id="ProfilePolynomial.remove-153"><a href="#ProfilePolynomial.remove-153"><span class="linenos">153</span></a><span class="sd">            -if not set the fit uses all points,</span>
</span><span id="ProfilePolynomial.remove-154"><a href="#ProfilePolynomial.remove-154"><span class="linenos">154</span></a><span class="sd">            -if set the fit uses all points below the values,</span>
</span><span id="ProfilePolynomial.remove-155"><a href="#ProfilePolynomial.remove-155"><span class="linenos">155</span></a><span class="sd">            -if set to True the fit uses only the values below the average value of the profile</span>
</span><span id="ProfilePolynomial.remove-156"><a href="#ProfilePolynomial.remove-156"><span class="linenos">156</span></a><span class="sd">        cutter: cutter.Cutter</span>
</span><span id="ProfilePolynomial.remove-157"><a href="#ProfilePolynomial.remove-157"><span class="linenos">157</span></a><span class="sd">            -if not set, the fit uses all points</span>
</span><span id="ProfilePolynomial.remove-158"><a href="#ProfilePolynomial.remove-158"><span class="linenos">158</span></a><span class="sd">            -if true allows the user to select manually the region of interest</span>
</span><span id="ProfilePolynomial.remove-159"><a href="#ProfilePolynomial.remove-159"><span class="linenos">159</span></a><span class="sd">            -if a cutter obj is passed the fit is done only on the cutted profile points</span>
</span><span id="ProfilePolynomial.remove-160"><a href="#ProfilePolynomial.remove-160"><span class="linenos">160</span></a><span class="sd">             and then applied on the whole profile</span>
</span><span id="ProfilePolynomial.remove-161"><a href="#ProfilePolynomial.remove-161"><span class="linenos">161</span></a><span class="sd">        bplt: bool</span>
</span><span id="ProfilePolynomial.remove-162"><a href="#ProfilePolynomial.remove-162"><span class="linenos">162</span></a><span class="sd">            If True plots the polynomial form overimposed on the profile</span>
</span><span id="ProfilePolynomial.remove-163"><a href="#ProfilePolynomial.remove-163"><span class="linenos">163</span></a>
</span><span id="ProfilePolynomial.remove-164"><a href="#ProfilePolynomial.remove-164"><span class="linenos">164</span></a><span class="sd">        Returns</span>
</span><span id="ProfilePolynomial.remove-165"><a href="#ProfilePolynomial.remove-165"><span class="linenos">165</span></a><span class="sd">        ----------</span>
</span><span id="ProfilePolynomial.remove-166"><a href="#ProfilePolynomial.remove-166"><span class="linenos">166</span></a><span class="sd">        coeff: np.array()</span>
</span><span id="ProfilePolynomial.remove-167"><a href="#ProfilePolynomial.remove-167"><span class="linenos">167</span></a><span class="sd">            The polynomial form coefficients</span>
</span><span id="ProfilePolynomial.remove-168"><a href="#ProfilePolynomial.remove-168"><span class="linenos">168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ProfilePolynomial.remove-169"><a href="#ProfilePolynomial.remove-169"><span class="linenos">169</span></a>
</span><span id="ProfilePolynomial.remove-170"><a href="#ProfilePolynomial.remove-170"><span class="linenos">170</span></a>        <span class="k">if</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># if the fit is only on part of the profile the user chooses</span>
</span><span id="ProfilePolynomial.remove-171"><a href="#ProfilePolynomial.remove-171"><span class="linenos">171</span></a>            <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">cutr</span><span class="o">.</span><span class="n">ProfileCutter</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ProfilePolynomial.remove-172"><a href="#ProfilePolynomial.remove-172"><span class="linenos">172</span></a>        <span class="k">elif</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ProfilePolynomial.remove-173"><a href="#ProfilePolynomial.remove-173"><span class="linenos">173</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">cutter</span><span class="o">.</span><span class="n">applyCut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ProfilePolynomial.remove-174"><a href="#ProfilePolynomial.remove-174"><span class="linenos">174</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># use the whole profile</span>
</span><span id="ProfilePolynomial.remove-175"><a href="#ProfilePolynomial.remove-175"><span class="linenos">175</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span>
</span><span id="ProfilePolynomial.remove-176"><a href="#ProfilePolynomial.remove-176"><span class="linenos">176</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span>
</span><span id="ProfilePolynomial.remove-177"><a href="#ProfilePolynomial.remove-177"><span class="linenos">177</span></a>
</span><span id="ProfilePolynomial.remove-178"><a href="#ProfilePolynomial.remove-178"><span class="linenos">178</span></a>        <span class="k">if</span> <span class="n">bound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ProfilePolynomial.remove-179"><a href="#ProfilePolynomial.remove-179"><span class="linenos">179</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
</span><span id="ProfilePolynomial.remove-180"><a href="#ProfilePolynomial.remove-180"><span class="linenos">180</span></a>        <span class="k">elif</span> <span class="n">bound</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="ProfilePolynomial.remove-181"><a href="#ProfilePolynomial.remove-181"><span class="linenos">181</span></a>            <span class="n">bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="ProfilePolynomial.remove-182"><a href="#ProfilePolynomial.remove-182"><span class="linenos">182</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">comp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">bound</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="ProfilePolynomial.remove-183"><a href="#ProfilePolynomial.remove-183"><span class="linenos">183</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">degree</span><span class="p">)</span>
</span><span id="ProfilePolynomial.remove-184"><a href="#ProfilePolynomial.remove-184"><span class="linenos">184</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ProfilePolynomial.remove-185"><a href="#ProfilePolynomial.remove-185"><span class="linenos">185</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">comp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">bound</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="ProfilePolynomial.remove-186"><a href="#ProfilePolynomial.remove-186"><span class="linenos">186</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">degree</span><span class="p">)</span>
</span><span id="ProfilePolynomial.remove-187"><a href="#ProfilePolynomial.remove-187"><span class="linenos">187</span></a>
</span><span id="ProfilePolynomial.remove-188"><a href="#ProfilePolynomial.remove-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="ProfilePolynomial.remove-189"><a href="#ProfilePolynomial.remove-189"><span class="linenos">189</span></a>            <span class="n">Remover</span><span class="o">.</span><span class="n">plotForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="ProfilePolynomial.remove-190"><a href="#ProfilePolynomial.remove-190"><span class="linenos">190</span></a>
</span><span id="ProfilePolynomial.remove-191"><a href="#ProfilePolynomial.remove-191"><span class="linenos">191</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">removeForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
</span><span id="ProfilePolynomial.remove-192"><a href="#ProfilePolynomial.remove-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="n">coeff</span>
</span></pre></div>


            <div class="docstring"><p>Plynomial fit implementation</p>

<h2 id="parameters">Parameters</h2>

<p>obj: profile.Profile
    The profile object on wich the form is removed
comp: funct / lambda
    comparison method between bound and profile
degree: int
    polynomial degree
bound: float
    -if not set the fit uses all points,
    -if set the fit uses all points below the values,
    -if set to True the fit uses only the values below the average value of the profile
cutter: cutter.Cutter
    -if not set, the fit uses all points
    -if true allows the user to select manually the region of interest
    -if a cutter obj is passed the fit is done only on the cutted profile points
     and then applied on the whole profile
bplt: bool
    If True plots the polynomial form overimposed on the profile</p>

<h2 id="returns">Returns</h2>

<p>coeff: np.array()
    The polynomial form coefficients</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Remover">Remover</a></dt>
                                <dd id="ProfilePolynomial.plotForm" class="function"><a href="#Remover.plotForm">plotForm</a></dd>
                <dd id="ProfilePolynomial.removeForm" class="function"><a href="#Remover.removeForm">removeForm</a></dd>
                <dd id="ProfilePolynomial.plot3DForm" class="function"><a href="#Remover.plot3DForm">plot3DForm</a></dd>
                <dd id="ProfilePolynomial.remove3DForm" class="function"><a href="#Remover.remove3DForm">remove3DForm</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ProfileHistogram">
                            <input id="ProfileHistogram-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ProfileHistogram</span><wbr>(<span class="base"><a href="#Remover">Remover</a></span>):

                <label class="view-source-button" for="ProfileHistogram-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProfileHistogram"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProfileHistogram-196"><a href="#ProfileHistogram-196"><span class="linenos">196</span></a><span class="k">class</span> <span class="nc">ProfileHistogram</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>  <span class="c1"># Still not working well</span>
</span><span id="ProfileHistogram-197"><a href="#ProfileHistogram-197"><span class="linenos">197</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ProfileHistogram-198"><a href="#ProfileHistogram-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">final_m</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ProfileHistogram-199"><a href="#ProfileHistogram-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ProfileHistogram-200"><a href="#ProfileHistogram-200"><span class="linenos">200</span></a><span class="sd">        Alligns the profile using the recursive histogram method, stops when</span>
</span><span id="ProfileHistogram-201"><a href="#ProfileHistogram-201"><span class="linenos">201</span></a><span class="sd">        the tilt correction is less than the parameter final_m</span>
</span><span id="ProfileHistogram-202"><a href="#ProfileHistogram-202"><span class="linenos">202</span></a>
</span><span id="ProfileHistogram-203"><a href="#ProfileHistogram-203"><span class="linenos">203</span></a><span class="sd">        Parameters</span>
</span><span id="ProfileHistogram-204"><a href="#ProfileHistogram-204"><span class="linenos">204</span></a><span class="sd">        ----------</span>
</span><span id="ProfileHistogram-205"><a href="#ProfileHistogram-205"><span class="linenos">205</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="ProfileHistogram-206"><a href="#ProfileHistogram-206"><span class="linenos">206</span></a><span class="sd">            The profile object on wich the form is removed</span>
</span><span id="ProfileHistogram-207"><a href="#ProfileHistogram-207"><span class="linenos">207</span></a><span class="sd">        final_m: float</span>
</span><span id="ProfileHistogram-208"><a href="#ProfileHistogram-208"><span class="linenos">208</span></a><span class="sd">            The end slope correction</span>
</span><span id="ProfileHistogram-209"><a href="#ProfileHistogram-209"><span class="linenos">209</span></a><span class="sd">        bplt: bool</span>
</span><span id="ProfileHistogram-210"><a href="#ProfileHistogram-210"><span class="linenos">210</span></a><span class="sd">            Plots the histogram evolution over the iterations</span>
</span><span id="ProfileHistogram-211"><a href="#ProfileHistogram-211"><span class="linenos">211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ProfileHistogram-212"><a href="#ProfileHistogram-212"><span class="linenos">212</span></a>        <span class="n">m</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">fitLineLS</span><span class="p">()</span>  <span class="c1"># preprocess inclination</span>
</span><span id="ProfileHistogram-213"><a href="#ProfileHistogram-213"><span class="linenos">213</span></a>        <span class="n">tot_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
</span><span id="ProfileHistogram-214"><a href="#ProfileHistogram-214"><span class="linenos">214</span></a>        <span class="c1"># threshold = 50 / tot_bins</span>
</span><span id="ProfileHistogram-215"><a href="#ProfileHistogram-215"><span class="linenos">215</span></a>
</span><span id="ProfileHistogram-216"><a href="#ProfileHistogram-216"><span class="linenos">216</span></a>        <span class="n">line_m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="mi">10</span>  <span class="c1"># start incline</span>
</span><span id="ProfileHistogram-217"><a href="#ProfileHistogram-217"><span class="linenos">217</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hist method -&gt; Start slope  </span><span class="si">{</span><span class="n">line_m</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ProfileHistogram-218"><a href="#ProfileHistogram-218"><span class="linenos">218</span></a>
</span><span id="ProfileHistogram-219"><a href="#ProfileHistogram-219"><span class="linenos">219</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="ProfileHistogram-220"><a href="#ProfileHistogram-220"><span class="linenos">220</span></a>        <span class="n">ax_h</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
</span><span id="ProfileHistogram-221"><a href="#ProfileHistogram-221"><span class="linenos">221</span></a>        <span class="n">bx_h</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
</span><span id="ProfileHistogram-222"><a href="#ProfileHistogram-222"><span class="linenos">222</span></a>
</span><span id="ProfileHistogram-223"><a href="#ProfileHistogram-223"><span class="linenos">223</span></a>        <span class="k">def</span> <span class="nf">calcNBUT</span><span class="p">():</span>
</span><span id="ProfileHistogram-224"><a href="#ProfileHistogram-224"><span class="linenos">224</span></a>            <span class="n">hist</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">histMethod</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">tot_bins</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># make the hist</span>
</span><span id="ProfileHistogram-225"><a href="#ProfileHistogram-225"><span class="linenos">225</span></a>            <span class="n">weights</span> <span class="o">=</span> <span class="n">hist</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="ProfileHistogram-226"><a href="#ProfileHistogram-226"><span class="linenos">226</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span>
</span><span id="ProfileHistogram-227"><a href="#ProfileHistogram-227"><span class="linenos">227</span></a>            <span class="n">n_bins_under_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">weights</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># how many bins under th</span>
</span><span id="ProfileHistogram-228"><a href="#ProfileHistogram-228"><span class="linenos">228</span></a>
</span><span id="ProfileHistogram-229"><a href="#ProfileHistogram-229"><span class="linenos">229</span></a>            <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="ProfileHistogram-230"><a href="#ProfileHistogram-230"><span class="linenos">230</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ProfileHistogram-231"><a href="#ProfileHistogram-231"><span class="linenos">231</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="ProfileHistogram-232"><a href="#ProfileHistogram-232"><span class="linenos">232</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">hist</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="ProfileHistogram-233"><a href="#ProfileHistogram-233"><span class="linenos">233</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.25</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;NBUT = </span><span class="si">{</span><span class="n">n_bins_under_threshold</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="n">tot_bins</span><span class="si">}</span><span class="s1">, line_m = </span><span class="si">{</span><span class="n">line_m</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> -&gt; </span><span class="si">{</span><span class="n">final_m</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="ProfileHistogram-234"><a href="#ProfileHistogram-234"><span class="linenos">234</span></a>                          <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax_h</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
</span><span id="ProfileHistogram-235"><a href="#ProfileHistogram-235"><span class="linenos">235</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span><span id="ProfileHistogram-236"><a href="#ProfileHistogram-236"><span class="linenos">236</span></a>
</span><span id="ProfileHistogram-237"><a href="#ProfileHistogram-237"><span class="linenos">237</span></a>                <span class="n">bx_h</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ProfileHistogram-238"><a href="#ProfileHistogram-238"><span class="linenos">238</span></a>                <span class="n">bx_h</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="ProfileHistogram-239"><a href="#ProfileHistogram-239"><span class="linenos">239</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="ProfileHistogram-240"><a href="#ProfileHistogram-240"><span class="linenos">240</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="ProfileHistogram-241"><a href="#ProfileHistogram-241"><span class="linenos">241</span></a>
</span><span id="ProfileHistogram-242"><a href="#ProfileHistogram-242"><span class="linenos">242</span></a>            <span class="k">return</span> <span class="n">n_bins_under_threshold</span>
</span><span id="ProfileHistogram-243"><a href="#ProfileHistogram-243"><span class="linenos">243</span></a>
</span><span id="ProfileHistogram-244"><a href="#ProfileHistogram-244"><span class="linenos">244</span></a>        <span class="n">param</span> <span class="o">=</span> <span class="n">calcNBUT</span><span class="p">()</span>
</span><span id="ProfileHistogram-245"><a href="#ProfileHistogram-245"><span class="linenos">245</span></a>        <span class="n">n_row</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ProfileHistogram-246"><a href="#ProfileHistogram-246"><span class="linenos">246</span></a>        <span class="c1"># until I have enough bins &lt; th keep loop</span>
</span><span id="ProfileHistogram-247"><a href="#ProfileHistogram-247"><span class="linenos">247</span></a>        <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">line_m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">final_m</span><span class="p">:</span>  <span class="c1"># nbut &lt; (tot_bins - tot_bins / 20):</span>
</span><span id="ProfileHistogram-248"><a href="#ProfileHistogram-248"><span class="linenos">248</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">line_m</span>
</span><span id="ProfileHistogram-249"><a href="#ProfileHistogram-249"><span class="linenos">249</span></a>            <span class="n">param_old</span> <span class="o">=</span> <span class="n">param</span>
</span><span id="ProfileHistogram-250"><a href="#ProfileHistogram-250"><span class="linenos">250</span></a>            <span class="n">param</span> <span class="o">=</span> <span class="n">calcNBUT</span><span class="p">()</span>
</span><span id="ProfileHistogram-251"><a href="#ProfileHistogram-251"><span class="linenos">251</span></a>
</span><span id="ProfileHistogram-252"><a href="#ProfileHistogram-252"><span class="linenos">252</span></a>            <span class="k">if</span> <span class="n">param</span> <span class="o">&lt;</span> <span class="n">param_old</span><span class="p">:</span>  <span class="c1"># invert rotation if we are going the wrong way</span>
</span><span id="ProfileHistogram-253"><a href="#ProfileHistogram-253"><span class="linenos">253</span></a>                <span class="n">line_m</span> <span class="o">=</span> <span class="o">-</span><span class="n">line_m</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="ProfileHistogram-254"><a href="#ProfileHistogram-254"><span class="linenos">254</span></a>
</span><span id="ProfileHistogram-255"><a href="#ProfileHistogram-255"><span class="linenos">255</span></a>            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="n">param_old</span><span class="p">:</span>
</span><span id="ProfileHistogram-256"><a href="#ProfileHistogram-256"><span class="linenos">256</span></a>                <span class="n">n_row</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ProfileHistogram-257"><a href="#ProfileHistogram-257"><span class="linenos">257</span></a>                <span class="k">if</span> <span class="n">n_row</span> <span class="o">&gt;=</span> <span class="mi">15</span><span class="p">:</span> <span class="k">break</span>  <span class="c1"># we got stuck for too long</span>
</span><span id="ProfileHistogram-258"><a href="#ProfileHistogram-258"><span class="linenos">258</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ProfileHistogram-259"><a href="#ProfileHistogram-259"><span class="linenos">259</span></a>                <span class="n">n_row</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ProfileHistogram-260"><a href="#ProfileHistogram-260"><span class="linenos">260</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hist method -&gt; End slope </span><span class="si">{</span><span class="n">line_m</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="ProfileHistogram.remove" class="classattr">
                                        <input id="ProfileHistogram.remove-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">remove</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span><span class="p">:</span> <span class="n"><a href="profile.html#Profile">surfile.profile.Profile</a></span>, </span><span class="param"><span class="n">final_m</span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ProfileHistogram.remove-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProfileHistogram.remove"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProfileHistogram.remove-197"><a href="#ProfileHistogram.remove-197"><span class="linenos">197</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ProfileHistogram.remove-198"><a href="#ProfileHistogram.remove-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">,</span> <span class="n">final_m</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ProfileHistogram.remove-199"><a href="#ProfileHistogram.remove-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ProfileHistogram.remove-200"><a href="#ProfileHistogram.remove-200"><span class="linenos">200</span></a><span class="sd">        Alligns the profile using the recursive histogram method, stops when</span>
</span><span id="ProfileHistogram.remove-201"><a href="#ProfileHistogram.remove-201"><span class="linenos">201</span></a><span class="sd">        the tilt correction is less than the parameter final_m</span>
</span><span id="ProfileHistogram.remove-202"><a href="#ProfileHistogram.remove-202"><span class="linenos">202</span></a>
</span><span id="ProfileHistogram.remove-203"><a href="#ProfileHistogram.remove-203"><span class="linenos">203</span></a><span class="sd">        Parameters</span>
</span><span id="ProfileHistogram.remove-204"><a href="#ProfileHistogram.remove-204"><span class="linenos">204</span></a><span class="sd">        ----------</span>
</span><span id="ProfileHistogram.remove-205"><a href="#ProfileHistogram.remove-205"><span class="linenos">205</span></a><span class="sd">        obj: profile.Profile</span>
</span><span id="ProfileHistogram.remove-206"><a href="#ProfileHistogram.remove-206"><span class="linenos">206</span></a><span class="sd">            The profile object on wich the form is removed</span>
</span><span id="ProfileHistogram.remove-207"><a href="#ProfileHistogram.remove-207"><span class="linenos">207</span></a><span class="sd">        final_m: float</span>
</span><span id="ProfileHistogram.remove-208"><a href="#ProfileHistogram.remove-208"><span class="linenos">208</span></a><span class="sd">            The end slope correction</span>
</span><span id="ProfileHistogram.remove-209"><a href="#ProfileHistogram.remove-209"><span class="linenos">209</span></a><span class="sd">        bplt: bool</span>
</span><span id="ProfileHistogram.remove-210"><a href="#ProfileHistogram.remove-210"><span class="linenos">210</span></a><span class="sd">            Plots the histogram evolution over the iterations</span>
</span><span id="ProfileHistogram.remove-211"><a href="#ProfileHistogram.remove-211"><span class="linenos">211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ProfileHistogram.remove-212"><a href="#ProfileHistogram.remove-212"><span class="linenos">212</span></a>        <span class="n">m</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">fitLineLS</span><span class="p">()</span>  <span class="c1"># preprocess inclination</span>
</span><span id="ProfileHistogram.remove-213"><a href="#ProfileHistogram.remove-213"><span class="linenos">213</span></a>        <span class="n">tot_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
</span><span id="ProfileHistogram.remove-214"><a href="#ProfileHistogram.remove-214"><span class="linenos">214</span></a>        <span class="c1"># threshold = 50 / tot_bins</span>
</span><span id="ProfileHistogram.remove-215"><a href="#ProfileHistogram.remove-215"><span class="linenos">215</span></a>
</span><span id="ProfileHistogram.remove-216"><a href="#ProfileHistogram.remove-216"><span class="linenos">216</span></a>        <span class="n">line_m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="mi">10</span>  <span class="c1"># start incline</span>
</span><span id="ProfileHistogram.remove-217"><a href="#ProfileHistogram.remove-217"><span class="linenos">217</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hist method -&gt; Start slope  </span><span class="si">{</span><span class="n">line_m</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ProfileHistogram.remove-218"><a href="#ProfileHistogram.remove-218"><span class="linenos">218</span></a>
</span><span id="ProfileHistogram.remove-219"><a href="#ProfileHistogram.remove-219"><span class="linenos">219</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="ProfileHistogram.remove-220"><a href="#ProfileHistogram.remove-220"><span class="linenos">220</span></a>        <span class="n">ax_h</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
</span><span id="ProfileHistogram.remove-221"><a href="#ProfileHistogram.remove-221"><span class="linenos">221</span></a>        <span class="n">bx_h</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
</span><span id="ProfileHistogram.remove-222"><a href="#ProfileHistogram.remove-222"><span class="linenos">222</span></a>
</span><span id="ProfileHistogram.remove-223"><a href="#ProfileHistogram.remove-223"><span class="linenos">223</span></a>        <span class="k">def</span> <span class="nf">calcNBUT</span><span class="p">():</span>
</span><span id="ProfileHistogram.remove-224"><a href="#ProfileHistogram.remove-224"><span class="linenos">224</span></a>            <span class="n">hist</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">histMethod</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">tot_bins</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># make the hist</span>
</span><span id="ProfileHistogram.remove-225"><a href="#ProfileHistogram.remove-225"><span class="linenos">225</span></a>            <span class="n">weights</span> <span class="o">=</span> <span class="n">hist</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span><span id="ProfileHistogram.remove-226"><a href="#ProfileHistogram.remove-226"><span class="linenos">226</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span>
</span><span id="ProfileHistogram.remove-227"><a href="#ProfileHistogram.remove-227"><span class="linenos">227</span></a>            <span class="n">n_bins_under_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">weights</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># how many bins under th</span>
</span><span id="ProfileHistogram.remove-228"><a href="#ProfileHistogram.remove-228"><span class="linenos">228</span></a>
</span><span id="ProfileHistogram.remove-229"><a href="#ProfileHistogram.remove-229"><span class="linenos">229</span></a>            <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="ProfileHistogram.remove-230"><a href="#ProfileHistogram.remove-230"><span class="linenos">230</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ProfileHistogram.remove-231"><a href="#ProfileHistogram.remove-231"><span class="linenos">231</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="ProfileHistogram.remove-232"><a href="#ProfileHistogram.remove-232"><span class="linenos">232</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">hist</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="ProfileHistogram.remove-233"><a href="#ProfileHistogram.remove-233"><span class="linenos">233</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.25</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;NBUT = </span><span class="si">{</span><span class="n">n_bins_under_threshold</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="n">tot_bins</span><span class="si">}</span><span class="s1">, line_m = </span><span class="si">{</span><span class="n">line_m</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> -&gt; </span><span class="si">{</span><span class="n">final_m</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="ProfileHistogram.remove-234"><a href="#ProfileHistogram.remove-234"><span class="linenos">234</span></a>                          <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax_h</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
</span><span id="ProfileHistogram.remove-235"><a href="#ProfileHistogram.remove-235"><span class="linenos">235</span></a>                <span class="n">ax_h</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</span><span id="ProfileHistogram.remove-236"><a href="#ProfileHistogram.remove-236"><span class="linenos">236</span></a>
</span><span id="ProfileHistogram.remove-237"><a href="#ProfileHistogram.remove-237"><span class="linenos">237</span></a>                <span class="n">bx_h</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="ProfileHistogram.remove-238"><a href="#ProfileHistogram.remove-238"><span class="linenos">238</span></a>                <span class="n">bx_h</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
</span><span id="ProfileHistogram.remove-239"><a href="#ProfileHistogram.remove-239"><span class="linenos">239</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="ProfileHistogram.remove-240"><a href="#ProfileHistogram.remove-240"><span class="linenos">240</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="ProfileHistogram.remove-241"><a href="#ProfileHistogram.remove-241"><span class="linenos">241</span></a>
</span><span id="ProfileHistogram.remove-242"><a href="#ProfileHistogram.remove-242"><span class="linenos">242</span></a>            <span class="k">return</span> <span class="n">n_bins_under_threshold</span>
</span><span id="ProfileHistogram.remove-243"><a href="#ProfileHistogram.remove-243"><span class="linenos">243</span></a>
</span><span id="ProfileHistogram.remove-244"><a href="#ProfileHistogram.remove-244"><span class="linenos">244</span></a>        <span class="n">param</span> <span class="o">=</span> <span class="n">calcNBUT</span><span class="p">()</span>
</span><span id="ProfileHistogram.remove-245"><a href="#ProfileHistogram.remove-245"><span class="linenos">245</span></a>        <span class="n">n_row</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ProfileHistogram.remove-246"><a href="#ProfileHistogram.remove-246"><span class="linenos">246</span></a>        <span class="c1"># until I have enough bins &lt; th keep loop</span>
</span><span id="ProfileHistogram.remove-247"><a href="#ProfileHistogram.remove-247"><span class="linenos">247</span></a>        <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">line_m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">final_m</span><span class="p">:</span>  <span class="c1"># nbut &lt; (tot_bins - tot_bins / 20):</span>
</span><span id="ProfileHistogram.remove-248"><a href="#ProfileHistogram.remove-248"><span class="linenos">248</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">line_m</span>
</span><span id="ProfileHistogram.remove-249"><a href="#ProfileHistogram.remove-249"><span class="linenos">249</span></a>            <span class="n">param_old</span> <span class="o">=</span> <span class="n">param</span>
</span><span id="ProfileHistogram.remove-250"><a href="#ProfileHistogram.remove-250"><span class="linenos">250</span></a>            <span class="n">param</span> <span class="o">=</span> <span class="n">calcNBUT</span><span class="p">()</span>
</span><span id="ProfileHistogram.remove-251"><a href="#ProfileHistogram.remove-251"><span class="linenos">251</span></a>
</span><span id="ProfileHistogram.remove-252"><a href="#ProfileHistogram.remove-252"><span class="linenos">252</span></a>            <span class="k">if</span> <span class="n">param</span> <span class="o">&lt;</span> <span class="n">param_old</span><span class="p">:</span>  <span class="c1"># invert rotation if we are going the wrong way</span>
</span><span id="ProfileHistogram.remove-253"><a href="#ProfileHistogram.remove-253"><span class="linenos">253</span></a>                <span class="n">line_m</span> <span class="o">=</span> <span class="o">-</span><span class="n">line_m</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="ProfileHistogram.remove-254"><a href="#ProfileHistogram.remove-254"><span class="linenos">254</span></a>
</span><span id="ProfileHistogram.remove-255"><a href="#ProfileHistogram.remove-255"><span class="linenos">255</span></a>            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="n">param_old</span><span class="p">:</span>
</span><span id="ProfileHistogram.remove-256"><a href="#ProfileHistogram.remove-256"><span class="linenos">256</span></a>                <span class="n">n_row</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ProfileHistogram.remove-257"><a href="#ProfileHistogram.remove-257"><span class="linenos">257</span></a>                <span class="k">if</span> <span class="n">n_row</span> <span class="o">&gt;=</span> <span class="mi">15</span><span class="p">:</span> <span class="k">break</span>  <span class="c1"># we got stuck for too long</span>
</span><span id="ProfileHistogram.remove-258"><a href="#ProfileHistogram.remove-258"><span class="linenos">258</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ProfileHistogram.remove-259"><a href="#ProfileHistogram.remove-259"><span class="linenos">259</span></a>                <span class="n">n_row</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ProfileHistogram.remove-260"><a href="#ProfileHistogram.remove-260"><span class="linenos">260</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Hist method -&gt; End slope </span><span class="si">{</span><span class="n">line_m</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Alligns the profile using the recursive histogram method, stops when
the tilt correction is less than the parameter final_m</p>

<h2 id="parameters">Parameters</h2>

<p>obj: profile.Profile
    The profile object on wich the form is removed
final_m: float
    The end slope correction
bplt: bool
    Plots the histogram evolution over the iterations</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Remover">Remover</a></dt>
                                <dd id="ProfileHistogram.applyRemover" class="function"><a href="#Remover.applyRemover">applyRemover</a></dd>
                <dd id="ProfileHistogram.plotForm" class="function"><a href="#Remover.plotForm">plotForm</a></dd>
                <dd id="ProfileHistogram.removeForm" class="function"><a href="#Remover.removeForm">removeForm</a></dd>
                <dd id="ProfileHistogram.plot3DForm" class="function"><a href="#Remover.plot3DForm">plot3DForm</a></dd>
                <dd id="ProfileHistogram.remove3DForm" class="function"><a href="#Remover.remove3DForm">remove3DForm</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SurfaceLSPlane">
                            <input id="SurfaceLSPlane-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SurfaceLSPlane</span><wbr>(<span class="base"><a href="#Remover">Remover</a></span>):

                <label class="view-source-button" for="SurfaceLSPlane-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SurfaceLSPlane"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SurfaceLSPlane-263"><a href="#SurfaceLSPlane-263"><span class="linenos">263</span></a><span class="k">class</span> <span class="nc">SurfaceLSPlane</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="SurfaceLSPlane-264"><a href="#SurfaceLSPlane-264"><span class="linenos">264</span></a>    <span class="c1"># shortcut class to surface poly of degree 1 (implemented for simmetry)</span>
</span><span id="SurfaceLSPlane-265"><a href="#SurfaceLSPlane-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SurfaceLSPlane-266"><a href="#SurfaceLSPlane-266"><span class="linenos">266</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span><span id="SurfaceLSPlane-267"><a href="#SurfaceLSPlane-267"><span class="linenos">267</span></a>
</span><span id="SurfaceLSPlane-268"><a href="#SurfaceLSPlane-268"><span class="linenos">268</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SurfaceLSPlane-269"><a href="#SurfaceLSPlane-269"><span class="linenos">269</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SurfaceLSPlane-270"><a href="#SurfaceLSPlane-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SurfaceLSPlane-271"><a href="#SurfaceLSPlane-271"><span class="linenos">271</span></a><span class="sd">        Least square plane fit implementation</span>
</span><span id="SurfaceLSPlane-272"><a href="#SurfaceLSPlane-272"><span class="linenos">272</span></a>
</span><span id="SurfaceLSPlane-273"><a href="#SurfaceLSPlane-273"><span class="linenos">273</span></a><span class="sd">        Parameters</span>
</span><span id="SurfaceLSPlane-274"><a href="#SurfaceLSPlane-274"><span class="linenos">274</span></a><span class="sd">        ----------</span>
</span><span id="SurfaceLSPlane-275"><a href="#SurfaceLSPlane-275"><span class="linenos">275</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="SurfaceLSPlane-276"><a href="#SurfaceLSPlane-276"><span class="linenos">276</span></a><span class="sd">            The surface object on wich the LS plane is applied</span>
</span><span id="SurfaceLSPlane-277"><a href="#SurfaceLSPlane-277"><span class="linenos">277</span></a><span class="sd">        bplt: bool</span>
</span><span id="SurfaceLSPlane-278"><a href="#SurfaceLSPlane-278"><span class="linenos">278</span></a><span class="sd">            If True plots the plane overimposed on the surface</span>
</span><span id="SurfaceLSPlane-279"><a href="#SurfaceLSPlane-279"><span class="linenos">279</span></a>
</span><span id="SurfaceLSPlane-280"><a href="#SurfaceLSPlane-280"><span class="linenos">280</span></a><span class="sd">        Returns</span>
</span><span id="SurfaceLSPlane-281"><a href="#SurfaceLSPlane-281"><span class="linenos">281</span></a><span class="sd">        ----------</span>
</span><span id="SurfaceLSPlane-282"><a href="#SurfaceLSPlane-282"><span class="linenos">282</span></a><span class="sd">        sol: np.ndarray</span>
</span><span id="SurfaceLSPlane-283"><a href="#SurfaceLSPlane-283"><span class="linenos">283</span></a><span class="sd">            Array of polynomial coefficients.</span>
</span><span id="SurfaceLSPlane-284"><a href="#SurfaceLSPlane-284"><span class="linenos">284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SurfaceLSPlane-285"><a href="#SurfaceLSPlane-285"><span class="linenos">285</span></a>
</span><span id="SurfaceLSPlane-286"><a href="#SurfaceLSPlane-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="n">SurfacePolynomial</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span></pre></div>


    

                            <div id="SurfaceLSPlane.applyRemover" class="classattr">
                                        <input id="SurfaceLSPlane.applyRemover-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">applyRemover</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">obj</span><span class="p">:</span> <span class="n"><a href="surface.html#Surface">surfile.surface.Surface</a></span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SurfaceLSPlane.applyRemover-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SurfaceLSPlane.applyRemover"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SurfaceLSPlane.applyRemover-265"><a href="#SurfaceLSPlane.applyRemover-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SurfaceLSPlane.applyRemover-266"><a href="#SurfaceLSPlane.applyRemover-266"><span class="linenos">266</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SurfaceLSPlane.remove" class="classattr">
                                        <input id="SurfaceLSPlane.remove-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">remove</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span><span class="p">:</span> <span class="n"><a href="surface.html#Surface">surfile.surface.Surface</a></span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SurfaceLSPlane.remove-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SurfaceLSPlane.remove"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SurfaceLSPlane.remove-268"><a href="#SurfaceLSPlane.remove-268"><span class="linenos">268</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SurfaceLSPlane.remove-269"><a href="#SurfaceLSPlane.remove-269"><span class="linenos">269</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SurfaceLSPlane.remove-270"><a href="#SurfaceLSPlane.remove-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SurfaceLSPlane.remove-271"><a href="#SurfaceLSPlane.remove-271"><span class="linenos">271</span></a><span class="sd">        Least square plane fit implementation</span>
</span><span id="SurfaceLSPlane.remove-272"><a href="#SurfaceLSPlane.remove-272"><span class="linenos">272</span></a>
</span><span id="SurfaceLSPlane.remove-273"><a href="#SurfaceLSPlane.remove-273"><span class="linenos">273</span></a><span class="sd">        Parameters</span>
</span><span id="SurfaceLSPlane.remove-274"><a href="#SurfaceLSPlane.remove-274"><span class="linenos">274</span></a><span class="sd">        ----------</span>
</span><span id="SurfaceLSPlane.remove-275"><a href="#SurfaceLSPlane.remove-275"><span class="linenos">275</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="SurfaceLSPlane.remove-276"><a href="#SurfaceLSPlane.remove-276"><span class="linenos">276</span></a><span class="sd">            The surface object on wich the LS plane is applied</span>
</span><span id="SurfaceLSPlane.remove-277"><a href="#SurfaceLSPlane.remove-277"><span class="linenos">277</span></a><span class="sd">        bplt: bool</span>
</span><span id="SurfaceLSPlane.remove-278"><a href="#SurfaceLSPlane.remove-278"><span class="linenos">278</span></a><span class="sd">            If True plots the plane overimposed on the surface</span>
</span><span id="SurfaceLSPlane.remove-279"><a href="#SurfaceLSPlane.remove-279"><span class="linenos">279</span></a>
</span><span id="SurfaceLSPlane.remove-280"><a href="#SurfaceLSPlane.remove-280"><span class="linenos">280</span></a><span class="sd">        Returns</span>
</span><span id="SurfaceLSPlane.remove-281"><a href="#SurfaceLSPlane.remove-281"><span class="linenos">281</span></a><span class="sd">        ----------</span>
</span><span id="SurfaceLSPlane.remove-282"><a href="#SurfaceLSPlane.remove-282"><span class="linenos">282</span></a><span class="sd">        sol: np.ndarray</span>
</span><span id="SurfaceLSPlane.remove-283"><a href="#SurfaceLSPlane.remove-283"><span class="linenos">283</span></a><span class="sd">            Array of polynomial coefficients.</span>
</span><span id="SurfaceLSPlane.remove-284"><a href="#SurfaceLSPlane.remove-284"><span class="linenos">284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SurfaceLSPlane.remove-285"><a href="#SurfaceLSPlane.remove-285"><span class="linenos">285</span></a>
</span><span id="SurfaceLSPlane.remove-286"><a href="#SurfaceLSPlane.remove-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="n">SurfacePolynomial</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="n">bplt</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Least square plane fit implementation</p>

<h2 id="parameters">Parameters</h2>

<p>obj: surface.Surface
    The surface object on wich the LS plane is applied
bplt: bool
    If True plots the plane overimposed on the surface</p>

<h2 id="returns">Returns</h2>

<p>sol: np.ndarray
    Array of polynomial coefficients.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Remover">Remover</a></dt>
                                <dd id="SurfaceLSPlane.plotForm" class="function"><a href="#Remover.plotForm">plotForm</a></dd>
                <dd id="SurfaceLSPlane.removeForm" class="function"><a href="#Remover.removeForm">removeForm</a></dd>
                <dd id="SurfaceLSPlane.plot3DForm" class="function"><a href="#Remover.plot3DForm">plot3DForm</a></dd>
                <dd id="SurfaceLSPlane.remove3DForm" class="function"><a href="#Remover.remove3DForm">remove3DForm</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SurfacePolynomial">
                            <input id="SurfacePolynomial-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SurfacePolynomial</span><wbr>(<span class="base"><a href="#Remover">Remover</a></span>):

                <label class="view-source-button" for="SurfacePolynomial-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SurfacePolynomial"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SurfacePolynomial-289"><a href="#SurfacePolynomial-289"><span class="linenos">289</span></a><span class="k">class</span> <span class="nc">SurfacePolynomial</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="SurfacePolynomial-290"><a href="#SurfacePolynomial-290"><span class="linenos">290</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SurfacePolynomial-291"><a href="#SurfacePolynomial-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kx</span> <span class="o">=</span> <span class="n">kx</span>
</span><span id="SurfacePolynomial-292"><a href="#SurfacePolynomial-292"><span class="linenos">292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ky</span> <span class="o">=</span> <span class="n">ky</span>
</span><span id="SurfacePolynomial-293"><a href="#SurfacePolynomial-293"><span class="linenos">293</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">full</span> <span class="o">=</span> <span class="n">full</span>
</span><span id="SurfacePolynomial-294"><a href="#SurfacePolynomial-294"><span class="linenos">294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span>
</span><span id="SurfacePolynomial-295"><a href="#SurfacePolynomial-295"><span class="linenos">295</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bound</span> <span class="o">=</span> <span class="n">bound</span>
</span><span id="SurfacePolynomial-296"><a href="#SurfacePolynomial-296"><span class="linenos">296</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span> <span class="o">=</span> <span class="n">cutter</span>
</span><span id="SurfacePolynomial-297"><a href="#SurfacePolynomial-297"><span class="linenos">297</span></a>
</span><span id="SurfacePolynomial-298"><a href="#SurfacePolynomial-298"><span class="linenos">298</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SurfacePolynomial-299"><a href="#SurfacePolynomial-299"><span class="linenos">299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ky</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span><span class="p">)</span>
</span><span id="SurfacePolynomial-300"><a href="#SurfacePolynomial-300"><span class="linenos">300</span></a>
</span><span id="SurfacePolynomial-301"><a href="#SurfacePolynomial-301"><span class="linenos">301</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SurfacePolynomial-302"><a href="#SurfacePolynomial-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SurfacePolynomial-303"><a href="#SurfacePolynomial-303"><span class="linenos">303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SurfacePolynomial-304"><a href="#SurfacePolynomial-304"><span class="linenos">304</span></a><span class="sd">        Least square polynomial fit implementation</span>
</span><span id="SurfacePolynomial-305"><a href="#SurfacePolynomial-305"><span class="linenos">305</span></a>
</span><span id="SurfacePolynomial-306"><a href="#SurfacePolynomial-306"><span class="linenos">306</span></a><span class="sd">        Parameters</span>
</span><span id="SurfacePolynomial-307"><a href="#SurfacePolynomial-307"><span class="linenos">307</span></a><span class="sd">        ----------</span>
</span><span id="SurfacePolynomial-308"><a href="#SurfacePolynomial-308"><span class="linenos">308</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="SurfacePolynomial-309"><a href="#SurfacePolynomial-309"><span class="linenos">309</span></a><span class="sd">            The surface object on wich the polynomial fit is applied</span>
</span><span id="SurfacePolynomial-310"><a href="#SurfacePolynomial-310"><span class="linenos">310</span></a><span class="sd">        kx, ky: int</span>
</span><span id="SurfacePolynomial-311"><a href="#SurfacePolynomial-311"><span class="linenos">311</span></a><span class="sd">            Polynomial order in x and y, respectively.</span>
</span><span id="SurfacePolynomial-312"><a href="#SurfacePolynomial-312"><span class="linenos">312</span></a><span class="sd">        full : bool, optional</span>
</span><span id="SurfacePolynomial-313"><a href="#SurfacePolynomial-313"><span class="linenos">313</span></a><span class="sd">            If True, will solve using the full polynomial matrix.  Otherwise,</span>
</span><span id="SurfacePolynomial-314"><a href="#SurfacePolynomial-314"><span class="linenos">314</span></a><span class="sd">            will use the upper-left triangle of the matrix.  See</span>
</span><span id="SurfacePolynomial-315"><a href="#SurfacePolynomial-315"><span class="linenos">315</span></a><span class="sd">            `polyinterp2d` for further details.  Note that if kx != ky, then</span>
</span><span id="SurfacePolynomial-316"><a href="#SurfacePolynomial-316"><span class="linenos">316</span></a><span class="sd">            the full matrix will be solved for. (@sofia_redux/toolkit)</span>
</span><span id="SurfacePolynomial-317"><a href="#SurfacePolynomial-317"><span class="linenos">317</span></a><span class="sd">        comp: funct / lambda, optional</span>
</span><span id="SurfacePolynomial-318"><a href="#SurfacePolynomial-318"><span class="linenos">318</span></a><span class="sd">            comparison method between bound and surface</span>
</span><span id="SurfacePolynomial-319"><a href="#SurfacePolynomial-319"><span class="linenos">319</span></a><span class="sd">        bound: float, optional</span>
</span><span id="SurfacePolynomial-320"><a href="#SurfacePolynomial-320"><span class="linenos">320</span></a><span class="sd">            if not set the fit uses all points,</span>
</span><span id="SurfacePolynomial-321"><a href="#SurfacePolynomial-321"><span class="linenos">321</span></a><span class="sd">            if set the fit uses all points below the values,</span>
</span><span id="SurfacePolynomial-322"><a href="#SurfacePolynomial-322"><span class="linenos">322</span></a><span class="sd">            if set to True the fit uses only the values below the average value of the surface</span>
</span><span id="SurfacePolynomial-323"><a href="#SurfacePolynomial-323"><span class="linenos">323</span></a><span class="sd">        cutter: cutter.Cutter</span>
</span><span id="SurfacePolynomial-324"><a href="#SurfacePolynomial-324"><span class="linenos">324</span></a><span class="sd">            -if not set, the fit uses all points</span>
</span><span id="SurfacePolynomial-325"><a href="#SurfacePolynomial-325"><span class="linenos">325</span></a><span class="sd">            -if true allows the user to select manually the region of interest</span>
</span><span id="SurfacePolynomial-326"><a href="#SurfacePolynomial-326"><span class="linenos">326</span></a><span class="sd">            -if a cutter obj is passed the fit is done only on the cutted profile points</span>
</span><span id="SurfacePolynomial-327"><a href="#SurfacePolynomial-327"><span class="linenos">327</span></a><span class="sd">             and then applied on the whole profile</span>
</span><span id="SurfacePolynomial-328"><a href="#SurfacePolynomial-328"><span class="linenos">328</span></a><span class="sd">        bplt: bool, optional</span>
</span><span id="SurfacePolynomial-329"><a href="#SurfacePolynomial-329"><span class="linenos">329</span></a><span class="sd">            If True plots the plane overimposed on the surface</span>
</span><span id="SurfacePolynomial-330"><a href="#SurfacePolynomial-330"><span class="linenos">330</span></a>
</span><span id="SurfacePolynomial-331"><a href="#SurfacePolynomial-331"><span class="linenos">331</span></a><span class="sd">        Returns</span>
</span><span id="SurfacePolynomial-332"><a href="#SurfacePolynomial-332"><span class="linenos">332</span></a><span class="sd">        ----------</span>
</span><span id="SurfacePolynomial-333"><a href="#SurfacePolynomial-333"><span class="linenos">333</span></a><span class="sd">        sol: np.ndarray</span>
</span><span id="SurfacePolynomial-334"><a href="#SurfacePolynomial-334"><span class="linenos">334</span></a><span class="sd">            Array of polynomial coefficients.</span>
</span><span id="SurfacePolynomial-335"><a href="#SurfacePolynomial-335"><span class="linenos">335</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SurfacePolynomial-336"><a href="#SurfacePolynomial-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="SurfacePolynomial-337"><a href="#SurfacePolynomial-337"><span class="linenos">337</span></a>            <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">cutr</span><span class="o">.</span><span class="n">SurfaceCutter</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SurfacePolynomial-338"><a href="#SurfacePolynomial-338"><span class="linenos">338</span></a>        <span class="k">elif</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SurfacePolynomial-339"><a href="#SurfacePolynomial-339"><span class="linenos">339</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">cutter</span><span class="o">.</span><span class="n">applyCut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SurfacePolynomial-340"><a href="#SurfacePolynomial-340"><span class="linenos">340</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SurfacePolynomial-341"><a href="#SurfacePolynomial-341"><span class="linenos">341</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span>
</span><span id="SurfacePolynomial-342"><a href="#SurfacePolynomial-342"><span class="linenos">342</span></a>
</span><span id="SurfacePolynomial-343"><a href="#SurfacePolynomial-343"><span class="linenos">343</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>  <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">z</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="SurfacePolynomial-344"><a href="#SurfacePolynomial-344"><span class="linenos">344</span></a>
</span><span id="SurfacePolynomial-345"><a href="#SurfacePolynomial-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="n">bound</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="SurfacePolynomial-346"><a href="#SurfacePolynomial-346"><span class="linenos">346</span></a>            <span class="n">bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>  <span class="c1"># set the bound to the mean point</span>
</span><span id="SurfacePolynomial-347"><a href="#SurfacePolynomial-347"><span class="linenos">347</span></a>
</span><span id="SurfacePolynomial-348"><a href="#SurfacePolynomial-348"><span class="linenos">348</span></a>        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">kx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ky</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SurfacePolynomial-349"><a href="#SurfacePolynomial-349"><span class="linenos">349</span></a>        <span class="n">full</span> <span class="o">|=</span> <span class="n">kx</span> <span class="o">!=</span> <span class="n">ky</span>  <span class="c1"># if they are different -&gt; full matrix</span>
</span><span id="SurfacePolynomial-350"><a href="#SurfacePolynomial-350"><span class="linenos">350</span></a>        <span class="n">loop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">)))</span>
</span><span id="SurfacePolynomial-351"><a href="#SurfacePolynomial-351"><span class="linenos">351</span></a>
</span><span id="SurfacePolynomial-352"><a href="#SurfacePolynomial-352"><span class="linenos">352</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">full</span><span class="p">:</span>  <span class="c1"># calculate only upper left part of matrix</span>
</span><span id="SurfacePolynomial-353"><a href="#SurfacePolynomial-353"><span class="linenos">353</span></a>            <span class="n">loop2</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SurfacePolynomial-354"><a href="#SurfacePolynomial-354"><span class="linenos">354</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">:</span>
</span><span id="SurfacePolynomial-355"><a href="#SurfacePolynomial-355"><span class="linenos">355</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">ky</span> <span class="o">-</span> <span class="n">j</span><span class="p">):</span>
</span><span id="SurfacePolynomial-356"><a href="#SurfacePolynomial-356"><span class="linenos">356</span></a>                    <span class="n">loop2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="SurfacePolynomial-357"><a href="#SurfacePolynomial-357"><span class="linenos">357</span></a>            <span class="n">loop</span> <span class="o">=</span> <span class="n">loop2</span>
</span><span id="SurfacePolynomial-358"><a href="#SurfacePolynomial-358"><span class="linenos">358</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">)))</span>
</span><span id="SurfacePolynomial-359"><a href="#SurfacePolynomial-359"><span class="linenos">359</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loop</span><span class="p">):</span>
</span><span id="SurfacePolynomial-360"><a href="#SurfacePolynomial-360"><span class="linenos">360</span></a>            <span class="n">a</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="n">j</span><span class="p">)</span>
</span><span id="SurfacePolynomial-361"><a href="#SurfacePolynomial-361"><span class="linenos">361</span></a>
</span><span id="SurfacePolynomial-362"><a href="#SurfacePolynomial-362"><span class="linenos">362</span></a>        <span class="c1"># remove nan values</span>
</span><span id="SurfacePolynomial-363"><a href="#SurfacePolynomial-363"><span class="linenos">363</span></a>        <span class="n">indexes</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="SurfacePolynomial-364"><a href="#SurfacePolynomial-364"><span class="linenos">364</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span>
</span><span id="SurfacePolynomial-365"><a href="#SurfacePolynomial-365"><span class="linenos">365</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span>
</span><span id="SurfacePolynomial-366"><a href="#SurfacePolynomial-366"><span class="linenos">366</span></a>
</span><span id="SurfacePolynomial-367"><a href="#SurfacePolynomial-367"><span class="linenos">367</span></a>        <span class="k">if</span> <span class="n">bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># remove z limited values in comp direction</span>
</span><span id="SurfacePolynomial-368"><a href="#SurfacePolynomial-368"><span class="linenos">368</span></a>            <span class="n">keep</span> <span class="o">=</span> <span class="n">comp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">bound</span><span class="p">)</span>
</span><span id="SurfacePolynomial-369"><a href="#SurfacePolynomial-369"><span class="linenos">369</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
</span><span id="SurfacePolynomial-370"><a href="#SurfacePolynomial-370"><span class="linenos">370</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
</span><span id="SurfacePolynomial-371"><a href="#SurfacePolynomial-371"><span class="linenos">371</span></a>
</span><span id="SurfacePolynomial-372"><a href="#SurfacePolynomial-372"><span class="linenos">372</span></a>        <span class="n">sol</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="SurfacePolynomial-373"><a href="#SurfacePolynomial-373"><span class="linenos">373</span></a>
</span><span id="SurfacePolynomial-374"><a href="#SurfacePolynomial-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
</span><span id="SurfacePolynomial-375"><a href="#SurfacePolynomial-375"><span class="linenos">375</span></a>            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
</span><span id="SurfacePolynomial-376"><a href="#SurfacePolynomial-376"><span class="linenos">376</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SurfacePolynomial-377"><a href="#SurfacePolynomial-377"><span class="linenos">377</span></a>            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
</span><span id="SurfacePolynomial-378"><a href="#SurfacePolynomial-378"><span class="linenos">378</span></a>            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
</span><span id="SurfacePolynomial-379"><a href="#SurfacePolynomial-379"><span class="linenos">379</span></a>                <span class="n">coeffs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
</span><span id="SurfacePolynomial-380"><a href="#SurfacePolynomial-380"><span class="linenos">380</span></a>
</span><span id="SurfacePolynomial-381"><a href="#SurfacePolynomial-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="SurfacePolynomial-382"><a href="#SurfacePolynomial-382"><span class="linenos">382</span></a>            <span class="n">Remover</span><span class="o">.</span><span class="n">plot3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span>
</span><span id="SurfacePolynomial-383"><a href="#SurfacePolynomial-383"><span class="linenos">383</span></a>
</span><span id="SurfacePolynomial-384"><a href="#SurfacePolynomial-384"><span class="linenos">384</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">remove3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span>
</span><span id="SurfacePolynomial-385"><a href="#SurfacePolynomial-385"><span class="linenos">385</span></a>        <span class="k">return</span> <span class="n">sol</span>
</span></pre></div>


    

                            <div id="SurfacePolynomial.__init__" class="classattr">
                                        <input id="SurfacePolynomial.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SurfacePolynomial</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">kx</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">ky</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">full</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">comp</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">SurfacePolynomial</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;&gt;</span>,</span><span class="param">	<span class="n">bound</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">cutter</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="SurfacePolynomial.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SurfacePolynomial.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SurfacePolynomial.__init__-290"><a href="#SurfacePolynomial.__init__-290"><span class="linenos">290</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SurfacePolynomial.__init__-291"><a href="#SurfacePolynomial.__init__-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kx</span> <span class="o">=</span> <span class="n">kx</span>
</span><span id="SurfacePolynomial.__init__-292"><a href="#SurfacePolynomial.__init__-292"><span class="linenos">292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ky</span> <span class="o">=</span> <span class="n">ky</span>
</span><span id="SurfacePolynomial.__init__-293"><a href="#SurfacePolynomial.__init__-293"><span class="linenos">293</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">full</span> <span class="o">=</span> <span class="n">full</span>
</span><span id="SurfacePolynomial.__init__-294"><a href="#SurfacePolynomial.__init__-294"><span class="linenos">294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span>
</span><span id="SurfacePolynomial.__init__-295"><a href="#SurfacePolynomial.__init__-295"><span class="linenos">295</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bound</span> <span class="o">=</span> <span class="n">bound</span>
</span><span id="SurfacePolynomial.__init__-296"><a href="#SurfacePolynomial.__init__-296"><span class="linenos">296</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span> <span class="o">=</span> <span class="n">cutter</span>
</span></pre></div>


    

                            </div>
                            <div id="SurfacePolynomial.applyRemover" class="classattr">
                                        <input id="SurfacePolynomial.applyRemover-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">applyRemover</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">obj</span><span class="p">:</span> <span class="n"><a href="surface.html#Surface">surfile.surface.Surface</a></span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SurfacePolynomial.applyRemover-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SurfacePolynomial.applyRemover"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SurfacePolynomial.applyRemover-298"><a href="#SurfacePolynomial.applyRemover-298"><span class="linenos">298</span></a>    <span class="k">def</span> <span class="nf">applyRemover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SurfacePolynomial.applyRemover-299"><a href="#SurfacePolynomial.applyRemover-299"><span class="linenos">299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ky</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutter</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SurfacePolynomial.remove" class="classattr">
                                        <input id="SurfacePolynomial.remove-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">remove</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obj</span><span class="p">:</span> <span class="n"><a href="surface.html#Surface">surfile.surface.Surface</a></span>,</span><span class="param">	<span class="n">kx</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">ky</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">full</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">comp</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">SurfacePolynomial</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;&gt;</span>,</span><span class="param">	<span class="n">bound</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">cutter</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SurfacePolynomial.remove-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SurfacePolynomial.remove"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SurfacePolynomial.remove-301"><a href="#SurfacePolynomial.remove-301"><span class="linenos">301</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SurfacePolynomial.remove-302"><a href="#SurfacePolynomial.remove-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ky</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SurfacePolynomial.remove-303"><a href="#SurfacePolynomial.remove-303"><span class="linenos">303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SurfacePolynomial.remove-304"><a href="#SurfacePolynomial.remove-304"><span class="linenos">304</span></a><span class="sd">        Least square polynomial fit implementation</span>
</span><span id="SurfacePolynomial.remove-305"><a href="#SurfacePolynomial.remove-305"><span class="linenos">305</span></a>
</span><span id="SurfacePolynomial.remove-306"><a href="#SurfacePolynomial.remove-306"><span class="linenos">306</span></a><span class="sd">        Parameters</span>
</span><span id="SurfacePolynomial.remove-307"><a href="#SurfacePolynomial.remove-307"><span class="linenos">307</span></a><span class="sd">        ----------</span>
</span><span id="SurfacePolynomial.remove-308"><a href="#SurfacePolynomial.remove-308"><span class="linenos">308</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="SurfacePolynomial.remove-309"><a href="#SurfacePolynomial.remove-309"><span class="linenos">309</span></a><span class="sd">            The surface object on wich the polynomial fit is applied</span>
</span><span id="SurfacePolynomial.remove-310"><a href="#SurfacePolynomial.remove-310"><span class="linenos">310</span></a><span class="sd">        kx, ky: int</span>
</span><span id="SurfacePolynomial.remove-311"><a href="#SurfacePolynomial.remove-311"><span class="linenos">311</span></a><span class="sd">            Polynomial order in x and y, respectively.</span>
</span><span id="SurfacePolynomial.remove-312"><a href="#SurfacePolynomial.remove-312"><span class="linenos">312</span></a><span class="sd">        full : bool, optional</span>
</span><span id="SurfacePolynomial.remove-313"><a href="#SurfacePolynomial.remove-313"><span class="linenos">313</span></a><span class="sd">            If True, will solve using the full polynomial matrix.  Otherwise,</span>
</span><span id="SurfacePolynomial.remove-314"><a href="#SurfacePolynomial.remove-314"><span class="linenos">314</span></a><span class="sd">            will use the upper-left triangle of the matrix.  See</span>
</span><span id="SurfacePolynomial.remove-315"><a href="#SurfacePolynomial.remove-315"><span class="linenos">315</span></a><span class="sd">            `polyinterp2d` for further details.  Note that if kx != ky, then</span>
</span><span id="SurfacePolynomial.remove-316"><a href="#SurfacePolynomial.remove-316"><span class="linenos">316</span></a><span class="sd">            the full matrix will be solved for. (@sofia_redux/toolkit)</span>
</span><span id="SurfacePolynomial.remove-317"><a href="#SurfacePolynomial.remove-317"><span class="linenos">317</span></a><span class="sd">        comp: funct / lambda, optional</span>
</span><span id="SurfacePolynomial.remove-318"><a href="#SurfacePolynomial.remove-318"><span class="linenos">318</span></a><span class="sd">            comparison method between bound and surface</span>
</span><span id="SurfacePolynomial.remove-319"><a href="#SurfacePolynomial.remove-319"><span class="linenos">319</span></a><span class="sd">        bound: float, optional</span>
</span><span id="SurfacePolynomial.remove-320"><a href="#SurfacePolynomial.remove-320"><span class="linenos">320</span></a><span class="sd">            if not set the fit uses all points,</span>
</span><span id="SurfacePolynomial.remove-321"><a href="#SurfacePolynomial.remove-321"><span class="linenos">321</span></a><span class="sd">            if set the fit uses all points below the values,</span>
</span><span id="SurfacePolynomial.remove-322"><a href="#SurfacePolynomial.remove-322"><span class="linenos">322</span></a><span class="sd">            if set to True the fit uses only the values below the average value of the surface</span>
</span><span id="SurfacePolynomial.remove-323"><a href="#SurfacePolynomial.remove-323"><span class="linenos">323</span></a><span class="sd">        cutter: cutter.Cutter</span>
</span><span id="SurfacePolynomial.remove-324"><a href="#SurfacePolynomial.remove-324"><span class="linenos">324</span></a><span class="sd">            -if not set, the fit uses all points</span>
</span><span id="SurfacePolynomial.remove-325"><a href="#SurfacePolynomial.remove-325"><span class="linenos">325</span></a><span class="sd">            -if true allows the user to select manually the region of interest</span>
</span><span id="SurfacePolynomial.remove-326"><a href="#SurfacePolynomial.remove-326"><span class="linenos">326</span></a><span class="sd">            -if a cutter obj is passed the fit is done only on the cutted profile points</span>
</span><span id="SurfacePolynomial.remove-327"><a href="#SurfacePolynomial.remove-327"><span class="linenos">327</span></a><span class="sd">             and then applied on the whole profile</span>
</span><span id="SurfacePolynomial.remove-328"><a href="#SurfacePolynomial.remove-328"><span class="linenos">328</span></a><span class="sd">        bplt: bool, optional</span>
</span><span id="SurfacePolynomial.remove-329"><a href="#SurfacePolynomial.remove-329"><span class="linenos">329</span></a><span class="sd">            If True plots the plane overimposed on the surface</span>
</span><span id="SurfacePolynomial.remove-330"><a href="#SurfacePolynomial.remove-330"><span class="linenos">330</span></a>
</span><span id="SurfacePolynomial.remove-331"><a href="#SurfacePolynomial.remove-331"><span class="linenos">331</span></a><span class="sd">        Returns</span>
</span><span id="SurfacePolynomial.remove-332"><a href="#SurfacePolynomial.remove-332"><span class="linenos">332</span></a><span class="sd">        ----------</span>
</span><span id="SurfacePolynomial.remove-333"><a href="#SurfacePolynomial.remove-333"><span class="linenos">333</span></a><span class="sd">        sol: np.ndarray</span>
</span><span id="SurfacePolynomial.remove-334"><a href="#SurfacePolynomial.remove-334"><span class="linenos">334</span></a><span class="sd">            Array of polynomial coefficients.</span>
</span><span id="SurfacePolynomial.remove-335"><a href="#SurfacePolynomial.remove-335"><span class="linenos">335</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SurfacePolynomial.remove-336"><a href="#SurfacePolynomial.remove-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="SurfacePolynomial.remove-337"><a href="#SurfacePolynomial.remove-337"><span class="linenos">337</span></a>            <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">cutr</span><span class="o">.</span><span class="n">SurfaceCutter</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SurfacePolynomial.remove-338"><a href="#SurfacePolynomial.remove-338"><span class="linenos">338</span></a>        <span class="k">elif</span> <span class="n">cutter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SurfacePolynomial.remove-339"><a href="#SurfacePolynomial.remove-339"><span class="linenos">339</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">cutter</span><span class="o">.</span><span class="n">applyCut</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SurfacePolynomial.remove-340"><a href="#SurfacePolynomial.remove-340"><span class="linenos">340</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SurfacePolynomial.remove-341"><a href="#SurfacePolynomial.remove-341"><span class="linenos">341</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span>
</span><span id="SurfacePolynomial.remove-342"><a href="#SurfacePolynomial.remove-342"><span class="linenos">342</span></a>
</span><span id="SurfacePolynomial.remove-343"><a href="#SurfacePolynomial.remove-343"><span class="linenos">343</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>  <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">z</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="SurfacePolynomial.remove-344"><a href="#SurfacePolynomial.remove-344"><span class="linenos">344</span></a>
</span><span id="SurfacePolynomial.remove-345"><a href="#SurfacePolynomial.remove-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="n">bound</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="SurfacePolynomial.remove-346"><a href="#SurfacePolynomial.remove-346"><span class="linenos">346</span></a>            <span class="n">bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>  <span class="c1"># set the bound to the mean point</span>
</span><span id="SurfacePolynomial.remove-347"><a href="#SurfacePolynomial.remove-347"><span class="linenos">347</span></a>
</span><span id="SurfacePolynomial.remove-348"><a href="#SurfacePolynomial.remove-348"><span class="linenos">348</span></a>        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">kx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ky</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SurfacePolynomial.remove-349"><a href="#SurfacePolynomial.remove-349"><span class="linenos">349</span></a>        <span class="n">full</span> <span class="o">|=</span> <span class="n">kx</span> <span class="o">!=</span> <span class="n">ky</span>  <span class="c1"># if they are different -&gt; full matrix</span>
</span><span id="SurfacePolynomial.remove-350"><a href="#SurfacePolynomial.remove-350"><span class="linenos">350</span></a>        <span class="n">loop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">)))</span>
</span><span id="SurfacePolynomial.remove-351"><a href="#SurfacePolynomial.remove-351"><span class="linenos">351</span></a>
</span><span id="SurfacePolynomial.remove-352"><a href="#SurfacePolynomial.remove-352"><span class="linenos">352</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">full</span><span class="p">:</span>  <span class="c1"># calculate only upper left part of matrix</span>
</span><span id="SurfacePolynomial.remove-353"><a href="#SurfacePolynomial.remove-353"><span class="linenos">353</span></a>            <span class="n">loop2</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SurfacePolynomial.remove-354"><a href="#SurfacePolynomial.remove-354"><span class="linenos">354</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">:</span>
</span><span id="SurfacePolynomial.remove-355"><a href="#SurfacePolynomial.remove-355"><span class="linenos">355</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">ky</span> <span class="o">-</span> <span class="n">j</span><span class="p">):</span>
</span><span id="SurfacePolynomial.remove-356"><a href="#SurfacePolynomial.remove-356"><span class="linenos">356</span></a>                    <span class="n">loop2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="SurfacePolynomial.remove-357"><a href="#SurfacePolynomial.remove-357"><span class="linenos">357</span></a>            <span class="n">loop</span> <span class="o">=</span> <span class="n">loop2</span>
</span><span id="SurfacePolynomial.remove-358"><a href="#SurfacePolynomial.remove-358"><span class="linenos">358</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">)))</span>
</span><span id="SurfacePolynomial.remove-359"><a href="#SurfacePolynomial.remove-359"><span class="linenos">359</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loop</span><span class="p">):</span>
</span><span id="SurfacePolynomial.remove-360"><a href="#SurfacePolynomial.remove-360"><span class="linenos">360</span></a>            <span class="n">a</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="n">j</span><span class="p">)</span>
</span><span id="SurfacePolynomial.remove-361"><a href="#SurfacePolynomial.remove-361"><span class="linenos">361</span></a>
</span><span id="SurfacePolynomial.remove-362"><a href="#SurfacePolynomial.remove-362"><span class="linenos">362</span></a>        <span class="c1"># remove nan values</span>
</span><span id="SurfacePolynomial.remove-363"><a href="#SurfacePolynomial.remove-363"><span class="linenos">363</span></a>        <span class="n">indexes</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="SurfacePolynomial.remove-364"><a href="#SurfacePolynomial.remove-364"><span class="linenos">364</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span>
</span><span id="SurfacePolynomial.remove-365"><a href="#SurfacePolynomial.remove-365"><span class="linenos">365</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span>
</span><span id="SurfacePolynomial.remove-366"><a href="#SurfacePolynomial.remove-366"><span class="linenos">366</span></a>
</span><span id="SurfacePolynomial.remove-367"><a href="#SurfacePolynomial.remove-367"><span class="linenos">367</span></a>        <span class="k">if</span> <span class="n">bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># remove z limited values in comp direction</span>
</span><span id="SurfacePolynomial.remove-368"><a href="#SurfacePolynomial.remove-368"><span class="linenos">368</span></a>            <span class="n">keep</span> <span class="o">=</span> <span class="n">comp</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">bound</span><span class="p">)</span>
</span><span id="SurfacePolynomial.remove-369"><a href="#SurfacePolynomial.remove-369"><span class="linenos">369</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
</span><span id="SurfacePolynomial.remove-370"><a href="#SurfacePolynomial.remove-370"><span class="linenos">370</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
</span><span id="SurfacePolynomial.remove-371"><a href="#SurfacePolynomial.remove-371"><span class="linenos">371</span></a>
</span><span id="SurfacePolynomial.remove-372"><a href="#SurfacePolynomial.remove-372"><span class="linenos">372</span></a>        <span class="n">sol</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="SurfacePolynomial.remove-373"><a href="#SurfacePolynomial.remove-373"><span class="linenos">373</span></a>
</span><span id="SurfacePolynomial.remove-374"><a href="#SurfacePolynomial.remove-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
</span><span id="SurfacePolynomial.remove-375"><a href="#SurfacePolynomial.remove-375"><span class="linenos">375</span></a>            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
</span><span id="SurfacePolynomial.remove-376"><a href="#SurfacePolynomial.remove-376"><span class="linenos">376</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SurfacePolynomial.remove-377"><a href="#SurfacePolynomial.remove-377"><span class="linenos">377</span></a>            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
</span><span id="SurfacePolynomial.remove-378"><a href="#SurfacePolynomial.remove-378"><span class="linenos">378</span></a>            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
</span><span id="SurfacePolynomial.remove-379"><a href="#SurfacePolynomial.remove-379"><span class="linenos">379</span></a>                <span class="n">coeffs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
</span><span id="SurfacePolynomial.remove-380"><a href="#SurfacePolynomial.remove-380"><span class="linenos">380</span></a>
</span><span id="SurfacePolynomial.remove-381"><a href="#SurfacePolynomial.remove-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="SurfacePolynomial.remove-382"><a href="#SurfacePolynomial.remove-382"><span class="linenos">382</span></a>            <span class="n">Remover</span><span class="o">.</span><span class="n">plot3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span>
</span><span id="SurfacePolynomial.remove-383"><a href="#SurfacePolynomial.remove-383"><span class="linenos">383</span></a>
</span><span id="SurfacePolynomial.remove-384"><a href="#SurfacePolynomial.remove-384"><span class="linenos">384</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">remove3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span>
</span><span id="SurfacePolynomial.remove-385"><a href="#SurfacePolynomial.remove-385"><span class="linenos">385</span></a>        <span class="k">return</span> <span class="n">sol</span>
</span></pre></div>


            <div class="docstring"><p>Least square polynomial fit implementation</p>

<h2 id="parameters">Parameters</h2>

<p>obj: surface.Surface
    The surface object on wich the polynomial fit is applied
kx, ky: int
    Polynomial order in x and y, respectively.
full : bool, optional
    If True, will solve using the full polynomial matrix.  Otherwise,
    will use the upper-left triangle of the matrix.  See
    <code>polyinterp2d</code> for further details.  Note that if kx != ky, then
    the full matrix will be solved for. (@sofia_redux/toolkit)
comp: funct / lambda, optional
    comparison method between bound and surface
bound: float, optional
    if not set the fit uses all points,
    if set the fit uses all points below the values,
    if set to True the fit uses only the values below the average value of the surface
cutter: cutter.Cutter
    -if not set, the fit uses all points
    -if true allows the user to select manually the region of interest
    -if a cutter obj is passed the fit is done only on the cutted profile points
     and then applied on the whole profile
bplt: bool, optional
    If True plots the plane overimposed on the surface</p>

<h2 id="returns">Returns</h2>

<p>sol: np.ndarray
    Array of polynomial coefficients.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Remover">Remover</a></dt>
                                <dd id="SurfacePolynomial.plotForm" class="function"><a href="#Remover.plotForm">plotForm</a></dd>
                <dd id="SurfacePolynomial.removeForm" class="function"><a href="#Remover.removeForm">removeForm</a></dd>
                <dd id="SurfacePolynomial.plot3DForm" class="function"><a href="#Remover.plot3DForm">plot3DForm</a></dd>
                <dd id="SurfacePolynomial.remove3DForm" class="function"><a href="#Remover.remove3DForm">remove3DForm</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Surface3Points">
                            <input id="Surface3Points-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Surface3Points</span><wbr>(<span class="base"><a href="#Remover">Remover</a></span>):

                <label class="view-source-button" for="Surface3Points-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Surface3Points"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Surface3Points-388"><a href="#Surface3Points-388"><span class="linenos">388</span></a><span class="k">class</span> <span class="nc">Surface3Points</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="Surface3Points-389"><a href="#Surface3Points-389"><span class="linenos">389</span></a>    <span class="c1"># TODO : add radius of points to pick with a single click</span>
</span><span id="Surface3Points-390"><a href="#Surface3Points-390"><span class="linenos">390</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Surface3Points-391"><a href="#Surface3Points-391"><span class="linenos">391</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Surface3Points-392"><a href="#Surface3Points-392"><span class="linenos">392</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Surface3Points-393"><a href="#Surface3Points-393"><span class="linenos">393</span></a><span class="sd">        3 points plane fit implementation</span>
</span><span id="Surface3Points-394"><a href="#Surface3Points-394"><span class="linenos">394</span></a><span class="sd">        Opens a plot figure to choose the 3 points and fids the plane for those points</span>
</span><span id="Surface3Points-395"><a href="#Surface3Points-395"><span class="linenos">395</span></a>
</span><span id="Surface3Points-396"><a href="#Surface3Points-396"><span class="linenos">396</span></a><span class="sd">        Parameters</span>
</span><span id="Surface3Points-397"><a href="#Surface3Points-397"><span class="linenos">397</span></a><span class="sd">        ----------</span>
</span><span id="Surface3Points-398"><a href="#Surface3Points-398"><span class="linenos">398</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="Surface3Points-399"><a href="#Surface3Points-399"><span class="linenos">399</span></a><span class="sd">            The surface object on wich the polynomial fit is applied</span>
</span><span id="Surface3Points-400"><a href="#Surface3Points-400"><span class="linenos">400</span></a><span class="sd">        bplt: bool</span>
</span><span id="Surface3Points-401"><a href="#Surface3Points-401"><span class="linenos">401</span></a><span class="sd">            If True plots the plane overimposed on the surface</span>
</span><span id="Surface3Points-402"><a href="#Surface3Points-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Surface3Points-403"><a href="#Surface3Points-403"><span class="linenos">403</span></a>        <span class="k">def</span> <span class="nf">onClose</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>  <span class="c1"># when fig is closed calculate plane parameters</span>
</span><span id="Surface3Points-404"><a href="#Surface3Points-404"><span class="linenos">404</span></a>            <span class="n">po</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Surface3Points-405"><a href="#Surface3Points-405"><span class="linenos">405</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">selector</span><span class="o">.</span><span class="n">verts</span><span class="p">:</span>
</span><span id="Surface3Points-406"><a href="#Surface3Points-406"><span class="linenos">406</span></a>                <span class="n">xind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Surface3Points-407"><a href="#Surface3Points-407"><span class="linenos">407</span></a>                <span class="n">yind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Surface3Points-408"><a href="#Surface3Points-408"><span class="linenos">408</span></a>
</span><span id="Surface3Points-409"><a href="#Surface3Points-409"><span class="linenos">409</span></a>                <span class="n">po</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">yind</span><span class="p">,</span> <span class="n">xind</span><span class="p">]])</span>
</span><span id="Surface3Points-410"><a href="#Surface3Points-410"><span class="linenos">410</span></a>
</span><span id="Surface3Points-411"><a href="#Surface3Points-411"><span class="linenos">411</span></a>            <span class="c1"># print(f&quot;Collected points: {po}&quot;)</span>
</span><span id="Surface3Points-412"><a href="#Surface3Points-412"><span class="linenos">412</span></a>            <span class="n">a1</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># x2 - x1;</span>
</span><span id="Surface3Points-413"><a href="#Surface3Points-413"><span class="linenos">413</span></a>            <span class="n">b1</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># y2 - y1;</span>
</span><span id="Surface3Points-414"><a href="#Surface3Points-414"><span class="linenos">414</span></a>            <span class="n">c1</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># z2 - z1;</span>
</span><span id="Surface3Points-415"><a href="#Surface3Points-415"><span class="linenos">415</span></a>            <span class="n">a2</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># x3 - x1;</span>
</span><span id="Surface3Points-416"><a href="#Surface3Points-416"><span class="linenos">416</span></a>            <span class="n">b2</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># y3 - y1;</span>
</span><span id="Surface3Points-417"><a href="#Surface3Points-417"><span class="linenos">417</span></a>            <span class="n">c2</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># z3 - z1;</span>
</span><span id="Surface3Points-418"><a href="#Surface3Points-418"><span class="linenos">418</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">-</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">c1</span>
</span><span id="Surface3Points-419"><a href="#Surface3Points-419"><span class="linenos">419</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">c2</span>
</span><span id="Surface3Points-420"><a href="#Surface3Points-420"><span class="linenos">420</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">a2</span>
</span><span id="Surface3Points-421"><a href="#Surface3Points-421"><span class="linenos">421</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># (- self.a * po[0][0] - self.b * po[0][1] - self.c * po[0][2])</span>
</span><span id="Surface3Points-422"><a href="#Surface3Points-422"><span class="linenos">422</span></a>
</span><span id="Surface3Points-423"><a href="#Surface3Points-423"><span class="linenos">423</span></a>            <span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">d</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Surface3Points-424"><a href="#Surface3Points-424"><span class="linenos">424</span></a>
</span><span id="Surface3Points-425"><a href="#Surface3Points-425"><span class="linenos">425</span></a>            <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Surface3Points-426"><a href="#Surface3Points-426"><span class="linenos">426</span></a>                <span class="n">Remover</span><span class="o">.</span><span class="n">plot3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
</span><span id="Surface3Points-427"><a href="#Surface3Points-427"><span class="linenos">427</span></a>
</span><span id="Surface3Points-428"><a href="#Surface3Points-428"><span class="linenos">428</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">remove3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
</span><span id="Surface3Points-429"><a href="#Surface3Points-429"><span class="linenos">429</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="Surface3Points-430"><a href="#Surface3Points-430"><span class="linenos">430</span></a>
</span><span id="Surface3Points-431"><a href="#Surface3Points-431"><span class="linenos">431</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="Surface3Points-432"><a href="#Surface3Points-432"><span class="linenos">432</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">)</span>
</span><span id="Surface3Points-433"><a href="#Surface3Points-433"><span class="linenos">433</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;3 Points plane fit&#39;</span><span class="p">)</span>
</span><span id="Surface3Points-434"><a href="#Surface3Points-434"><span class="linenos">434</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;close_event&#39;</span><span class="p">,</span> <span class="n">onClose</span><span class="p">)</span>
</span><span id="Surface3Points-435"><a href="#Surface3Points-435"><span class="linenos">435</span></a>
</span><span id="Surface3Points-436"><a href="#Surface3Points-436"><span class="linenos">436</span></a>        <span class="n">selector</span> <span class="o">=</span> <span class="n">PolygonSelector</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Surface3Points-437"><a href="#Surface3Points-437"><span class="linenos">437</span></a>
</span><span id="Surface3Points-438"><a href="#Surface3Points-438"><span class="linenos">438</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


    

                            <div id="Surface3Points.remove" class="classattr">
                                        <input id="Surface3Points.remove-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">remove</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span><span class="p">:</span> <span class="n"><a href="surface.html#Surface">surfile.surface.Surface</a></span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Surface3Points.remove-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Surface3Points.remove"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Surface3Points.remove-390"><a href="#Surface3Points.remove-390"><span class="linenos">390</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Surface3Points.remove-391"><a href="#Surface3Points.remove-391"><span class="linenos">391</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Surface3Points.remove-392"><a href="#Surface3Points.remove-392"><span class="linenos">392</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Surface3Points.remove-393"><a href="#Surface3Points.remove-393"><span class="linenos">393</span></a><span class="sd">        3 points plane fit implementation</span>
</span><span id="Surface3Points.remove-394"><a href="#Surface3Points.remove-394"><span class="linenos">394</span></a><span class="sd">        Opens a plot figure to choose the 3 points and fids the plane for those points</span>
</span><span id="Surface3Points.remove-395"><a href="#Surface3Points.remove-395"><span class="linenos">395</span></a>
</span><span id="Surface3Points.remove-396"><a href="#Surface3Points.remove-396"><span class="linenos">396</span></a><span class="sd">        Parameters</span>
</span><span id="Surface3Points.remove-397"><a href="#Surface3Points.remove-397"><span class="linenos">397</span></a><span class="sd">        ----------</span>
</span><span id="Surface3Points.remove-398"><a href="#Surface3Points.remove-398"><span class="linenos">398</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="Surface3Points.remove-399"><a href="#Surface3Points.remove-399"><span class="linenos">399</span></a><span class="sd">            The surface object on wich the polynomial fit is applied</span>
</span><span id="Surface3Points.remove-400"><a href="#Surface3Points.remove-400"><span class="linenos">400</span></a><span class="sd">        bplt: bool</span>
</span><span id="Surface3Points.remove-401"><a href="#Surface3Points.remove-401"><span class="linenos">401</span></a><span class="sd">            If True plots the plane overimposed on the surface</span>
</span><span id="Surface3Points.remove-402"><a href="#Surface3Points.remove-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Surface3Points.remove-403"><a href="#Surface3Points.remove-403"><span class="linenos">403</span></a>        <span class="k">def</span> <span class="nf">onClose</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>  <span class="c1"># when fig is closed calculate plane parameters</span>
</span><span id="Surface3Points.remove-404"><a href="#Surface3Points.remove-404"><span class="linenos">404</span></a>            <span class="n">po</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Surface3Points.remove-405"><a href="#Surface3Points.remove-405"><span class="linenos">405</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="n">selector</span><span class="o">.</span><span class="n">verts</span><span class="p">:</span>
</span><span id="Surface3Points.remove-406"><a href="#Surface3Points.remove-406"><span class="linenos">406</span></a>                <span class="n">xind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Surface3Points.remove-407"><a href="#Surface3Points.remove-407"><span class="linenos">407</span></a>                <span class="n">yind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Surface3Points.remove-408"><a href="#Surface3Points.remove-408"><span class="linenos">408</span></a>
</span><span id="Surface3Points.remove-409"><a href="#Surface3Points.remove-409"><span class="linenos">409</span></a>                <span class="n">po</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">yind</span><span class="p">,</span> <span class="n">xind</span><span class="p">]])</span>
</span><span id="Surface3Points.remove-410"><a href="#Surface3Points.remove-410"><span class="linenos">410</span></a>
</span><span id="Surface3Points.remove-411"><a href="#Surface3Points.remove-411"><span class="linenos">411</span></a>            <span class="c1"># print(f&quot;Collected points: {po}&quot;)</span>
</span><span id="Surface3Points.remove-412"><a href="#Surface3Points.remove-412"><span class="linenos">412</span></a>            <span class="n">a1</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># x2 - x1;</span>
</span><span id="Surface3Points.remove-413"><a href="#Surface3Points.remove-413"><span class="linenos">413</span></a>            <span class="n">b1</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># y2 - y1;</span>
</span><span id="Surface3Points.remove-414"><a href="#Surface3Points.remove-414"><span class="linenos">414</span></a>            <span class="n">c1</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># z2 - z1;</span>
</span><span id="Surface3Points.remove-415"><a href="#Surface3Points.remove-415"><span class="linenos">415</span></a>            <span class="n">a2</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># x3 - x1;</span>
</span><span id="Surface3Points.remove-416"><a href="#Surface3Points.remove-416"><span class="linenos">416</span></a>            <span class="n">b2</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># y3 - y1;</span>
</span><span id="Surface3Points.remove-417"><a href="#Surface3Points.remove-417"><span class="linenos">417</span></a>            <span class="n">c2</span> <span class="o">=</span> <span class="n">po</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># z3 - z1;</span>
</span><span id="Surface3Points.remove-418"><a href="#Surface3Points.remove-418"><span class="linenos">418</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">-</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">c1</span>
</span><span id="Surface3Points.remove-419"><a href="#Surface3Points.remove-419"><span class="linenos">419</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">c2</span>
</span><span id="Surface3Points.remove-420"><a href="#Surface3Points.remove-420"><span class="linenos">420</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">a2</span>
</span><span id="Surface3Points.remove-421"><a href="#Surface3Points.remove-421"><span class="linenos">421</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># (- self.a * po[0][0] - self.b * po[0][1] - self.c * po[0][2])</span>
</span><span id="Surface3Points.remove-422"><a href="#Surface3Points.remove-422"><span class="linenos">422</span></a>
</span><span id="Surface3Points.remove-423"><a href="#Surface3Points.remove-423"><span class="linenos">423</span></a>            <span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">d</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Surface3Points.remove-424"><a href="#Surface3Points.remove-424"><span class="linenos">424</span></a>
</span><span id="Surface3Points.remove-425"><a href="#Surface3Points.remove-425"><span class="linenos">425</span></a>            <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Surface3Points.remove-426"><a href="#Surface3Points.remove-426"><span class="linenos">426</span></a>                <span class="n">Remover</span><span class="o">.</span><span class="n">plot3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
</span><span id="Surface3Points.remove-427"><a href="#Surface3Points.remove-427"><span class="linenos">427</span></a>
</span><span id="Surface3Points.remove-428"><a href="#Surface3Points.remove-428"><span class="linenos">428</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Remover</span><span class="o">.</span><span class="n">remove3DForm</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
</span><span id="Surface3Points.remove-429"><a href="#Surface3Points.remove-429"><span class="linenos">429</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="Surface3Points.remove-430"><a href="#Surface3Points.remove-430"><span class="linenos">430</span></a>
</span><span id="Surface3Points.remove-431"><a href="#Surface3Points.remove-431"><span class="linenos">431</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="Surface3Points.remove-432"><a href="#Surface3Points.remove-432"><span class="linenos">432</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">)</span>
</span><span id="Surface3Points.remove-433"><a href="#Surface3Points.remove-433"><span class="linenos">433</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;3 Points plane fit&#39;</span><span class="p">)</span>
</span><span id="Surface3Points.remove-434"><a href="#Surface3Points.remove-434"><span class="linenos">434</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;close_event&#39;</span><span class="p">,</span> <span class="n">onClose</span><span class="p">)</span>
</span><span id="Surface3Points.remove-435"><a href="#Surface3Points.remove-435"><span class="linenos">435</span></a>
</span><span id="Surface3Points.remove-436"><a href="#Surface3Points.remove-436"><span class="linenos">436</span></a>        <span class="n">selector</span> <span class="o">=</span> <span class="n">PolygonSelector</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Surface3Points.remove-437"><a href="#Surface3Points.remove-437"><span class="linenos">437</span></a>
</span><span id="Surface3Points.remove-438"><a href="#Surface3Points.remove-438"><span class="linenos">438</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>3 points plane fit implementation
Opens a plot figure to choose the 3 points and fids the plane for those points</p>

<h2 id="parameters">Parameters</h2>

<p>obj: surface.Surface
    The surface object on wich the polynomial fit is applied
bplt: bool
    If True plots the plane overimposed on the surface</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Remover">Remover</a></dt>
                                <dd id="Surface3Points.applyRemover" class="function"><a href="#Remover.applyRemover">applyRemover</a></dd>
                <dd id="Surface3Points.plotForm" class="function"><a href="#Remover.plotForm">plotForm</a></dd>
                <dd id="Surface3Points.removeForm" class="function"><a href="#Remover.removeForm">removeForm</a></dd>
                <dd id="Surface3Points.plot3DForm" class="function"><a href="#Remover.plot3DForm">plot3DForm</a></dd>
                <dd id="Surface3Points.remove3DForm" class="function"><a href="#Remover.remove3DForm">remove3DForm</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Sphere">
                            <input id="Sphere-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Sphere</span><wbr>(<span class="base"><a href="#Remover">Remover</a></span>):

                <label class="view-source-button" for="Sphere-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Sphere"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Sphere-441"><a href="#Sphere-441"><span class="linenos">441</span></a><span class="k">class</span> <span class="nc">Sphere</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="Sphere-442"><a href="#Sphere-442"><span class="linenos">442</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Sphere-443"><a href="#Sphere-443"><span class="linenos">443</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Sphere-444"><a href="#Sphere-444"><span class="linenos">444</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Sphere-445"><a href="#Sphere-445"><span class="linenos">445</span></a><span class="sd">        Calculates the least square sphere</span>
</span><span id="Sphere-446"><a href="#Sphere-446"><span class="linenos">446</span></a>
</span><span id="Sphere-447"><a href="#Sphere-447"><span class="linenos">447</span></a><span class="sd">        Parameters</span>
</span><span id="Sphere-448"><a href="#Sphere-448"><span class="linenos">448</span></a><span class="sd">        ----------</span>
</span><span id="Sphere-449"><a href="#Sphere-449"><span class="linenos">449</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="Sphere-450"><a href="#Sphere-450"><span class="linenos">450</span></a><span class="sd">            The surface object on wich the polynomial fit is applied</span>
</span><span id="Sphere-451"><a href="#Sphere-451"><span class="linenos">451</span></a><span class="sd">        finalize: bool</span>
</span><span id="Sphere-452"><a href="#Sphere-452"><span class="linenos">452</span></a><span class="sd">            If set to False the fit will not alter the surface,</span>
</span><span id="Sphere-453"><a href="#Sphere-453"><span class="linenos">453</span></a><span class="sd">            the method will only return the center and the radius</span>
</span><span id="Sphere-454"><a href="#Sphere-454"><span class="linenos">454</span></a><span class="sd">        radius: float</span>
</span><span id="Sphere-455"><a href="#Sphere-455"><span class="linenos">455</span></a><span class="sd">            If None the method will use the best fit radius</span>
</span><span id="Sphere-456"><a href="#Sphere-456"><span class="linenos">456</span></a><span class="sd">            If a radius is passed then the program will use it</span>
</span><span id="Sphere-457"><a href="#Sphere-457"><span class="linenos">457</span></a><span class="sd">        bplt: bool</span>
</span><span id="Sphere-458"><a href="#Sphere-458"><span class="linenos">458</span></a><span class="sd">            Plots the sphere fitted to the data points</span>
</span><span id="Sphere-459"><a href="#Sphere-459"><span class="linenos">459</span></a>
</span><span id="Sphere-460"><a href="#Sphere-460"><span class="linenos">460</span></a><span class="sd">        Returns</span>
</span><span id="Sphere-461"><a href="#Sphere-461"><span class="linenos">461</span></a><span class="sd">        ----------</span>
</span><span id="Sphere-462"><a href="#Sphere-462"><span class="linenos">462</span></a><span class="sd">        (radius, C): (float, [xc, yc, zc])</span>
</span><span id="Sphere-463"><a href="#Sphere-463"><span class="linenos">463</span></a><span class="sd">            Radius and sphere center coordinates</span>
</span><span id="Sphere-464"><a href="#Sphere-464"><span class="linenos">464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Sphere-465"><a href="#Sphere-465"><span class="linenos">465</span></a>        <span class="c1">#   Assemble the A matrix</span>
</span><span id="Sphere-466"><a href="#Sphere-466"><span class="linenos">466</span></a>        <span class="n">spZ</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Sphere-467"><a href="#Sphere-467"><span class="linenos">467</span></a>        <span class="n">spX</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Sphere-468"><a href="#Sphere-468"><span class="linenos">468</span></a>        <span class="n">spY</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Sphere-469"><a href="#Sphere-469"><span class="linenos">469</span></a>
</span><span id="Sphere-470"><a href="#Sphere-470"><span class="linenos">470</span></a>        <span class="n">nanind</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">spZ</span><span class="p">)</span>
</span><span id="Sphere-471"><a href="#Sphere-471"><span class="linenos">471</span></a>
</span><span id="Sphere-472"><a href="#Sphere-472"><span class="linenos">472</span></a>        <span class="n">spZ</span> <span class="o">=</span> <span class="n">spZ</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Sphere-473"><a href="#Sphere-473"><span class="linenos">473</span></a>        <span class="n">spX</span> <span class="o">=</span> <span class="n">spX</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Sphere-474"><a href="#Sphere-474"><span class="linenos">474</span></a>        <span class="n">spY</span> <span class="o">=</span> <span class="n">spY</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Sphere-475"><a href="#Sphere-475"><span class="linenos">475</span></a>
</span><span id="Sphere-476"><a href="#Sphere-476"><span class="linenos">476</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">spX</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="Sphere-477"><a href="#Sphere-477"><span class="linenos">477</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spX</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="Sphere-478"><a href="#Sphere-478"><span class="linenos">478</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">spY</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="Sphere-479"><a href="#Sphere-479"><span class="linenos">479</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">spZ</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="Sphere-480"><a href="#Sphere-480"><span class="linenos">480</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Sphere-481"><a href="#Sphere-481"><span class="linenos">481</span></a>
</span><span id="Sphere-482"><a href="#Sphere-482"><span class="linenos">482</span></a>        <span class="c1">#   Assemble the f matrix</span>
</span><span id="Sphere-483"><a href="#Sphere-483"><span class="linenos">483</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">spX</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Sphere-484"><a href="#Sphere-484"><span class="linenos">484</span></a>        <span class="n">f</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">spX</span> <span class="o">*</span> <span class="n">spX</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">spY</span> <span class="o">*</span> <span class="n">spY</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">spZ</span> <span class="o">*</span> <span class="n">spZ</span><span class="p">)</span>
</span><span id="Sphere-485"><a href="#Sphere-485"><span class="linenos">485</span></a>        <span class="n">C</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Sphere-486"><a href="#Sphere-486"><span class="linenos">486</span></a>
</span><span id="Sphere-487"><a href="#Sphere-487"><span class="linenos">487</span></a>        <span class="c1">#   solve for the radius</span>
</span><span id="Sphere-488"><a href="#Sphere-488"><span class="linenos">488</span></a>        <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Sphere-489"><a href="#Sphere-489"><span class="linenos">489</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="Sphere-490"><a href="#Sphere-490"><span class="linenos">490</span></a>            <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Sphere-491"><a href="#Sphere-491"><span class="linenos">491</span></a>
</span><span id="Sphere-492"><a href="#Sphere-492"><span class="linenos">492</span></a>        <span class="k">if</span> <span class="n">finalize</span><span class="p">:</span>
</span><span id="Sphere-493"><a href="#Sphere-493"><span class="linenos">493</span></a>            <span class="n">sph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Sphere-494"><a href="#Sphere-494"><span class="linenos">494</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">sph</span>
</span><span id="Sphere-495"><a href="#Sphere-495"><span class="linenos">495</span></a>
</span><span id="Sphere-496"><a href="#Sphere-496"><span class="linenos">496</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Sphere-497"><a href="#Sphere-497"><span class="linenos">497</span></a>            <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">20</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">10</span><span class="n">j</span><span class="p">]</span>
</span><span id="Sphere-498"><a href="#Sphere-498"><span class="linenos">498</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="Sphere-499"><a href="#Sphere-499"><span class="linenos">499</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="Sphere-500"><a href="#Sphere-500"><span class="linenos">500</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="Sphere-501"><a href="#Sphere-501"><span class="linenos">501</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Sphere-502"><a href="#Sphere-502"><span class="linenos">502</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Sphere-503"><a href="#Sphere-503"><span class="linenos">503</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Sphere-504"><a href="#Sphere-504"><span class="linenos">504</span></a>
</span><span id="Sphere-505"><a href="#Sphere-505"><span class="linenos">505</span></a>            <span class="c1">#   3D plot of Sphere bfv</span>
</span><span id="Sphere-506"><a href="#Sphere-506"><span class="linenos">506</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="Sphere-507"><a href="#Sphere-507"><span class="linenos">507</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
</span><span id="Sphere-508"><a href="#Sphere-508"><span class="linenos">508</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">)</span>
</span><span id="Sphere-509"><a href="#Sphere-509"><span class="linenos">509</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Sphere-510"><a href="#Sphere-510"><span class="linenos">510</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Sphere-511"><a href="#Sphere-511"><span class="linenos">511</span></a>
</span><span id="Sphere-512"><a href="#Sphere-512"><span class="linenos">512</span></a>        <span class="k">return</span> <span class="n">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">C</span>
</span></pre></div>


    

                            <div id="Sphere.remove" class="classattr">
                                        <input id="Sphere.remove-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">remove</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span><span class="p">:</span> <span class="n"><a href="surface.html#Surface">surfile.surface.Surface</a></span>, </span><span class="param"><span class="n">finalize</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">radius</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Sphere.remove-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Sphere.remove"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Sphere.remove-442"><a href="#Sphere.remove-442"><span class="linenos">442</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Sphere.remove-443"><a href="#Sphere.remove-443"><span class="linenos">443</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Sphere.remove-444"><a href="#Sphere.remove-444"><span class="linenos">444</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Sphere.remove-445"><a href="#Sphere.remove-445"><span class="linenos">445</span></a><span class="sd">        Calculates the least square sphere</span>
</span><span id="Sphere.remove-446"><a href="#Sphere.remove-446"><span class="linenos">446</span></a>
</span><span id="Sphere.remove-447"><a href="#Sphere.remove-447"><span class="linenos">447</span></a><span class="sd">        Parameters</span>
</span><span id="Sphere.remove-448"><a href="#Sphere.remove-448"><span class="linenos">448</span></a><span class="sd">        ----------</span>
</span><span id="Sphere.remove-449"><a href="#Sphere.remove-449"><span class="linenos">449</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="Sphere.remove-450"><a href="#Sphere.remove-450"><span class="linenos">450</span></a><span class="sd">            The surface object on wich the polynomial fit is applied</span>
</span><span id="Sphere.remove-451"><a href="#Sphere.remove-451"><span class="linenos">451</span></a><span class="sd">        finalize: bool</span>
</span><span id="Sphere.remove-452"><a href="#Sphere.remove-452"><span class="linenos">452</span></a><span class="sd">            If set to False the fit will not alter the surface,</span>
</span><span id="Sphere.remove-453"><a href="#Sphere.remove-453"><span class="linenos">453</span></a><span class="sd">            the method will only return the center and the radius</span>
</span><span id="Sphere.remove-454"><a href="#Sphere.remove-454"><span class="linenos">454</span></a><span class="sd">        radius: float</span>
</span><span id="Sphere.remove-455"><a href="#Sphere.remove-455"><span class="linenos">455</span></a><span class="sd">            If None the method will use the best fit radius</span>
</span><span id="Sphere.remove-456"><a href="#Sphere.remove-456"><span class="linenos">456</span></a><span class="sd">            If a radius is passed then the program will use it</span>
</span><span id="Sphere.remove-457"><a href="#Sphere.remove-457"><span class="linenos">457</span></a><span class="sd">        bplt: bool</span>
</span><span id="Sphere.remove-458"><a href="#Sphere.remove-458"><span class="linenos">458</span></a><span class="sd">            Plots the sphere fitted to the data points</span>
</span><span id="Sphere.remove-459"><a href="#Sphere.remove-459"><span class="linenos">459</span></a>
</span><span id="Sphere.remove-460"><a href="#Sphere.remove-460"><span class="linenos">460</span></a><span class="sd">        Returns</span>
</span><span id="Sphere.remove-461"><a href="#Sphere.remove-461"><span class="linenos">461</span></a><span class="sd">        ----------</span>
</span><span id="Sphere.remove-462"><a href="#Sphere.remove-462"><span class="linenos">462</span></a><span class="sd">        (radius, C): (float, [xc, yc, zc])</span>
</span><span id="Sphere.remove-463"><a href="#Sphere.remove-463"><span class="linenos">463</span></a><span class="sd">            Radius and sphere center coordinates</span>
</span><span id="Sphere.remove-464"><a href="#Sphere.remove-464"><span class="linenos">464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Sphere.remove-465"><a href="#Sphere.remove-465"><span class="linenos">465</span></a>        <span class="c1">#   Assemble the A matrix</span>
</span><span id="Sphere.remove-466"><a href="#Sphere.remove-466"><span class="linenos">466</span></a>        <span class="n">spZ</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Sphere.remove-467"><a href="#Sphere.remove-467"><span class="linenos">467</span></a>        <span class="n">spX</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Sphere.remove-468"><a href="#Sphere.remove-468"><span class="linenos">468</span></a>        <span class="n">spY</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Sphere.remove-469"><a href="#Sphere.remove-469"><span class="linenos">469</span></a>
</span><span id="Sphere.remove-470"><a href="#Sphere.remove-470"><span class="linenos">470</span></a>        <span class="n">nanind</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">spZ</span><span class="p">)</span>
</span><span id="Sphere.remove-471"><a href="#Sphere.remove-471"><span class="linenos">471</span></a>
</span><span id="Sphere.remove-472"><a href="#Sphere.remove-472"><span class="linenos">472</span></a>        <span class="n">spZ</span> <span class="o">=</span> <span class="n">spZ</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Sphere.remove-473"><a href="#Sphere.remove-473"><span class="linenos">473</span></a>        <span class="n">spX</span> <span class="o">=</span> <span class="n">spX</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Sphere.remove-474"><a href="#Sphere.remove-474"><span class="linenos">474</span></a>        <span class="n">spY</span> <span class="o">=</span> <span class="n">spY</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Sphere.remove-475"><a href="#Sphere.remove-475"><span class="linenos">475</span></a>
</span><span id="Sphere.remove-476"><a href="#Sphere.remove-476"><span class="linenos">476</span></a>        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">spX</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="Sphere.remove-477"><a href="#Sphere.remove-477"><span class="linenos">477</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spX</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="Sphere.remove-478"><a href="#Sphere.remove-478"><span class="linenos">478</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">spY</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="Sphere.remove-479"><a href="#Sphere.remove-479"><span class="linenos">479</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">spZ</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="Sphere.remove-480"><a href="#Sphere.remove-480"><span class="linenos">480</span></a>        <span class="n">A</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Sphere.remove-481"><a href="#Sphere.remove-481"><span class="linenos">481</span></a>
</span><span id="Sphere.remove-482"><a href="#Sphere.remove-482"><span class="linenos">482</span></a>        <span class="c1">#   Assemble the f matrix</span>
</span><span id="Sphere.remove-483"><a href="#Sphere.remove-483"><span class="linenos">483</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">spX</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Sphere.remove-484"><a href="#Sphere.remove-484"><span class="linenos">484</span></a>        <span class="n">f</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">spX</span> <span class="o">*</span> <span class="n">spX</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">spY</span> <span class="o">*</span> <span class="n">spY</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">spZ</span> <span class="o">*</span> <span class="n">spZ</span><span class="p">)</span>
</span><span id="Sphere.remove-485"><a href="#Sphere.remove-485"><span class="linenos">485</span></a>        <span class="n">C</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Sphere.remove-486"><a href="#Sphere.remove-486"><span class="linenos">486</span></a>
</span><span id="Sphere.remove-487"><a href="#Sphere.remove-487"><span class="linenos">487</span></a>        <span class="c1">#   solve for the radius</span>
</span><span id="Sphere.remove-488"><a href="#Sphere.remove-488"><span class="linenos">488</span></a>        <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Sphere.remove-489"><a href="#Sphere.remove-489"><span class="linenos">489</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="Sphere.remove-490"><a href="#Sphere.remove-490"><span class="linenos">490</span></a>            <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Sphere.remove-491"><a href="#Sphere.remove-491"><span class="linenos">491</span></a>
</span><span id="Sphere.remove-492"><a href="#Sphere.remove-492"><span class="linenos">492</span></a>        <span class="k">if</span> <span class="n">finalize</span><span class="p">:</span>
</span><span id="Sphere.remove-493"><a href="#Sphere.remove-493"><span class="linenos">493</span></a>            <span class="n">sph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Sphere.remove-494"><a href="#Sphere.remove-494"><span class="linenos">494</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">sph</span>
</span><span id="Sphere.remove-495"><a href="#Sphere.remove-495"><span class="linenos">495</span></a>
</span><span id="Sphere.remove-496"><a href="#Sphere.remove-496"><span class="linenos">496</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Sphere.remove-497"><a href="#Sphere.remove-497"><span class="linenos">497</span></a>            <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">20</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span><span class="mi">10</span><span class="n">j</span><span class="p">]</span>
</span><span id="Sphere.remove-498"><a href="#Sphere.remove-498"><span class="linenos">498</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="Sphere.remove-499"><a href="#Sphere.remove-499"><span class="linenos">499</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="Sphere.remove-500"><a href="#Sphere.remove-500"><span class="linenos">500</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="Sphere.remove-501"><a href="#Sphere.remove-501"><span class="linenos">501</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Sphere.remove-502"><a href="#Sphere.remove-502"><span class="linenos">502</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Sphere.remove-503"><a href="#Sphere.remove-503"><span class="linenos">503</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Sphere.remove-504"><a href="#Sphere.remove-504"><span class="linenos">504</span></a>
</span><span id="Sphere.remove-505"><a href="#Sphere.remove-505"><span class="linenos">505</span></a>            <span class="c1">#   3D plot of Sphere bfv</span>
</span><span id="Sphere.remove-506"><a href="#Sphere.remove-506"><span class="linenos">506</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="Sphere.remove-507"><a href="#Sphere.remove-507"><span class="linenos">507</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
</span><span id="Sphere.remove-508"><a href="#Sphere.remove-508"><span class="linenos">508</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">)</span>
</span><span id="Sphere.remove-509"><a href="#Sphere.remove-509"><span class="linenos">509</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="Sphere.remove-510"><a href="#Sphere.remove-510"><span class="linenos">510</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Sphere.remove-511"><a href="#Sphere.remove-511"><span class="linenos">511</span></a>
</span><span id="Sphere.remove-512"><a href="#Sphere.remove-512"><span class="linenos">512</span></a>        <span class="k">return</span> <span class="n">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">C</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the least square sphere</p>

<h2 id="parameters">Parameters</h2>

<p>obj: surface.Surface
    The surface object on wich the polynomial fit is applied
finalize: bool
    If set to False the fit will not alter the surface,
    the method will only return the center and the radius
radius: float
    If None the method will use the best fit radius
    If a radius is passed then the program will use it
bplt: bool
    Plots the sphere fitted to the data points</p>

<h2 id="returns">Returns</h2>

<p>(radius, C): (float, [xc, yc, zc])
    Radius and sphere center coordinates</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Remover">Remover</a></dt>
                                <dd id="Sphere.applyRemover" class="function"><a href="#Remover.applyRemover">applyRemover</a></dd>
                <dd id="Sphere.plotForm" class="function"><a href="#Remover.plotForm">plotForm</a></dd>
                <dd id="Sphere.removeForm" class="function"><a href="#Remover.removeForm">removeForm</a></dd>
                <dd id="Sphere.plot3DForm" class="function"><a href="#Remover.plot3DForm">plot3DForm</a></dd>
                <dd id="Sphere.remove3DForm" class="function"><a href="#Remover.remove3DForm">remove3DForm</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="evalCyl">
                            <input id="evalCyl-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">evalCyl</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span><span class="p">:</span> <span class="n"><a href="surface.html#Surface">surfile.surface.Surface</a></span>, </span><span class="param"><span class="n">est_p</span>, </span><span class="param"><span class="n">concavity</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="evalCyl-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#evalCyl"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="evalCyl-515"><a href="#evalCyl-515"><span class="linenos">515</span></a><span class="k">def</span> <span class="nf">evalCyl</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">est_p</span><span class="p">,</span> <span class="n">concavity</span><span class="p">):</span>
</span><span id="evalCyl-516"><a href="#evalCyl-516"><span class="linenos">516</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="evalCyl-517"><a href="#evalCyl-517"><span class="linenos">517</span></a><span class="sd">    Evaluates the cylinder points given the 5 parameters</span>
</span><span id="evalCyl-518"><a href="#evalCyl-518"><span class="linenos">518</span></a>
</span><span id="evalCyl-519"><a href="#evalCyl-519"><span class="linenos">519</span></a><span class="sd">    Parameters</span>
</span><span id="evalCyl-520"><a href="#evalCyl-520"><span class="linenos">520</span></a><span class="sd">    ----------</span>
</span><span id="evalCyl-521"><a href="#evalCyl-521"><span class="linenos">521</span></a><span class="sd">    obj: surface.Surface</span>
</span><span id="evalCyl-522"><a href="#evalCyl-522"><span class="linenos">522</span></a><span class="sd">        The surface object on wich the cylinder is calculated</span>
</span><span id="evalCyl-523"><a href="#evalCyl-523"><span class="linenos">523</span></a><span class="sd">    est_p: np.array</span>
</span><span id="evalCyl-524"><a href="#evalCyl-524"><span class="linenos">524</span></a><span class="sd">        P[0] = r, radius of the cylinder</span>
</span><span id="evalCyl-525"><a href="#evalCyl-525"><span class="linenos">525</span></a><span class="sd">        p[1] = Yc, y coordinate of the cylinder centre</span>
</span><span id="evalCyl-526"><a href="#evalCyl-526"><span class="linenos">526</span></a><span class="sd">        P[2] = Zc, z coordinate of the cylinder centre</span>
</span><span id="evalCyl-527"><a href="#evalCyl-527"><span class="linenos">527</span></a><span class="sd">        P[3] = alpha_z, rotation angle (radian) about the z-axis</span>
</span><span id="evalCyl-528"><a href="#evalCyl-528"><span class="linenos">528</span></a><span class="sd">        P[4] = alpha_y, rotation angle (radian) about the y-axis</span>
</span><span id="evalCyl-529"><a href="#evalCyl-529"><span class="linenos">529</span></a><span class="sd">    concavity:</span>
</span><span id="evalCyl-530"><a href="#evalCyl-530"><span class="linenos">530</span></a><span class="sd">        Either &#39;concave&#39; or &#39;convex&#39;</span>
</span><span id="evalCyl-531"><a href="#evalCyl-531"><span class="linenos">531</span></a>
</span><span id="evalCyl-532"><a href="#evalCyl-532"><span class="linenos">532</span></a><span class="sd">    Returns</span>
</span><span id="evalCyl-533"><a href="#evalCyl-533"><span class="linenos">533</span></a><span class="sd">    -------</span>
</span><span id="evalCyl-534"><a href="#evalCyl-534"><span class="linenos">534</span></a><span class="sd">        z_cyl: np.ndarray</span>
</span><span id="evalCyl-535"><a href="#evalCyl-535"><span class="linenos">535</span></a><span class="sd">            The calculated points</span>
</span><span id="evalCyl-536"><a href="#evalCyl-536"><span class="linenos">536</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="evalCyl-537"><a href="#evalCyl-537"><span class="linenos">537</span></a>    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">est_p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">est_p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="evalCyl-538"><a href="#evalCyl-538"><span class="linenos">538</span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">est_p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="evalCyl-539"><a href="#evalCyl-539"><span class="linenos">539</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">est_p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">est_p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="evalCyl-540"><a href="#evalCyl-540"><span class="linenos">540</span></a>
</span><span id="evalCyl-541"><a href="#evalCyl-541"><span class="linenos">541</span></a>    <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="evalCyl-542"><a href="#evalCyl-542"><span class="linenos">542</span></a>    <span class="n">B</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">est_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="evalCyl-543"><a href="#evalCyl-543"><span class="linenos">543</span></a>    <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">l</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> \
</span><span id="evalCyl-544"><a href="#evalCyl-544"><span class="linenos">544</span></a>        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">m</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">est_p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> \
</span><span id="evalCyl-545"><a href="#evalCyl-545"><span class="linenos">545</span></a>        <span class="mi">2</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">est_p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">est_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="evalCyl-546"><a href="#evalCyl-546"><span class="linenos">546</span></a>
</span><span id="evalCyl-547"><a href="#evalCyl-547"><span class="linenos">547</span></a>    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">C</span><span class="p">)</span> <span class="k">if</span> <span class="n">concavity</span> <span class="o">==</span> <span class="s1">&#39;convex&#39;</span> <span class="k">else</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">C</span><span class="p">)</span>
</span><span id="evalCyl-548"><a href="#evalCyl-548"><span class="linenos">548</span></a>
</span><span id="evalCyl-549"><a href="#evalCyl-549"><span class="linenos">549</span></a>    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">A</span><span class="p">)</span> <span class="o">+</span> <span class="n">est_p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Evaluates the cylinder points given the 5 parameters</p>

<h2 id="parameters">Parameters</h2>

<p>obj: surface.Surface
    The surface object on wich the cylinder is calculated
est_p: np.array
    P[0] = r, radius of the cylinder
    p[1] = Yc, y coordinate of the cylinder centre
    P[2] = Zc, z coordinate of the cylinder centre
    P[3] = alpha_z, rotation angle (radian) about the z-axis
    P[4] = alpha_y, rotation angle (radian) about the y-axis
concavity:
    Either 'concave' or 'convex'</p>

<h2 id="returns">Returns</h2>

<pre><code>z_cyl: np.ndarray
    The calculated points
</code></pre>
</div>


                </section>
                <section id="Cylinder">
                            <input id="Cylinder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Cylinder</span><wbr>(<span class="base"><a href="#Remover">Remover</a></span>):

                <label class="view-source-button" for="Cylinder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Cylinder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Cylinder-552"><a href="#Cylinder-552"><span class="linenos">552</span></a><span class="k">class</span> <span class="nc">Cylinder</span><span class="p">(</span><span class="n">Remover</span><span class="p">):</span>
</span><span id="Cylinder-553"><a href="#Cylinder-553"><span class="linenos">553</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Cylinder-554"><a href="#Cylinder-554"><span class="linenos">554</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">alphaZ</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alphaY</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">concavity</span><span class="o">=</span><span class="s1">&#39;convex&#39;</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Cylinder-555"><a href="#Cylinder-555"><span class="linenos">555</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Cylinder-556"><a href="#Cylinder-556"><span class="linenos">556</span></a><span class="sd">        This is a fitting for a horizontal along x cylinder fitting</span>
</span><span id="Cylinder-557"><a href="#Cylinder-557"><span class="linenos">557</span></a><span class="sd">        uses the following parameters to find the best cylinder fit</span>
</span><span id="Cylinder-558"><a href="#Cylinder-558"><span class="linenos">558</span></a>
</span><span id="Cylinder-559"><a href="#Cylinder-559"><span class="linenos">559</span></a><span class="sd">        Parameters</span>
</span><span id="Cylinder-560"><a href="#Cylinder-560"><span class="linenos">560</span></a><span class="sd">        ----------</span>
</span><span id="Cylinder-561"><a href="#Cylinder-561"><span class="linenos">561</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="Cylinder-562"><a href="#Cylinder-562"><span class="linenos">562</span></a><span class="sd">            The surface object on wich the cylinder fit is applied</span>
</span><span id="Cylinder-563"><a href="#Cylinder-563"><span class="linenos">563</span></a><span class="sd">        radius: float</span>
</span><span id="Cylinder-564"><a href="#Cylinder-564"><span class="linenos">564</span></a><span class="sd">            The cylinder nominal radius</span>
</span><span id="Cylinder-565"><a href="#Cylinder-565"><span class="linenos">565</span></a><span class="sd">        alphaY:</span>
</span><span id="Cylinder-566"><a href="#Cylinder-566"><span class="linenos">566</span></a><span class="sd">            An estimate ot the cylinder rotation about the y-axis (radian)</span>
</span><span id="Cylinder-567"><a href="#Cylinder-567"><span class="linenos">567</span></a><span class="sd">        alphaZ:</span>
</span><span id="Cylinder-568"><a href="#Cylinder-568"><span class="linenos">568</span></a><span class="sd">            An estimate ot the cylinder rotation about the z-axis (radian)</span>
</span><span id="Cylinder-569"><a href="#Cylinder-569"><span class="linenos">569</span></a><span class="sd">        concavity: str</span>
</span><span id="Cylinder-570"><a href="#Cylinder-570"><span class="linenos">570</span></a><span class="sd">            Can be either &#39;convex&#39; or &#39;concave&#39;</span>
</span><span id="Cylinder-571"><a href="#Cylinder-571"><span class="linenos">571</span></a><span class="sd">        base: bool</span>
</span><span id="Cylinder-572"><a href="#Cylinder-572"><span class="linenos">572</span></a><span class="sd">            If true removes the points at the base of the cylinder</span>
</span><span id="Cylinder-573"><a href="#Cylinder-573"><span class="linenos">573</span></a><span class="sd">        finalize: bool</span>
</span><span id="Cylinder-574"><a href="#Cylinder-574"><span class="linenos">574</span></a><span class="sd">            If set to False the fit will not alter the surface,</span>
</span><span id="Cylinder-575"><a href="#Cylinder-575"><span class="linenos">575</span></a><span class="sd">            the method will only return the center and the radius</span>
</span><span id="Cylinder-576"><a href="#Cylinder-576"><span class="linenos">576</span></a><span class="sd">        bplt: bool</span>
</span><span id="Cylinder-577"><a href="#Cylinder-577"><span class="linenos">577</span></a><span class="sd">            Plots the sphere fitted to the data points</span>
</span><span id="Cylinder-578"><a href="#Cylinder-578"><span class="linenos">578</span></a>
</span><span id="Cylinder-579"><a href="#Cylinder-579"><span class="linenos">579</span></a><span class="sd">        Returns</span>
</span><span id="Cylinder-580"><a href="#Cylinder-580"><span class="linenos">580</span></a><span class="sd">        ----------</span>
</span><span id="Cylinder-581"><a href="#Cylinder-581"><span class="linenos">581</span></a><span class="sd">        est_p: np.array</span>
</span><span id="Cylinder-582"><a href="#Cylinder-582"><span class="linenos">582</span></a><span class="sd">            P[0] = r, radius of the cylinder</span>
</span><span id="Cylinder-583"><a href="#Cylinder-583"><span class="linenos">583</span></a><span class="sd">            p[1] = Yc, y coordinate of the cylinder centre</span>
</span><span id="Cylinder-584"><a href="#Cylinder-584"><span class="linenos">584</span></a><span class="sd">            P[2] = Zc, z coordinate of the cylinder centre</span>
</span><span id="Cylinder-585"><a href="#Cylinder-585"><span class="linenos">585</span></a><span class="sd">            P[3] = alpha_z, rotation angle (radian) about the z-axis</span>
</span><span id="Cylinder-586"><a href="#Cylinder-586"><span class="linenos">586</span></a><span class="sd">            P[4] = alpha_y, rotation angle (radian) about the y-axis</span>
</span><span id="Cylinder-587"><a href="#Cylinder-587"><span class="linenos">587</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Cylinder-588"><a href="#Cylinder-588"><span class="linenos">588</span></a>        <span class="c1"># TODO : try masking the points instead of removing</span>
</span><span id="Cylinder-589"><a href="#Cylinder-589"><span class="linenos">589</span></a>        <span class="k">if</span> <span class="n">base</span><span class="p">:</span>  <span class="c1"># remove base points</span>
</span><span id="Cylinder-590"><a href="#Cylinder-590"><span class="linenos">590</span></a>            <span class="k">if</span> <span class="n">concavity</span> <span class="o">==</span> <span class="s1">&#39;convex&#39;</span><span class="p">:</span>
</span><span id="Cylinder-591"><a href="#Cylinder-591"><span class="linenos">591</span></a>                <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">9</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="Cylinder-592"><a href="#Cylinder-592"><span class="linenos">592</span></a>                <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">&lt;</span> <span class="n">th</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Cylinder-593"><a href="#Cylinder-593"><span class="linenos">593</span></a>            <span class="k">elif</span> <span class="n">concavity</span> <span class="o">==</span> <span class="s1">&#39;concave&#39;</span><span class="p">:</span>
</span><span id="Cylinder-594"><a href="#Cylinder-594"><span class="linenos">594</span></a>                <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="Cylinder-595"><a href="#Cylinder-595"><span class="linenos">595</span></a>                <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="n">th</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Cylinder-596"><a href="#Cylinder-596"><span class="linenos">596</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Cylinder-597"><a href="#Cylinder-597"><span class="linenos">597</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Concavity is not valid&#39;</span><span class="p">)</span>
</span><span id="Cylinder-598"><a href="#Cylinder-598"><span class="linenos">598</span></a>
</span><span id="Cylinder-599"><a href="#Cylinder-599"><span class="linenos">599</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Cylinder-600"><a href="#Cylinder-600"><span class="linenos">600</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Cylinder-601"><a href="#Cylinder-601"><span class="linenos">601</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Cylinder-602"><a href="#Cylinder-602"><span class="linenos">602</span></a>
</span><span id="Cylinder-603"><a href="#Cylinder-603"><span class="linenos">603</span></a>        <span class="n">nanind</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
</span><span id="Cylinder-604"><a href="#Cylinder-604"><span class="linenos">604</span></a>
</span><span id="Cylinder-605"><a href="#Cylinder-605"><span class="linenos">605</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Cylinder-606"><a href="#Cylinder-606"><span class="linenos">606</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Cylinder-607"><a href="#Cylinder-607"><span class="linenos">607</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Cylinder-608"><a href="#Cylinder-608"><span class="linenos">608</span></a>
</span><span id="Cylinder-609"><a href="#Cylinder-609"><span class="linenos">609</span></a>        <span class="k">def</span> <span class="nf">fitfunc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="Cylinder-610"><a href="#Cylinder-610"><span class="linenos">610</span></a>            <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="Cylinder-611"><a href="#Cylinder-611"><span class="linenos">611</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="Cylinder-612"><a href="#Cylinder-612"><span class="linenos">612</span></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="Cylinder-613"><a href="#Cylinder-613"><span class="linenos">613</span></a>
</span><span id="Cylinder-614"><a href="#Cylinder-614"><span class="linenos">614</span></a>            <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="Cylinder-615"><a href="#Cylinder-615"><span class="linenos">615</span></a>
</span><span id="Cylinder-616"><a href="#Cylinder-616"><span class="linenos">616</span></a>        <span class="n">errfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">fitfunc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># error function</span>
</span><span id="Cylinder-617"><a href="#Cylinder-617"><span class="linenos">617</span></a>
</span><span id="Cylinder-618"><a href="#Cylinder-618"><span class="linenos">618</span></a>        <span class="n">p_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphaZ</span><span class="p">,</span> <span class="n">alphaY</span><span class="p">])</span>
</span><span id="Cylinder-619"><a href="#Cylinder-619"><span class="linenos">619</span></a>        <span class="n">est_p</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">errfunc</span><span class="p">,</span> <span class="n">p_init</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="Cylinder-620"><a href="#Cylinder-620"><span class="linenos">620</span></a>
</span><span id="Cylinder-621"><a href="#Cylinder-621"><span class="linenos">621</span></a>        <span class="c1"># print(f&#39;Cylinder fit: {est_p}&#39;)</span>
</span><span id="Cylinder-622"><a href="#Cylinder-622"><span class="linenos">622</span></a>
</span><span id="Cylinder-623"><a href="#Cylinder-623"><span class="linenos">623</span></a>        <span class="n">z_cyl</span> <span class="o">=</span> <span class="n">evalCyl</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">est_p</span><span class="p">,</span> <span class="n">concavity</span><span class="p">)</span>
</span><span id="Cylinder-624"><a href="#Cylinder-624"><span class="linenos">624</span></a>
</span><span id="Cylinder-625"><a href="#Cylinder-625"><span class="linenos">625</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Cylinder-626"><a href="#Cylinder-626"><span class="linenos">626</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="Cylinder-627"><a href="#Cylinder-627"><span class="linenos">627</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
</span><span id="Cylinder-628"><a href="#Cylinder-628"><span class="linenos">628</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span><span id="Cylinder-629"><a href="#Cylinder-629"><span class="linenos">629</span></a>
</span><span id="Cylinder-630"><a href="#Cylinder-630"><span class="linenos">630</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">z_cyl</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</span><span id="Cylinder-631"><a href="#Cylinder-631"><span class="linenos">631</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">z_cyl</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_cyl</span><span class="p">)])))</span>
</span><span id="Cylinder-632"><a href="#Cylinder-632"><span class="linenos">632</span></a>
</span><span id="Cylinder-633"><a href="#Cylinder-633"><span class="linenos">633</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">],</span> <span class="s1">&#39;x[um]&#39;</span><span class="p">,</span> <span class="s1">&#39;y[um]&#39;</span><span class="p">,</span> <span class="s1">&#39;z[um]&#39;</span><span class="p">)</span>
</span><span id="Cylinder-634"><a href="#Cylinder-634"><span class="linenos">634</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Cylinder-635"><a href="#Cylinder-635"><span class="linenos">635</span></a>
</span><span id="Cylinder-636"><a href="#Cylinder-636"><span class="linenos">636</span></a>        <span class="k">if</span> <span class="n">finalize</span><span class="p">:</span>
</span><span id="Cylinder-637"><a href="#Cylinder-637"><span class="linenos">637</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">z_cyl</span>
</span><span id="Cylinder-638"><a href="#Cylinder-638"><span class="linenos">638</span></a>
</span><span id="Cylinder-639"><a href="#Cylinder-639"><span class="linenos">639</span></a>        <span class="k">return</span> <span class="n">est_p</span>
</span></pre></div>


    

                            <div id="Cylinder.remove" class="classattr">
                                        <input id="Cylinder.remove-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">remove</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obj</span><span class="p">:</span> <span class="n"><a href="surface.html#Surface">surfile.surface.Surface</a></span>,</span><span class="param">	<span class="n">radius</span>,</span><span class="param">	<span class="n">alphaZ</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">alphaY</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">concavity</span><span class="o">=</span><span class="s1">&#39;convex&#39;</span>,</span><span class="param">	<span class="n">base</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">finalize</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">bplt</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Cylinder.remove-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Cylinder.remove"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Cylinder.remove-553"><a href="#Cylinder.remove-553"><span class="linenos">553</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Cylinder.remove-554"><a href="#Cylinder.remove-554"><span class="linenos">554</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">surface</span><span class="o">.</span><span class="n">Surface</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">alphaZ</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alphaY</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">concavity</span><span class="o">=</span><span class="s1">&#39;convex&#39;</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bplt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Cylinder.remove-555"><a href="#Cylinder.remove-555"><span class="linenos">555</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Cylinder.remove-556"><a href="#Cylinder.remove-556"><span class="linenos">556</span></a><span class="sd">        This is a fitting for a horizontal along x cylinder fitting</span>
</span><span id="Cylinder.remove-557"><a href="#Cylinder.remove-557"><span class="linenos">557</span></a><span class="sd">        uses the following parameters to find the best cylinder fit</span>
</span><span id="Cylinder.remove-558"><a href="#Cylinder.remove-558"><span class="linenos">558</span></a>
</span><span id="Cylinder.remove-559"><a href="#Cylinder.remove-559"><span class="linenos">559</span></a><span class="sd">        Parameters</span>
</span><span id="Cylinder.remove-560"><a href="#Cylinder.remove-560"><span class="linenos">560</span></a><span class="sd">        ----------</span>
</span><span id="Cylinder.remove-561"><a href="#Cylinder.remove-561"><span class="linenos">561</span></a><span class="sd">        obj: surface.Surface</span>
</span><span id="Cylinder.remove-562"><a href="#Cylinder.remove-562"><span class="linenos">562</span></a><span class="sd">            The surface object on wich the cylinder fit is applied</span>
</span><span id="Cylinder.remove-563"><a href="#Cylinder.remove-563"><span class="linenos">563</span></a><span class="sd">        radius: float</span>
</span><span id="Cylinder.remove-564"><a href="#Cylinder.remove-564"><span class="linenos">564</span></a><span class="sd">            The cylinder nominal radius</span>
</span><span id="Cylinder.remove-565"><a href="#Cylinder.remove-565"><span class="linenos">565</span></a><span class="sd">        alphaY:</span>
</span><span id="Cylinder.remove-566"><a href="#Cylinder.remove-566"><span class="linenos">566</span></a><span class="sd">            An estimate ot the cylinder rotation about the y-axis (radian)</span>
</span><span id="Cylinder.remove-567"><a href="#Cylinder.remove-567"><span class="linenos">567</span></a><span class="sd">        alphaZ:</span>
</span><span id="Cylinder.remove-568"><a href="#Cylinder.remove-568"><span class="linenos">568</span></a><span class="sd">            An estimate ot the cylinder rotation about the z-axis (radian)</span>
</span><span id="Cylinder.remove-569"><a href="#Cylinder.remove-569"><span class="linenos">569</span></a><span class="sd">        concavity: str</span>
</span><span id="Cylinder.remove-570"><a href="#Cylinder.remove-570"><span class="linenos">570</span></a><span class="sd">            Can be either &#39;convex&#39; or &#39;concave&#39;</span>
</span><span id="Cylinder.remove-571"><a href="#Cylinder.remove-571"><span class="linenos">571</span></a><span class="sd">        base: bool</span>
</span><span id="Cylinder.remove-572"><a href="#Cylinder.remove-572"><span class="linenos">572</span></a><span class="sd">            If true removes the points at the base of the cylinder</span>
</span><span id="Cylinder.remove-573"><a href="#Cylinder.remove-573"><span class="linenos">573</span></a><span class="sd">        finalize: bool</span>
</span><span id="Cylinder.remove-574"><a href="#Cylinder.remove-574"><span class="linenos">574</span></a><span class="sd">            If set to False the fit will not alter the surface,</span>
</span><span id="Cylinder.remove-575"><a href="#Cylinder.remove-575"><span class="linenos">575</span></a><span class="sd">            the method will only return the center and the radius</span>
</span><span id="Cylinder.remove-576"><a href="#Cylinder.remove-576"><span class="linenos">576</span></a><span class="sd">        bplt: bool</span>
</span><span id="Cylinder.remove-577"><a href="#Cylinder.remove-577"><span class="linenos">577</span></a><span class="sd">            Plots the sphere fitted to the data points</span>
</span><span id="Cylinder.remove-578"><a href="#Cylinder.remove-578"><span class="linenos">578</span></a>
</span><span id="Cylinder.remove-579"><a href="#Cylinder.remove-579"><span class="linenos">579</span></a><span class="sd">        Returns</span>
</span><span id="Cylinder.remove-580"><a href="#Cylinder.remove-580"><span class="linenos">580</span></a><span class="sd">        ----------</span>
</span><span id="Cylinder.remove-581"><a href="#Cylinder.remove-581"><span class="linenos">581</span></a><span class="sd">        est_p: np.array</span>
</span><span id="Cylinder.remove-582"><a href="#Cylinder.remove-582"><span class="linenos">582</span></a><span class="sd">            P[0] = r, radius of the cylinder</span>
</span><span id="Cylinder.remove-583"><a href="#Cylinder.remove-583"><span class="linenos">583</span></a><span class="sd">            p[1] = Yc, y coordinate of the cylinder centre</span>
</span><span id="Cylinder.remove-584"><a href="#Cylinder.remove-584"><span class="linenos">584</span></a><span class="sd">            P[2] = Zc, z coordinate of the cylinder centre</span>
</span><span id="Cylinder.remove-585"><a href="#Cylinder.remove-585"><span class="linenos">585</span></a><span class="sd">            P[3] = alpha_z, rotation angle (radian) about the z-axis</span>
</span><span id="Cylinder.remove-586"><a href="#Cylinder.remove-586"><span class="linenos">586</span></a><span class="sd">            P[4] = alpha_y, rotation angle (radian) about the y-axis</span>
</span><span id="Cylinder.remove-587"><a href="#Cylinder.remove-587"><span class="linenos">587</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Cylinder.remove-588"><a href="#Cylinder.remove-588"><span class="linenos">588</span></a>        <span class="c1"># TODO : try masking the points instead of removing</span>
</span><span id="Cylinder.remove-589"><a href="#Cylinder.remove-589"><span class="linenos">589</span></a>        <span class="k">if</span> <span class="n">base</span><span class="p">:</span>  <span class="c1"># remove base points</span>
</span><span id="Cylinder.remove-590"><a href="#Cylinder.remove-590"><span class="linenos">590</span></a>            <span class="k">if</span> <span class="n">concavity</span> <span class="o">==</span> <span class="s1">&#39;convex&#39;</span><span class="p">:</span>
</span><span id="Cylinder.remove-591"><a href="#Cylinder.remove-591"><span class="linenos">591</span></a>                <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">9</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="Cylinder.remove-592"><a href="#Cylinder.remove-592"><span class="linenos">592</span></a>                <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">&lt;</span> <span class="n">th</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Cylinder.remove-593"><a href="#Cylinder.remove-593"><span class="linenos">593</span></a>            <span class="k">elif</span> <span class="n">concavity</span> <span class="o">==</span> <span class="s1">&#39;concave&#39;</span><span class="p">:</span>
</span><span id="Cylinder.remove-594"><a href="#Cylinder.remove-594"><span class="linenos">594</span></a>                <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">radius</span>
</span><span id="Cylinder.remove-595"><a href="#Cylinder.remove-595"><span class="linenos">595</span></a>                <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="n">th</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Cylinder.remove-596"><a href="#Cylinder.remove-596"><span class="linenos">596</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Cylinder.remove-597"><a href="#Cylinder.remove-597"><span class="linenos">597</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Concavity is not valid&#39;</span><span class="p">)</span>
</span><span id="Cylinder.remove-598"><a href="#Cylinder.remove-598"><span class="linenos">598</span></a>
</span><span id="Cylinder.remove-599"><a href="#Cylinder.remove-599"><span class="linenos">599</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Cylinder.remove-600"><a href="#Cylinder.remove-600"><span class="linenos">600</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Cylinder.remove-601"><a href="#Cylinder.remove-601"><span class="linenos">601</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Cylinder.remove-602"><a href="#Cylinder.remove-602"><span class="linenos">602</span></a>
</span><span id="Cylinder.remove-603"><a href="#Cylinder.remove-603"><span class="linenos">603</span></a>        <span class="n">nanind</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
</span><span id="Cylinder.remove-604"><a href="#Cylinder.remove-604"><span class="linenos">604</span></a>
</span><span id="Cylinder.remove-605"><a href="#Cylinder.remove-605"><span class="linenos">605</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Cylinder.remove-606"><a href="#Cylinder.remove-606"><span class="linenos">606</span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Cylinder.remove-607"><a href="#Cylinder.remove-607"><span class="linenos">607</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[</span><span class="n">nanind</span><span class="p">]</span>
</span><span id="Cylinder.remove-608"><a href="#Cylinder.remove-608"><span class="linenos">608</span></a>
</span><span id="Cylinder.remove-609"><a href="#Cylinder.remove-609"><span class="linenos">609</span></a>        <span class="k">def</span> <span class="nf">fitfunc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="Cylinder.remove-610"><a href="#Cylinder.remove-610"><span class="linenos">610</span></a>            <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="Cylinder.remove-611"><a href="#Cylinder.remove-611"><span class="linenos">611</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="Cylinder.remove-612"><a href="#Cylinder.remove-612"><span class="linenos">612</span></a>            <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span id="Cylinder.remove-613"><a href="#Cylinder.remove-613"><span class="linenos">613</span></a>
</span><span id="Cylinder.remove-614"><a href="#Cylinder.remove-614"><span class="linenos">614</span></a>            <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="Cylinder.remove-615"><a href="#Cylinder.remove-615"><span class="linenos">615</span></a>
</span><span id="Cylinder.remove-616"><a href="#Cylinder.remove-616"><span class="linenos">616</span></a>        <span class="n">errfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">fitfunc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># error function</span>
</span><span id="Cylinder.remove-617"><a href="#Cylinder.remove-617"><span class="linenos">617</span></a>
</span><span id="Cylinder.remove-618"><a href="#Cylinder.remove-618"><span class="linenos">618</span></a>        <span class="n">p_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alphaZ</span><span class="p">,</span> <span class="n">alphaY</span><span class="p">])</span>
</span><span id="Cylinder.remove-619"><a href="#Cylinder.remove-619"><span class="linenos">619</span></a>        <span class="n">est_p</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">errfunc</span><span class="p">,</span> <span class="n">p_init</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="Cylinder.remove-620"><a href="#Cylinder.remove-620"><span class="linenos">620</span></a>
</span><span id="Cylinder.remove-621"><a href="#Cylinder.remove-621"><span class="linenos">621</span></a>        <span class="c1"># print(f&#39;Cylinder fit: {est_p}&#39;)</span>
</span><span id="Cylinder.remove-622"><a href="#Cylinder.remove-622"><span class="linenos">622</span></a>
</span><span id="Cylinder.remove-623"><a href="#Cylinder.remove-623"><span class="linenos">623</span></a>        <span class="n">z_cyl</span> <span class="o">=</span> <span class="n">evalCyl</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">est_p</span><span class="p">,</span> <span class="n">concavity</span><span class="p">)</span>
</span><span id="Cylinder.remove-624"><a href="#Cylinder.remove-624"><span class="linenos">624</span></a>
</span><span id="Cylinder.remove-625"><a href="#Cylinder.remove-625"><span class="linenos">625</span></a>        <span class="k">if</span> <span class="n">bplt</span><span class="p">:</span>
</span><span id="Cylinder.remove-626"><a href="#Cylinder.remove-626"><span class="linenos">626</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="Cylinder.remove-627"><a href="#Cylinder.remove-627"><span class="linenos">627</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
</span><span id="Cylinder.remove-628"><a href="#Cylinder.remove-628"><span class="linenos">628</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span><span id="Cylinder.remove-629"><a href="#Cylinder.remove-629"><span class="linenos">629</span></a>
</span><span id="Cylinder.remove-630"><a href="#Cylinder.remove-630"><span class="linenos">630</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">z_cyl</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</span><span id="Cylinder.remove-631"><a href="#Cylinder.remove-631"><span class="linenos">631</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">z_cyl</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_cyl</span><span class="p">)])))</span>
</span><span id="Cylinder.remove-632"><a href="#Cylinder.remove-632"><span class="linenos">632</span></a>
</span><span id="Cylinder.remove-633"><a href="#Cylinder.remove-633"><span class="linenos">633</span></a>            <span class="n">funct</span><span class="o">.</span><span class="n">persFig</span><span class="p">([</span><span class="n">ax</span><span class="p">],</span> <span class="s1">&#39;x[um]&#39;</span><span class="p">,</span> <span class="s1">&#39;y[um]&#39;</span><span class="p">,</span> <span class="s1">&#39;z[um]&#39;</span><span class="p">)</span>
</span><span id="Cylinder.remove-634"><a href="#Cylinder.remove-634"><span class="linenos">634</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Cylinder.remove-635"><a href="#Cylinder.remove-635"><span class="linenos">635</span></a>
</span><span id="Cylinder.remove-636"><a href="#Cylinder.remove-636"><span class="linenos">636</span></a>        <span class="k">if</span> <span class="n">finalize</span><span class="p">:</span>
</span><span id="Cylinder.remove-637"><a href="#Cylinder.remove-637"><span class="linenos">637</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">z_cyl</span>
</span><span id="Cylinder.remove-638"><a href="#Cylinder.remove-638"><span class="linenos">638</span></a>
</span><span id="Cylinder.remove-639"><a href="#Cylinder.remove-639"><span class="linenos">639</span></a>        <span class="k">return</span> <span class="n">est_p</span>
</span></pre></div>


            <div class="docstring"><p>This is a fitting for a horizontal along x cylinder fitting
uses the following parameters to find the best cylinder fit</p>

<h2 id="parameters">Parameters</h2>

<p>obj: surface.Surface
    The surface object on wich the cylinder fit is applied
radius: float
    The cylinder nominal radius
alphaY:
    An estimate ot the cylinder rotation about the y-axis (radian)
alphaZ:
    An estimate ot the cylinder rotation about the z-axis (radian)
concavity: str
    Can be either 'convex' or 'concave'
base: bool
    If true removes the points at the base of the cylinder
finalize: bool
    If set to False the fit will not alter the surface,
    the method will only return the center and the radius
bplt: bool
    Plots the sphere fitted to the data points</p>

<h2 id="returns">Returns</h2>

<p>est_p: np.array
    P[0] = r, radius of the cylinder
    p[1] = Yc, y coordinate of the cylinder centre
    P[2] = Zc, z coordinate of the cylinder centre
    P[3] = alpha_z, rotation angle (radian) about the z-axis
    P[4] = alpha_y, rotation angle (radian) about the y-axis</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Remover">Remover</a></dt>
                                <dd id="Cylinder.applyRemover" class="function"><a href="#Remover.applyRemover">applyRemover</a></dd>
                <dd id="Cylinder.plotForm" class="function"><a href="#Remover.plotForm">plotForm</a></dd>
                <dd id="Cylinder.removeForm" class="function"><a href="#Remover.removeForm">removeForm</a></dd>
                <dd id="Cylinder.plot3DForm" class="function"><a href="#Remover.plot3DForm">plot3DForm</a></dd>
                <dd id="Cylinder.remove3DForm" class="function"><a href="#Remover.remove3DForm">remove3DForm</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>